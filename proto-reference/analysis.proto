syntax = "proto3";

// option optimize_for = LITE_RUNTIME;

package proto.cloud;

message AnalysisRequest {
}

message AnalysisInternalStatus {
    string robotapp_state = 1;
    string motion_state = 2;
}

message AnalysisStatistics {
    // Cleaning record, reported at the end of cleaning (including automatic and manual intervention).
    message CleanRecord {
        uint32 clean_id = 1;       // 清洁id，每次清洁id++，id从1开始，0为无效. [EN: Cleaning ID, increments with each cleaning, starts from 1, 0 is invalid.]

        bool result = 2;           // 清洁结果，true - 成功，反之失败 [EN: Cleaning result, true - success, otherwise failure]

        enum FailCode {
            UNKNOW = 0;            // 未知原因，下面原因都不是 [EN: Unknown reason, none of the reasons below]

            /**
              清洁过程机器原因触发异常导致停机，用户介入恢复清洁并成功后也判断为清洁失败; [EN: Machine-triggered exception during cleaning causing shutdown; even if user intervenes to resume and complete cleaning, it's still considered a failure;]
              下面情况也算: [EN: The following situations also count:]
                 脱困失败； [EN: Escape failure;]
                 断点续扫回充失败; [EN: Resume cleaning return-to-charge failure;]
                 回洗失败； [EN: Return-to-wash failure;]
             */
            ROBOT_FAULT = 1;

            /**
              不受机器控制的报警，比如水箱满、托盘不在位等 [EN: Alarms not controlled by the machine, such as water tank full, tray not in position, etc.]
             */
            ROBOT_ALERT = 2;

            /**
              用户干预，比如清洁中暂停按回充(或直接搬到基站上)、清洁中切换模式等 [EN: User intervention, such as pausing during cleaning and pressing return-to-charge (or moving directly to the station), switching modes during cleaning, etc.]
             */
            MANUAL_BREAK = 3;
        }
        FailCode fail_code = 3;       // 失败原因，当 result == false 有效 [EN: Failure reason, valid when result == false]

        enum Mode {
            AUTO_CLEAN = 0;           // 全局自动清洁 [EN: Global automatic cleaning]
            SELECT_ROOMS_CLEAN = 1;   // 选房清洁 [EN: Selected rooms cleaning]
            SELECT_ZONES_CLEAN = 2;   // 选区清洁 [EN: Selected zones cleaning]
            SPOT_CLEAN = 3;           // 定点清洁 [EN: Spot cleaning]
            FAST_MAPPING = 4;         // 快速建图 [EN: Fast mapping]
        }
        Mode mode = 4;

        enum Type {
            SWEEP_ONLY = 0;
            MOP_ONLY = 1;
            SWEEP_AND_MOP = 2;
        }
        Type type = 5;

        uint64 start_time = 6;     // 清洁开始时间，单位s，不带时区 [EN: Cleaning start time, unit: seconds, without timezone]
        uint64 end_time = 7;       // 清洁结束时间，单位s，不带时区 [EN: Cleaning end time, unit: seconds, without timezone]
        uint32 clean_time = 8;     // 清洁时间，去除断点回充/回洗、暂停时间，不包括回充导航和上座， 单位s [EN: Cleaning duration, excluding resume charging/washing and pause time, not including return-to-charge navigation and docking, unit: seconds]
        uint32 clean_area = 9;     // 清洁面积，清洁过的栅格面积，单位 m2 [EN: Cleaning area, grid area cleaned, unit: m2]
        uint32 slam_area  = 10;    // slam建图面积，不包括障碍物面积，单位 m2 [EN: SLAM mapping area, excluding obstacle area, unit: m2]
        uint32 map_id = 11;        // 当前清洁地图的id [EN: Current cleaning map ID]
        uint32 room_count = 12;    // 当前清洁地图中房间总数 [EN: Total number of rooms in current cleaning map]

        message RollBrush {
            // 单次清扫地毯过流次数，特指机器为了在长毛地毯上能正常清扫(没有卡住异物)，采取的保护电机策略， [EN: Single sweep carpet overcurrent count, specifically refers to the motor protection strategy adopted by the machine to sweep normally on long-pile carpet (without getting stuck on foreign objects),]
            // 例如 L60 长毛地毯电流在 800mA-1100mA之间采取开1s停2s策略. [EN: for example, L60 adopts a 1s on, 2s off strategy when long-pile carpet current is between 800mA-1100mA.]
            uint32 protect_count = 1;

            // 单次清扫堵转过流次数，堵转后机器采取类似开1s停3s策略. [EN: Single sweep stall overcurrent count, after stall the machine adopts a strategy similar to 1s on, 3s off.]
            uint32 stalled_count = 2;
        }
        RollBrush roll_brush = 13;  // 单次清扫过程滚刷停转的次数 [EN: Number of times the roller brush stopped during a single sweep]
    }
    CleanRecord clean = 1;

    // 回充记录，回充上座完成或回充失败时上报 [EN: Return-to-charge record, reported when return-to-charge docking is complete or failed]
    message GoHomeRecord {
        uint32 clean_id = 1;       // 清洁id, 清洁后回充与CleanRecord中的clean_id相同，无清洁的回充设置为0 [EN: Cleaning ID, same as clean_id in CleanRecord for return-to-charge after cleaning, set to 0 for return-to-charge without cleaning]
        bool result = 2;           // 回充结果，true - 成功，反之失败 [EN: Return-to-charge result, true - success, otherwise failure]

        enum FailCode {
            UNKNOW = 0;            // 未知，以下原因都不是. [EN: Unknown, none of the following reasons.]
            MANUAL_BREAK = 1;      // 人工手动停止 [EN: Manual stop by user]
            NAVIGATE_FAIL = 2;     // 导航到充电座附件失败 [EN: Navigation to charging dock vicinity failed]
            ENTER_HOME_FAIL = 3;   // 上座失败 [EN: Docking failed]
        }
        FailCode fail_code = 3;    // 失败原因，当 result == false 有效 [EN: Failure reason, valid when result == false]

        uint64 power_level = 4;    // 开始回充的电量百分比，0 - 100 [EN: Battery percentage when starting return-to-charge, 0 - 100]
        uint64 start_time = 5;     // 回充开始时间，单位s，不带时区 [EN: Return-to-charge start time, unit: seconds, without timezone]
        uint64 end_time = 6;       // 回充结束时间，单位s，不带时区 [EN: Return-to-charge end time, unit: seconds, without timezone]
    }
    GoHomeRecord gohome = 2;

    // 重定位记录，重定位成功或失败时上报 [EN: Relocalization record, reported when relocalization succeeds or fails]
    message RelocateRecord {
        uint32 clean_id = 1;       // 清洁id, 清洁后回充与CleanRecord中的clean_id相同 [EN: Cleaning ID, same as clean_id in CleanRecord for return-to-charge after cleaning]
        bool result = 2;           // 重定位结果，true - 成功，反之失败 [EN: Relocalization result, true - success, otherwise failure]
        uint32 map_count = 3;      // 当前地图数量 [EN: Current map count]
        uint64 start_time = 4;     // 重定位开始时间，单位s，不带时区 [EN: Relocalization start time, unit: seconds, without timezone]
        uint64 end_time = 5;       // 重定位结束时间，单位s，不带时区 [EN: Relocalization end time, unit: seconds, without timezone]
    }
    RelocateRecord relocate = 3;

    // 集尘记录，集尘完成或失败时上报 [EN: Dust collection record, reported when dust collection completes or fails]
    message CollectRecord {
        uint32 clean_id = 1;       // 清洁id, 清洁后回充与CleanRecord中的clean_id相同 [EN: Cleaning ID, same as clean_id in CleanRecord for return-to-charge after cleaning]
        bool result = 2;           // 集尘结果，true - 成功，反之失败 [EN: Dust collection result, true - success, otherwise failure]
        uint64 start_time = 3;     // 集尘开始时间，单位s，不带时区 [EN: Dust collection start time, unit: seconds, without timezone]
    }
    CollectRecord collect = 4;

    // 控制事件 [EN: Control event]
    message ControlEvent {
        uint32 clean_id = 1;       // 清洁id, 清洁后回充与CleanRecord中的clean_id相同，无清洁的回充设置为0 [EN: Cleaning ID, same as clean_id in CleanRecord for return-to-charge after cleaning, set to 0 for return-to-charge without cleaning]

        enum Type {
            AUTO_CLEAN = 0;        // 自动清洁 [EN: Automatic cleaning]
            SPOT_CLEAN = 1;        // 定点清洁 [EN: Spot cleaning]
            GOHOME = 2;            // 回充 [EN: Return to charge]
            CLEAN_PAUSE = 3;       // 清洁(包括自动清洁、选房、选区、定点)暂停 [EN: Cleaning pause (including automatic cleaning, room selection, zone selection, spot)]
            CLEAN_RESUME = 4;      // 清洁(包括自动清洁、选房、选区、定点)恢复 [EN: Cleaning resume (including automatic cleaning, room selection, zone selection, spot)]
        }
        Type type = 2;

        enum Source {
            KEY = 0;              // 机身按键 [EN: Device button]
            APP = 1;              // APP控制 [EN: APP control]
            TIMER = 2;            // 预约定时 [EN: Scheduled timer]
        }
        Source source = 3;

        uint64 timestamp = 4;     // 时间戳，单位s，不带时区 [EN: Timestamp, unit: seconds, without timezone]
    }
    ControlEvent ctrl_event = 5;

    // 配网事件 [EN: Network configuration event]
    message DistributeEvent {
        message TimeStamp {
            uint64 value = 1;     // 时间戳，单位s，不带时区 [EN: Timestamp, unit: seconds, without timezone]
        }
        TimeStamp timestamp = 1;  // 配网结束时间，仅配网成功有这个字段 [EN: Network configuration end time, only present when configuration succeeds]

        enum Mode {
            AP = 0;               // AP
            BLE = 1;              // 蓝牙 [EN: Bluetooth]
        }
        Mode mode = 2;

        enum Result {
            E_OK = 0;           // 成功 [EN: Success]
            E_SRV_ERR = 1;      // 服务异常（连路由器超时） [EN: Service error (router connection timeout)]
            E_AP_NOT_FOUND = 2; // 没有找到 ap [EN: AP not found]
            E_PASSWD_ERR = 3;   // 密码错误 [EN: Password error]
            E_DHCP_ERR = 4;     // dhcp 错误 [EN: DHCP error]
            E_GW_ERR = 5;       // 网关错误 [EN: Gateway error]
            E_DNS_ERR = 6;      // dns 错误 [EN: DNS error]
            E_NET_ERR = 7;      // 网络错误 [EN: Network error]
        }
        Result result = 3;

        string software_version = 4;    // 固件版本 [EN: Firmware version]
        string sn = 7;                  // sn
        string mac = 5;                 // mac 地址 [EN: MAC address]
        string uuid = 6;                // uuid

        string country_code = 8;        // 国家地区码 https://datahub.io/core/country-list [EN: Country/region code https://datahub.io/core/country-list]
        string token = 9;               // token
    }
    DistributeEvent distribute_event = 6;

    // 电池信息 [EN: Battery information]
    message BatteryInfo {
        uint64 update_time = 1;     // 更新时间，单位s，不带时区 [EN: Update time, unit: seconds, without timezone]
        uint32 show_level = 2;      // 显示电量百分比，0 - 100 [EN: Display battery percentage, 0 - 100]
        uint32 real_level = 3;      // 真实电量百分比，0 - 100 [EN: Actual battery percentage, 0 - 100]
        uint32 voltage = 4;         // 电压，单位mV [EN: Voltage, unit: mV]
        sint32 current = 5;         // 电流，单位mA [EN: Current, unit: mA]
        repeated sint32 temperature = 6;   // 温度，单位0.1摄氏度（支持单个或多个电池） [EN: Temperature, unit: 0.1 degrees Celsius (supports single or multiple batteries)]
    }
    BatteryInfo battery_info = 7;
}

message AnalysisResponse {
    // 机器人内部状态信息，不做缓存，变化比较频繁时将只上传最后的状态 [EN: Robot internal status information, not cached, will only upload the last status when changes are frequent]
    AnalysisInternalStatus internal_status = 1;

    // 数据分析信息，做缓存，保证数据不丢失 [EN: Data analysis information, cached to ensure data is not lost]
    AnalysisStatistics statistics = 2;
}
