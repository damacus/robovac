syntax = "proto3";

// option optimize_for = LITE_RUNTIME;

package proto.cloud;

import "proto/cloud/common.proto";

// 云端下发给机器 [EN: Cloud sends to device]
message ErrorSetting {
    repeated uint32 warn_mask = 1;  // 警告码屏蔽，可多个 [EN: Warning code mask, can be multiple]
    repeated string obstacle_reminder_mask = 2; // obstacle_reminder 屏蔽，可多个 [EN: obstacle_reminder mask, can be multiple]
}

// 机器上报到云的错误警告码，包含云端下发的 mask 字段（二次触发需要清除相应的项），枚举来自 ErrorCodeList [EN: Error/warning codes reported from device to cloud, contains mask field from cloud (need to clear corresponding items on second trigger), enum from ErrorCodeList]
message ErrorCode {
    uint64 last_time = 1;  // 当前时间，单位是纳秒，开机到现在的单调时间 CLOCK_MONOTONIC [EN: Current time, unit: nanoseconds, monotonic time since boot CLOCK_MONOTONIC]

    repeated uint32 error = 2;  // 可多个 [EN: Can be multiple]
    repeated uint32 warn = 3;  // 可多个 [EN: Can be multiple]
    ErrorSetting setting = 4;  // 可多个 [EN: Can be multiple]

    message NewCode {
        repeated uint32 error = 1;     // 新上报的错误码 [EN: Newly reported error codes]
        repeated uint32 warn = 2;      // 新上报的警告码 [EN: Newly reported warning codes]
    }
    NewCode new_code = 10;

    message Battery {
        bool restored = 1;  // 电池恢复（换电池标志） [EN: Battery restored (battery replacement flag)]
    }
    Battery battery = 11;

    message ObstacleReminder {
        enum Type {
            POOP = 0;
        }
        Type type = 1;
        string photo_id = 2;
        uint32 accuracy = 3;    // 准确率，0~100，表示百分比（0 表示无效） [EN: Accuracy, 0~100, represents percentage (0 means invalid)]
        uint32 map_id = 4;

        oneof Description {
            Point point = 5;
        }
    }
    repeated ObstacleReminder obstacle_reminder = 12;
}

// 方向：机器上报到云的提醒（手机 app 显示 toast），枚举来自 PromptCodeList [EN: Direction: Reminders reported from device to cloud (mobile app displays toast), enum from PromptCodeList]
message PromptCode {
    uint64 last_time = 1;  // 当前时间，单位是纳秒，开机到现在的单调时间 CLOCK_MONOTONIC [EN: Current time, unit: nanoseconds, monotonic time since boot CLOCK_MONOTONIC]

    repeated uint32 value = 2;
}
