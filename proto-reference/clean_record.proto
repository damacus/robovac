/**
 * 清洁记录. [EN: Cleaning records.]
 */
syntax = "proto3";

// option optimize_for = LITE_RUNTIME;

package proto.cloud;

import "proto/cloud/clean_param.proto";
import "proto/cloud/stream.proto";
import "proto/cloud/p2pdata.proto";

// 手机 app 优先获取 xxxRecordDesc [EN: Mobile app prioritizes fetching xxxRecordDesc]
// CleanRecordDesc 数据格式： [EN: CleanRecordDesc data format:]
// 0xAA 0x01 len(1 byte 数据段的长度) ... checksum(2 byte 除 checksum 外所有字节的和，高字节先发) [EN: 0xAA 0x01 len(1 byte data segment length) ... checksum(2 byte sum of all bytes except checksum, high byte first)]
// CruiseRecordDesc 数据格式： [EN: CruiseRecordDesc data format:]
// 0xAA 0x02 len(1 byte 数据段的长度) ... checksum(2 byte 除 checksum 外所有字节的和，高字节先发) [EN: 0xAA 0x02 len(1 byte data segment length) ... checksum(2 byte sum of all bytes except checksum, high byte first)]

message CleanRecordDesc {
    uint64 start_time = 1;     // 不加时区，单位: s [EN: Without timezone, unit: seconds]
    uint64 end_time = 2;       // 不加时区，单位: s [EN: Without timezone, unit: seconds]
    uint32 duration = 3;       // 清洁时长，单位：s [EN: Cleaning duration, unit: seconds]
    uint32 area = 4;           // 清洁面积，单位: m2 [EN: Cleaning area, unit: m2]
    CleanType clean_type = 5;  // 扫、拖、扫+拖 [EN: Sweep, mop, sweep+mop]

    enum FinishReason {
        COMPLETED = 0;  // 自动清扫完成 [EN: Automatic cleaning completed]
        MANUDAL = 1;    // 人为停止 [EN: Manually stopped]
        LOW_POWER = 2;  // 低电 [EN: Low battery]
        EXCEPTION = 3;  // 异常中断（需要填充 Extra 中 error_code 或 warn_code） [EN: Exception interrupted (need to fill error_code or warn_code in Extra)]
    }
    FinishReason finish_reason = 6;

    message Extra {
        enum Mode {
            AUTO = 0;           // 全局自动清洁 [EN: Global automatic cleaning]
            SELECT_ROOM = 1;    // 选房清洁 [EN: Selected rooms cleaning]
            SELECT_ZONE = 2;    // 选区清洁 [EN: Selected zones cleaning]
            SPOT = 3;           // 定点清洁 [EN: Spot cleaning]
            SCHEDULE_AUTO_CLEAN = 4;  // 预约自动清扫 [EN: Scheduled automatic cleaning]
            SCHEDULE_ROOMS_CLEAN = 5; // 预约房间清扫 [EN: Scheduled rooms cleaning]
        }
        Mode mode = 1;

        // MUS 功能（根据项目定义进行选配） [EN: MUS feature (optional based on project definition)]
        //    bit-0: 执行过洗拖布 [EN:    bit-0: Mop washing executed]
        //    bit-1: 执行过烘干拖布 [EN:    bit-1: Mop drying executed]
        //    bit-2: 执行过集尘 [EN:    bit-2: Dust collection executed]
        //    bit-3: 执行过滚刷自清洁 [EN:    bit-3: Roller brush self-cleaning executed]
        uint32 mus = 2;

        // 清扫错误码，正常为 0 [EN: Cleaning error code, 0 for normal]
        // 值来自 error_code_list_xxx.proto [EN: Values from error_code_list_xxx.proto]
        uint32 error_code = 3;

        // 清扫警告码，正常为 0 [EN: Cleaning warning code, 0 for normal]
        // 值来自 error_code_list_xxx.proto [EN: Values from error_code_list_xxx.proto]
        uint32 prompt_code = 4;
    }
    Extra extra = 7;
}

message CleanRecordData {
    stream.RestrictedZone restricted_zone = 1;
    stream.TemporaryData temp_data = 2;
    stream.RoomParams room_params = 3;

    // id 4 不再使用 [EN: id 4 no longer used]
    // id 5 不再使用 [EN: id 5 no longer used]

    // 上传格式： 头部 Point Point Point Point ...  Point [EN: Upload format: header Point Point Point Point ... Point]
    //           其中头部格式： 0xAA 0x03 [4字节 map_id] [4字节 releases] [EN:           header format: 0xAA 0x03 [4 bytes map_id] [4 bytes releases]]
    bytes path_data = 6;               // 轨迹（目前未压缩） [EN: Path (currently uncompressed)]

    // id 7 不再使用 [EN: id 7 no longer used]
    // id 8 不再使用 [EN: id 8 no longer used]
    // id 9 不再使用 [EN: id 9 no longer used]

    stream.Map map = 10;
    stream.RoomOutline room_outline = 11;
    stream.ObstacleInfo obstacle_info = 12;

    message PathData {
        repeated stream.PathPoint points = 1;
    }
    PathData path_data_v2 = 13;     // 存在该字段使用新的轨迹数据格式 [EN: Use new path data format when this field exists]

    /* p2p通道 清扫记录使用以下参数，不使用上述参数  */ // [EN: p2p channel cleaning records use the following parameters, not the above parameters]
    p2p.CompleteMap map_p2p = 20;       //完整地图 [EN: Complete map]
    p2p.CompletePath path_p2p = 21;     //完整路径 [EN: Complete path]
}

message CruiseRecordDesc {
    uint64 start_time = 1;     // 不加时区，单位: s [EN: Without timezone, unit: seconds]
    uint64 end_time = 2;       // 不加时区，单位: s [EN: Without timezone, unit: seconds]
    uint32 duration = 3;       // 巡航时长，单位：s [EN: Cruise duration, unit: seconds]

    enum FinishReason {
        COMPLETED = 0;  // 自动巡航完成 [EN: Automatic cruise completed]
        MANUDAL = 1;    // 人为停止 [EN: Manually stopped]
        LOW_POWER = 2;  // 低电 [EN: Low battery]
        EXCEPTION = 3;  // 异常中断 [EN: Exception interrupted]
    }
    FinishReason finish_reason = 4;

    message Extra {
        enum Mode {
            GLOBAL_CRUISE = 0;       // 全屋巡航 [EN: Whole house cruise]
            POINT_CRUISE = 1;        // 精准巡航 [EN: Precise cruise]
            ZONES_CRUISE = 2;        // 选区巡航 [EN: Selected zones cruise]
            SCHEDULE_CRUISE = 3;     // 预约巡航 [EN: Scheduled cruise]
        }
        Mode mode = 1;
    }
    Extra extra = 7;
}

message CruiseRecordData {
    stream.RestrictedZone restricted_zone = 1;
    stream.TemporaryData temp_data = 2;
    stream.RoomParams room_params = 3;
    stream.ObstacleInfo obstacle_info = 4;

    // 上传格式： 头部 Point Point Point Point ...  Point [EN: Upload format: header Point Point Point Point ... Point]
    //           其中头部格式： 0xAA 0x03 [4字节 map_id] [4字节 releases] [EN:           header format: 0xAA 0x03 [4 bytes map_id] [4 bytes releases]]
    bytes path_data = 5;            // 轨迹（目前未压缩） [EN: Path (currently uncompressed)]
    stream.CruiseData cruise_data = 6;
    stream.Map map = 7;
    stream.RoomOutline room_outline = 8;

    /* p2p通道 使用以下参数，不使用 除 cruise_data 以外的上述参数  */ // [EN: p2p channel uses the following parameters, not the above parameters except cruise_data]
    p2p.CompleteMap map_p2p = 20;       //完整地图 [EN: Complete map]
    p2p.CompletePath path_p2p = 21;     //完整路径 [EN: Complete path]
}
