syntax = "proto3";

// option optimize_for = LITE_RUNTIME;

package proto.cloud;

message WorkStatus {
    // 刚开机时，不用传 mode，由手机 app 自行决定展示默认值 [EN: When just powered on, no need to send mode, mobile app decides the default display value]
    // mode 由手机 app 下发或按键更改，回复值和上次相同 [EN: mode is sent by mobile app or changed by button, reply value is same as last time]
    message Mode {
        enum Value {
            AUTO = 0;           // 全局自动清洁 [EN: Global auto cleaning]
            SELECT_ROOM = 1;    // 选房清洁 [EN: Selected room cleaning]
            SELECT_ZONE = 2;    // 选区清洁 [EN: Selected zone cleaning]
            SPOT = 3;           // 定点清洁 [EN: Spot cleaning]
            FAST_MAPPING = 4;   // 快速建图 [EN: Fast mapping]
            GLOBAL_CRUISE = 5;  // 全屋巡航 [EN: Whole house cruise]
            ZONES_CRUISE = 6;   // 选区巡航 [EN: Selected zones cruise]
            POINT_CRUISE = 7;   // 指哪巡航（精准到达） [EN: Point cruise (precise arrival)]
            SCENE = 8;          // 场景清洁 [EN: Scene cleaning]
            SMART_FOLLOW = 9;   // 智能跟随 [EN: Smart follow]
        }
        Value value = 1;
    }
    Mode mode = 1;

    enum State {
        STANDBY = 0;            // 待机、建图暂停、暂停清洁、暂停回洗、暂停回充、暂停巡航、寻找机器人 [EN: Standby, mapping paused, cleaning paused, wash return paused, charge return paused, cruise paused, finding robot]
        SLEEP = 1;              // 休眠 [EN: Sleep]
        FAULT = 2;              // 故障 [EN: Fault]
        CHARGING = 3;           // 升级中（未来可能考虑非充电状态也能升级）、充电中、充电完成、充电异常 [EN: Upgrading (may consider non-charging upgrade in future), charging, charge complete, charging abnormal]
        FAST_MAPPING = 4;       // 定位中、快速建图 [EN: Positioning, fast mapping]
        CLEANING = 5;           // 定位中、全局清洁、选区清洁、划区清洁、定点清洁、回洗拖布中、清洗拖布中 [EN: Positioning, global cleaning, zone cleaning, area cleaning, spot cleaning, returning to wash mop, washing mop]
        REMOTE_CTRL = 6;        // 遥控中 [EN: Remote controlling]
        GO_HOME = 7;            // 定位中、回充中（包括清洁完成回充、低电回充） [EN: Positioning, returning to charge (including post-cleaning and low battery return)]
        CRUISIING = 8;          // 定位中、巡航中 [EN: Positioning, cruising]
    }
    State state = 2;

    // 某一时刻以下子状态可能存在一个或同时存在多个 [EN: At any moment, one or more of the following sub-states may exist simultaneously]
    // 隐含规则：下面 message 如果不存在表示该子状态为 IDLE [EN: Implicit rule: if the message below doesn't exist, that sub-state is IDLE]

    message Charging {
        enum State {
            DOING = 0;
            DONE = 1;
            ABNORMAL = 2;  // 充电异常（充电弹片接触但无法充电） [EN: Charging abnormal (charging contacts connected but cannot charge)]
        }
        State state = 1;
    }
    Charging charging = 3;

    message Upgrading {
        enum State {
            DOING = 0;
            DONE = 1;
        }
        State state = 1;
    }
    Upgrading upgrading = 4;

    message Mapping {   // 快速建图、清洁建图都会有这个 message [EN: Both fast mapping and cleaning mapping will have this message]
        enum RunState {
            DOING = 0;
            PAUSED = 1;
        }
        RunState state = 1;

        enum Mode {
            MAPPING = 0; // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
            RELOCATING = 1; // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
        }
        Mode mode = 2;  // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
    }
    Mapping mapping = 5;

    message Cleaning {
        enum RunState {
            DOING = 0;
            PAUSED = 1;
        }
        RunState state = 1;

        enum Mode {
            CLEANING = 0;
            RELOCATING = 1;  // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
            GOTO_POS = 2;
            POOP_CLEANING = 3;      // 便便补扫 [EN: Poop re-cleaning]
        }
        Mode mode = 2;
        bool scheduled_task = 3;    // 是否在执行预约定时任务 [EN: Whether executing scheduled task]
    }
    Cleaning cleaning = 6;

    message GoWash {
        enum RunState {
            DOING = 0;
            PAUSED = 1;
        }
        RunState state = 1;

        enum Mode {
            NAVIGATION = 0;     // 回洗 [EN: Return to wash]
            WASHING = 1;        // 清洗拖布中 [EN: Washing mop]
            DRYING = 2;         // 烘干拖布中（严格意义不属于回洗） [EN: Drying mop (strictly not part of wash return)]
        }
        Mode mode = 2;
    }
    GoWash go_wash = 7;

    message GoHome {
        enum RunState {
            DOING = 0;
            PAUSED = 1;
        }
        RunState state = 1;

        enum Mode {
            COMPLETE_TASK = 0;      // 完成任务回充 [EN: Return to charge after task completion]
            COLLECT_DUST = 1;       // 中途集尘回充 [EN: Mid-task dust collection return]
            OTHRERS = 10;           // 其他回充 [EN: Other returns to charge]
        }
        Mode mode = 2;
    }
    GoHome go_home = 8;

    message Cruisiing {
        enum RunState {
            DOING = 0;
            PAUSED = 1;
        }
        RunState state = 1;

        enum Mode {
            RELOCATING = 0; // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
            CRUISIING = 1; // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
        }
        Mode mode = 2; // [兼容字段，4.1 废弃] [EN: Compatibility field, deprecated in 4.1]
    }
    Cruisiing cruisiing = 9;

    message Relocating {
        enum State {
            DOING = 0;
        }
        State state = 1;
    }
    Relocating relocating = 10;

    message Breakpoint {
        enum State {
            DOING = 0;
        }
        State state = 1;
    }
    Breakpoint breakpoint = 11;

    message RollerBrushCleaning {
        enum State {
            DOING = 0;
        }
        State state = 1;
    }
    RollerBrushCleaning roller_brush_cleaning = 12;

    message SmartFollow {
        enum State {
            DOING = 0;
        }
        State state = 1;

        enum Mode {
            FOLLOWING = 0;  // 跟随中 [EN: Following]
            SEARCHING = 1;  // 搜索目标中 [EN: Searching for target]
        }
        Mode mode = 2;
        uint32 elapsed_time = 3;    // 已执行时间 [EN: Elapsed time]
        uint32 area = 4;            // 面积 [EN: Area]
    }
    SmartFollow smart_follow = 13;

    message Station {
        // 注水系统，操作对象：机器人水箱 [EN: Water injection system, operation target: robot water tank]
        message WaterInjectionSystem {
            enum State {
                ADDING = 0;     // 注水中 [EN: Adding water]
                EMPTYING = 1;   // 排水中 [EN: Draining water]
            }
            State state = 1;
        }
        WaterInjectionSystem water_injection_system = 1;

        // 集尘系统，操作对象：机器人集尘盒 [EN: Dust collection system, operation target: robot dust bin]
        message DustCollectionSystem {
            enum State {
                EMPTYING = 0;   // 排空中 [EN: Emptying]
            }
            State state = 1;
        }
        DustCollectionSystem dust_collection_system = 2;

        // 洗和烘干系统，操作对象：机器人拖布 [EN: Washing and drying system, operation target: robot mop]
        message WashingDryingSystem {
            enum State {
                WASHING = 0;    // 洗拖布中 [EN: Washing mop]
                DRYING = 1;     // 烘干拖布中 [EN: Drying mop]
            }
            State state = 1;
        }
        WashingDryingSystem washing_drying_system = 3;

        // 基站水箱状态 [EN: Station water tank status]
        message WaterTankState {
            bool clear_water_adding = 1;        // 清水添加中 [EN: Adding clean water]
            bool waste_water_recycling = 2;     // 污水回收中 [EN: Recycling waste water]
        }
        WaterTankState water_tank_state = 4;
    }
    Station station = 14;  // 从 x10 项目开始使用这里的基站状态，station dp 的状态保留但不做逻辑处理 [EN: From x10 project onwards use station status here, station dp status is retained but not logically processed]

    message Scene {
        uint32 id = 1;

        uint32 elapsed_time = 2;    // 已执行时间，0 有效 [EN: Elapsed time, 0 is valid]
        uint32 estimate_time = 3;   // 预估完成时间，0 无效 [EN: Estimated completion time, 0 is invalid]
        string name = 4;

        enum TaskMode {
            AUTO = 0;           // 全局自动清洁 [EN: Global auto cleaning]
            SELECT_ROOM = 1;    // 选房清洁 [EN: Selected room cleaning]
            SELECT_ZONE = 2;    // 选区清洁 [EN: Selected zone cleaning]
        }
        TaskMode task_mode = 5;

        // 后面这里加上场景的时间线 [EN: Add scene timeline here later]
        // ...
    }
    Scene current_scene = 19;

    message Trigger {
        enum Source {
            UNKNOWN = 0;        // 来源未知，如：刚开机 [EN: Unknown source, e.g., just powered on]
            APP = 1;            // 手机 app 或者其他调试工具 [EN: Mobile app or other debugging tools]
            KEY = 2;            // 按键，如：暂停、继续、停止、回充等 [EN: Button, e.g., pause, resume, stop, return to charge, etc.]
            TIMING = 3;         // 定时，如：每天清洁、每周清洁等 [EN: Scheduled, e.g., daily cleaning, weekly cleaning, etc.]
            ROBOT = 4;          // 机器人，如：低电、故障、清洁完成等 [EN: Robot, e.g., low battery, fault, cleaning complete, etc.]
            REMOTE_CTRL = 5;    // 遥控器, 如：遥控器按键 [EN: Remote control, e.g., remote control buttons]
        }
        Source source = 1;
    }
    Trigger trigger = 20;
}
