{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"RoboVac Documentation \u00b6 Welcome to the unified documentation hub for the RoboVac integration with Home Assistant. Getting Started \u00b6 DPS Codes Guide : Learn how to find and use Data Point Specification codes for your device. Troubleshooting : Solutions for common issues and connection problems. Development : Guide for contributors and developers. Reference \u00b6 Protocol 3.5 Support : Details about Tuya protocol 3.5 support. Contributing \u00b6 Set up the development environment with task install-dev . Run the test suite using task test . Ensure all linting and type checks pass before submitting changes.","title":"Home"},{"location":"#robovac-documentation","text":"Welcome to the unified documentation hub for the RoboVac integration with Home Assistant.","title":"RoboVac Documentation"},{"location":"#getting-started","text":"DPS Codes Guide : Learn how to find and use Data Point Specification codes for your device. Troubleshooting : Solutions for common issues and connection problems. Development : Guide for contributors and developers.","title":"Getting Started"},{"location":"#reference","text":"Protocol 3.5 Support : Details about Tuya protocol 3.5 support.","title":"Reference"},{"location":"#contributing","text":"Set up the development environment with task install-dev . Run the test suite using task test . Ensure all linting and type checks pass before submitting changes.","title":"Contributing"},{"location":"ISSUE_42_T2276_INVESTIGATION/","text":"T2276 (X8 Pro SES) Investigation \u00b6 Issue Summary \u00b6 T2276 (X8 Pro SES) vacuum is experiencing connection issues with the following symptoms: Device connects to Home Assistant Repeated \"Incomplete read\" errors in logs Empty data points ( {} ) returned from vacuum No status updates received Current Status \u00b6 Model Support : Partial Tests : \u2705 Passing Protocol : \u26a0\ufe0f Issues Technical Analysis \u00b6 Symptoms \u00b6 From user logs: 2025-10-22 13:10:04.065 DEBUG [custom_components.robovac.tuyalocalapi] Incomplete read 2025-10-22 13:10:22.225 DEBUG [custom_components.robovac.tuyalocalapi] Disconnected 2025-10-22 13:10:22.241 DEBUG [custom_components.robovac.tuyalocalapi] Connecting The vacuum connects but doesn't respond to status requests, resulting in: 2025-05-09 08:23:04.568 DEBUG [custom_components.robovac.vacuum] Updating entity values from data points: {} Current Configuration \u00b6 T2276 is currently configured with the following DPS codes: MODE: 152 STATUS: 173 RETURN_HOME: 153 FAN_SPEED: 154 LOCATE: 153 BATTERY: 172 ERROR: 169 These codes are identical to T2275 and T2278 models. Possible Causes \u00b6 Incorrect DPS Codes : T2276 may use different data point codes than T2275/T2278 Protocol Version : Device may use a different Tuya protocol version Encryption : Device may require different encryption handling Timing Issues : Device may need different timeout or retry settings Next Steps \u00b6 For Users \u00b6 Good news : You don't need to manually extract credentials! This integration already does that automatically when you enter your Eufy app email/password in the Home Assistant config flow. If you have a T2276 vacuum, please help us debug the communication issue: Enable Debug Logging : In Home Assistant, add to configuration.yaml : yaml logger: default: info logs: custom_components.robovac: debug custom_components.robovac.tuyalocalapi: debug Restart Home Assistant, then let it try to connect to your T2276 for a few minutes. Provide Debug Logs : Go to Settings \u2192 System \u2192 Logs Download the full log Share the relevant sections showing: Connection attempts \"Incomplete read\" errors Any data point (DPS) values that do appear The complete error sequence Device Information : Exact model name from Eufy app (confirm it's T2276/X8 Pro SES) Firmware version (found in Eufy app settings) Does the vacuum work in the Eufy app? Test Alternative Integration : Try kevinbird15's fork: https://github.com/kevinbird15/robovac-ha-integration Report if it works differently If it works, note any differences in behavior Optional - Advanced Users : If you're comfortable with Python, you can try these tools to capture raw device data: https://github.com/markbajaj/eufy-device-id-python - Gets device info from Eufy servers tinytuya scan - Scans local network for Tuya devices (after you have credentials) But this is NOT required - debug logs are more helpful! For Developers \u00b6 Compare with Working Implementation : Review kevinbird15's implementation that reportedly works Identify protocol or configuration differences Protocol Analysis : Add more detailed logging around message parsing Capture raw Tuya messages for analysis Test Different Configurations : Try different DPS code combinations Test with different protocol versions Experiment with timeout values Related Issues \u00b6 GitHub Issue #42: https://github.com/damacus/robovac/issues/42 kevinbird15's working fork: https://github.com/kevinbird15/robovac-ha-integration References \u00b6 User report from @Casper9228 (2025-04-29) User report from @peggleg (2025-10-22) User report from @kevinbird15 with alternative implementation (2025-09-18) Updates \u00b6 2025-10-22 : Initial investigation documented Tests created and passing for T2276 command mappings Model file exists with standard configuration Issue appears to be at protocol/communication level, not configuration Root cause identified : T2276 requires Tuya protocol version 3.5 (current implementation uses 3.1) Solution decided : Migrate from custom Tuya implementation to LocalTuya's PyTuya Supports protocols 3.1, 3.2, 3.3, 3.4, 3.5 Battle-tested by thousands of users Actively maintained Drop-in replacement for custom code See: https://github.com/rospogrigio/localtuya","title":"T2276 (X8 Pro SES) Investigation"},{"location":"ISSUE_42_T2276_INVESTIGATION/#t2276-x8-pro-ses-investigation","text":"","title":"T2276 (X8 Pro SES) Investigation"},{"location":"ISSUE_42_T2276_INVESTIGATION/#issue-summary","text":"T2276 (X8 Pro SES) vacuum is experiencing connection issues with the following symptoms: Device connects to Home Assistant Repeated \"Incomplete read\" errors in logs Empty data points ( {} ) returned from vacuum No status updates received","title":"Issue Summary"},{"location":"ISSUE_42_T2276_INVESTIGATION/#current-status","text":"Model Support : Partial Tests : \u2705 Passing Protocol : \u26a0\ufe0f Issues","title":"Current Status"},{"location":"ISSUE_42_T2276_INVESTIGATION/#technical-analysis","text":"","title":"Technical Analysis"},{"location":"ISSUE_42_T2276_INVESTIGATION/#symptoms","text":"From user logs: 2025-10-22 13:10:04.065 DEBUG [custom_components.robovac.tuyalocalapi] Incomplete read 2025-10-22 13:10:22.225 DEBUG [custom_components.robovac.tuyalocalapi] Disconnected 2025-10-22 13:10:22.241 DEBUG [custom_components.robovac.tuyalocalapi] Connecting The vacuum connects but doesn't respond to status requests, resulting in: 2025-05-09 08:23:04.568 DEBUG [custom_components.robovac.vacuum] Updating entity values from data points: {}","title":"Symptoms"},{"location":"ISSUE_42_T2276_INVESTIGATION/#current-configuration","text":"T2276 is currently configured with the following DPS codes: MODE: 152 STATUS: 173 RETURN_HOME: 153 FAN_SPEED: 154 LOCATE: 153 BATTERY: 172 ERROR: 169 These codes are identical to T2275 and T2278 models.","title":"Current Configuration"},{"location":"ISSUE_42_T2276_INVESTIGATION/#possible-causes","text":"Incorrect DPS Codes : T2276 may use different data point codes than T2275/T2278 Protocol Version : Device may use a different Tuya protocol version Encryption : Device may require different encryption handling Timing Issues : Device may need different timeout or retry settings","title":"Possible Causes"},{"location":"ISSUE_42_T2276_INVESTIGATION/#next-steps","text":"","title":"Next Steps"},{"location":"ISSUE_42_T2276_INVESTIGATION/#for-users","text":"Good news : You don't need to manually extract credentials! This integration already does that automatically when you enter your Eufy app email/password in the Home Assistant config flow. If you have a T2276 vacuum, please help us debug the communication issue: Enable Debug Logging : In Home Assistant, add to configuration.yaml : yaml logger: default: info logs: custom_components.robovac: debug custom_components.robovac.tuyalocalapi: debug Restart Home Assistant, then let it try to connect to your T2276 for a few minutes. Provide Debug Logs : Go to Settings \u2192 System \u2192 Logs Download the full log Share the relevant sections showing: Connection attempts \"Incomplete read\" errors Any data point (DPS) values that do appear The complete error sequence Device Information : Exact model name from Eufy app (confirm it's T2276/X8 Pro SES) Firmware version (found in Eufy app settings) Does the vacuum work in the Eufy app? Test Alternative Integration : Try kevinbird15's fork: https://github.com/kevinbird15/robovac-ha-integration Report if it works differently If it works, note any differences in behavior Optional - Advanced Users : If you're comfortable with Python, you can try these tools to capture raw device data: https://github.com/markbajaj/eufy-device-id-python - Gets device info from Eufy servers tinytuya scan - Scans local network for Tuya devices (after you have credentials) But this is NOT required - debug logs are more helpful!","title":"For Users"},{"location":"ISSUE_42_T2276_INVESTIGATION/#for-developers","text":"Compare with Working Implementation : Review kevinbird15's implementation that reportedly works Identify protocol or configuration differences Protocol Analysis : Add more detailed logging around message parsing Capture raw Tuya messages for analysis Test Different Configurations : Try different DPS code combinations Test with different protocol versions Experiment with timeout values","title":"For Developers"},{"location":"ISSUE_42_T2276_INVESTIGATION/#related-issues","text":"GitHub Issue #42: https://github.com/damacus/robovac/issues/42 kevinbird15's working fork: https://github.com/kevinbird15/robovac-ha-integration","title":"Related Issues"},{"location":"ISSUE_42_T2276_INVESTIGATION/#references","text":"User report from @Casper9228 (2025-04-29) User report from @peggleg (2025-10-22) User report from @kevinbird15 with alternative implementation (2025-09-18)","title":"References"},{"location":"ISSUE_42_T2276_INVESTIGATION/#updates","text":"2025-10-22 : Initial investigation documented Tests created and passing for T2276 command mappings Model file exists with standard configuration Issue appears to be at protocol/communication level, not configuration Root cause identified : T2276 requires Tuya protocol version 3.5 (current implementation uses 3.1) Solution decided : Migrate from custom Tuya implementation to LocalTuya's PyTuya Supports protocols 3.1, 3.2, 3.3, 3.4, 3.5 Battle-tested by thousands of users Actively maintained Drop-in replacement for custom code See: https://github.com/rospogrigio/localtuya","title":"Updates"},{"location":"PROTOCOL_35_SUPPORT/","text":"Protocol 3.5 Support \u00b6 Overview \u00b6 The RoboVac integration now supports Tuya protocol versions 3.4 and 3.5, which use HMAC-SHA256 for message authentication instead of CRC32. This is required for newer devices like the X8 Pro SES (T2276). Protocol Versions \u00b6 Version Authentication Encoding Notes 3.1 CRC32 (payload only) Base64 Legacy protocol 3.2 CRC32 (payload only) Base64 Same as 3.1 with type_0d 3.3 CRC32 (header + payload) Raw Most common 3.4 HMAC-SHA256 Raw Newer devices 3.5 HMAC-SHA256 Raw Latest protocol Implementation Details \u00b6 HMAC-SHA256 (Protocol 3.4+) \u00b6 For protocol versions 3.4 and above, messages use HMAC-SHA256 for authentication: Message Structure: text [Header: 16 bytes] + [Payload: variable] + [HMAC: 32 bytes] + [Suffix: 4 bytes] HMAC Calculation: Key: Device local key (16 characters) Data: Header + Payload Algorithm: HMAC-SHA256 Output: 32 bytes Verification: Received messages are validated by computing HMAC and comparing Invalid HMAC results in message rejection CRC32 (Protocol < 3.4) \u00b6 Earlier protocols use CRC32 for checksums: Protocol 3.3: CRC32 calculated on: Header + Payload 4-byte checksum Protocol < 3.3: CRC32 calculated on: Payload only 4-byte checksum Payload is base64 encoded Using Protocol 3.5 \u00b6 In Code \u00b6 The TuyaDevice class accepts a version parameter: from custom_components.robovac.tuyalocalapi import TuyaDevice # Protocol 3.5 device = TuyaDevice( model_details=model, device_id=\"your_device_id\", host=\"192.168.1.100\", local_key=\"your_local_key\", timeout=10.0, ping_interval=30.0, update_entity_state=callback, version=(3, 5) # Specify protocol version ) For Model Definitions \u00b6 Models can specify their required protocol version in the model file: # In custom_components/robovac/vacuums/T2276.py class T2276(RobovacModelDetails): # Model uses protocol 3.5 protocol_version = (3, 5) Then in RoboVac.__init__() : # Get protocol version from model details protocol_version = getattr( self.model_details, 'protocol_version', (3, 3) # Default to 3.3 ) # Pass to TuyaDevice TuyaDevice.__init__( self, model_details=self.model_details, device_id=device_id, host=host, local_key=local_key, timeout=timeout, ping_interval=ping_interval, update_entity_state=update_entity_state, version=protocol_version, port=port, ) Troubleshooting \u00b6 \"HMAC verification failed\" \u00b6 This error indicates: Wrong local key Protocol version mismatch Corrupted message Solution: Verify the local key and protocol version for your device. \"Incomplete read\" errors \u00b6 For devices that previously had incomplete read errors (like T2276), upgrading to protocol 3.5 should resolve the issue. Steps: Add protocol_version = (3, 5) to the model file Update RoboVac.__init__() to use the protocol version Test with your device Determining Protocol Version \u00b6 To find the correct protocol version for your device: Check device documentation - Newer devices typically use 3.4+ Try incrementally: Start with 3.3 (most common) If incomplete reads occur, try 3.4 If still issues, try 3.5 Check logs - Look for authentication or checksum errors Testing \u00b6 All protocol versions are tested with the existing test suite: task test The implementation maintains backward compatibility, so existing devices using protocols 3.1-3.3 continue to work without changes. References \u00b6 TinyTuya Protocol Documentation Tuya IoT Protocol Issue #42: X8 Pro SES incomplete read errors","title":"Protocol 3.5 Support"},{"location":"PROTOCOL_35_SUPPORT/#protocol-35-support","text":"","title":"Protocol 3.5 Support"},{"location":"PROTOCOL_35_SUPPORT/#overview","text":"The RoboVac integration now supports Tuya protocol versions 3.4 and 3.5, which use HMAC-SHA256 for message authentication instead of CRC32. This is required for newer devices like the X8 Pro SES (T2276).","title":"Overview"},{"location":"PROTOCOL_35_SUPPORT/#protocol-versions","text":"Version Authentication Encoding Notes 3.1 CRC32 (payload only) Base64 Legacy protocol 3.2 CRC32 (payload only) Base64 Same as 3.1 with type_0d 3.3 CRC32 (header + payload) Raw Most common 3.4 HMAC-SHA256 Raw Newer devices 3.5 HMAC-SHA256 Raw Latest protocol","title":"Protocol Versions"},{"location":"PROTOCOL_35_SUPPORT/#implementation-details","text":"","title":"Implementation Details"},{"location":"PROTOCOL_35_SUPPORT/#hmac-sha256-protocol-34","text":"For protocol versions 3.4 and above, messages use HMAC-SHA256 for authentication: Message Structure: text [Header: 16 bytes] + [Payload: variable] + [HMAC: 32 bytes] + [Suffix: 4 bytes] HMAC Calculation: Key: Device local key (16 characters) Data: Header + Payload Algorithm: HMAC-SHA256 Output: 32 bytes Verification: Received messages are validated by computing HMAC and comparing Invalid HMAC results in message rejection","title":"HMAC-SHA256 (Protocol 3.4+)"},{"location":"PROTOCOL_35_SUPPORT/#crc32-protocol-34","text":"Earlier protocols use CRC32 for checksums: Protocol 3.3: CRC32 calculated on: Header + Payload 4-byte checksum Protocol < 3.3: CRC32 calculated on: Payload only 4-byte checksum Payload is base64 encoded","title":"CRC32 (Protocol &lt; 3.4)"},{"location":"PROTOCOL_35_SUPPORT/#using-protocol-35","text":"","title":"Using Protocol 3.5"},{"location":"PROTOCOL_35_SUPPORT/#in-code","text":"The TuyaDevice class accepts a version parameter: from custom_components.robovac.tuyalocalapi import TuyaDevice # Protocol 3.5 device = TuyaDevice( model_details=model, device_id=\"your_device_id\", host=\"192.168.1.100\", local_key=\"your_local_key\", timeout=10.0, ping_interval=30.0, update_entity_state=callback, version=(3, 5) # Specify protocol version )","title":"In Code"},{"location":"PROTOCOL_35_SUPPORT/#for-model-definitions","text":"Models can specify their required protocol version in the model file: # In custom_components/robovac/vacuums/T2276.py class T2276(RobovacModelDetails): # Model uses protocol 3.5 protocol_version = (3, 5) Then in RoboVac.__init__() : # Get protocol version from model details protocol_version = getattr( self.model_details, 'protocol_version', (3, 3) # Default to 3.3 ) # Pass to TuyaDevice TuyaDevice.__init__( self, model_details=self.model_details, device_id=device_id, host=host, local_key=local_key, timeout=timeout, ping_interval=ping_interval, update_entity_state=update_entity_state, version=protocol_version, port=port, )","title":"For Model Definitions"},{"location":"PROTOCOL_35_SUPPORT/#troubleshooting","text":"","title":"Troubleshooting"},{"location":"PROTOCOL_35_SUPPORT/#hmac-verification-failed","text":"This error indicates: Wrong local key Protocol version mismatch Corrupted message Solution: Verify the local key and protocol version for your device.","title":"\"HMAC verification failed\""},{"location":"PROTOCOL_35_SUPPORT/#incomplete-read-errors","text":"For devices that previously had incomplete read errors (like T2276), upgrading to protocol 3.5 should resolve the issue. Steps: Add protocol_version = (3, 5) to the model file Update RoboVac.__init__() to use the protocol version Test with your device","title":"\"Incomplete read\" errors"},{"location":"PROTOCOL_35_SUPPORT/#determining-protocol-version","text":"To find the correct protocol version for your device: Check device documentation - Newer devices typically use 3.4+ Try incrementally: Start with 3.3 (most common) If incomplete reads occur, try 3.4 If still issues, try 3.5 Check logs - Look for authentication or checksum errors","title":"Determining Protocol Version"},{"location":"PROTOCOL_35_SUPPORT/#testing","text":"All protocol versions are tested with the existing test suite: task test The implementation maintains backward compatibility, so existing devices using protocols 3.1-3.3 continue to work without changes.","title":"Testing"},{"location":"PROTOCOL_35_SUPPORT/#references","text":"TinyTuya Protocol Documentation Tuya IoT Protocol Issue #42: X8 Pro SES incomplete read errors","title":"References"},{"location":"PYTUYA_MIGRATION_PLAN/","text":"PyTuya Migration Plan \u00b6 Goal \u00b6 Replace custom tuyalocalapi.py implementation with LocalTuya's battle-tested pytuya module to support Tuya protocol versions 3.1-3.5. Why Migrate? \u00b6 T2276 (X8 Pro SES) requires protocol 3.5 - current implementation only supports 3.1 Future-proof - supports all protocol versions as Tuya evolves Community maintained - actively developed by LocalTuya team Production proven - used by thousands of users Better maintenance - we don't have to maintain protocol implementation Source \u00b6 LocalTuya PyTuya: https://github.com/rospogrigio/localtuya/tree/master/custom_components/localtuya/pytuya Migration Steps \u00b6 Phase 1: Integration (Low Risk) \u00b6 Download PyTuya module Copy pytuya/__init__.py from LocalTuya Place in custom_components/robovac/pytuya/ Maintain as separate module initially Update dependencies Already have cryptography - no new dependencies needed Verify version compatibility Create wrapper/adapter layer Map our API to PyTuya API Minimize changes to existing code initially Phase 2: Gradual Migration (Medium Risk) \u00b6 Update robovac.py Replace TuyaDevice imports with PyTuya Update initialization to use PyTuya API Set protocol version per model Update model configurations Add protocol_version attribute to models Default to 3.1 for existing models Set 3.5 for T2276 Update vacuum.py Adjust for any API differences Update status polling logic Update command sending logic Phase 3: Testing (Critical) \u00b6 Test T2276 specifically Verify protocol 3.5 communication works Confirm \"Incomplete read\" errors are resolved Test all commands (start, stop, return home, etc.) Regression test existing models Test at least 3 different model types Verify protocol 3.1 still works Ensure no breaking changes Run full test suite All 196 tests must pass Add new tests for protocol version selection Test error handling Phase 4: Cleanup (Low Risk) \u00b6 Remove old implementation Delete tuyalocalapi.py if fully replaced Or keep as fallback initially Clean up unused code Update documentation Update README with PyTuya attribution Update DEVELOPMENT.md Document protocol version configuration Final verification Lint and type-check pass All tests pass Documentation complete API Mapping \u00b6 Current API (TuyaDevice) \u00b6 device = TuyaDevice(dev_id, address, local_key, version=3.1) await device.status() await device.set_dp(value, dp_index) PyTuya API \u00b6 device = TuyaInterface(dev_id, address, local_key) device.set_version(3.5) # New capability! status = await device.status() await device.set_dp(value, dp_index) Key Differences \u00b6 Protocol version setting : Old: Fixed at initialization New: Can be set with set_version() Error handling : PyTuya has more detailed error codes Need to map to our error handling Async handling : PyTuya is fully async Should integrate smoothly with our async code Rollback Plan \u00b6 If migration fails: Revert to previous commit Keep T2276 marked as unsupported Document issues encountered Consider hybrid approach (PyTuya only for T2276) Success Criteria \u00b6 \u2705 T2276 works without \"Incomplete read\" errors \u2705 All existing models continue working \u2705 All 196 tests pass \u2705 No regressions in functionality \u2705 Code quality maintained (lint, type-check) Timeline \u00b6 Phase 1 : 2-3 hours (integration) Phase 2 : 3-4 hours (migration) Phase 3 : 2-3 hours (testing) Phase 4 : 1-2 hours (cleanup) Total : 8-12 hours of work Risk Assessment \u00b6 Risk Probability Impact Mitigation Breaking existing models Medium High Thorough testing, gradual rollout API incompatibility Low Medium Adapter layer, careful mapping Performance issues Low Low PyTuya is proven in production New bugs Medium Medium Comprehensive test coverage Notes \u00b6 Keep existing implementation initially as fallback Test with real devices if possible (ask users) Monitor GitHub issues for similar migrations Consider releasing as beta first References \u00b6 LocalTuya: https://github.com/rospogrigio/localtuya PyTuya module: https://github.com/rospogrigio/localtuya/tree/master/custom_components/localtuya/pytuya Kevin's fork (working T2276): https://github.com/kevinbird15/robovac-ha-integration/blob/purgatory Issue #42: https://github.com/damacus/robovac/issues/42","title":"PyTuya Migration Plan"},{"location":"PYTUYA_MIGRATION_PLAN/#pytuya-migration-plan","text":"","title":"PyTuya Migration Plan"},{"location":"PYTUYA_MIGRATION_PLAN/#goal","text":"Replace custom tuyalocalapi.py implementation with LocalTuya's battle-tested pytuya module to support Tuya protocol versions 3.1-3.5.","title":"Goal"},{"location":"PYTUYA_MIGRATION_PLAN/#why-migrate","text":"T2276 (X8 Pro SES) requires protocol 3.5 - current implementation only supports 3.1 Future-proof - supports all protocol versions as Tuya evolves Community maintained - actively developed by LocalTuya team Production proven - used by thousands of users Better maintenance - we don't have to maintain protocol implementation","title":"Why Migrate?"},{"location":"PYTUYA_MIGRATION_PLAN/#source","text":"LocalTuya PyTuya: https://github.com/rospogrigio/localtuya/tree/master/custom_components/localtuya/pytuya","title":"Source"},{"location":"PYTUYA_MIGRATION_PLAN/#migration-steps","text":"","title":"Migration Steps"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-1-integration-low-risk","text":"Download PyTuya module Copy pytuya/__init__.py from LocalTuya Place in custom_components/robovac/pytuya/ Maintain as separate module initially Update dependencies Already have cryptography - no new dependencies needed Verify version compatibility Create wrapper/adapter layer Map our API to PyTuya API Minimize changes to existing code initially","title":"Phase 1: Integration (Low Risk)"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-2-gradual-migration-medium-risk","text":"Update robovac.py Replace TuyaDevice imports with PyTuya Update initialization to use PyTuya API Set protocol version per model Update model configurations Add protocol_version attribute to models Default to 3.1 for existing models Set 3.5 for T2276 Update vacuum.py Adjust for any API differences Update status polling logic Update command sending logic","title":"Phase 2: Gradual Migration (Medium Risk)"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-3-testing-critical","text":"Test T2276 specifically Verify protocol 3.5 communication works Confirm \"Incomplete read\" errors are resolved Test all commands (start, stop, return home, etc.) Regression test existing models Test at least 3 different model types Verify protocol 3.1 still works Ensure no breaking changes Run full test suite All 196 tests must pass Add new tests for protocol version selection Test error handling","title":"Phase 3: Testing (Critical)"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-4-cleanup-low-risk","text":"Remove old implementation Delete tuyalocalapi.py if fully replaced Or keep as fallback initially Clean up unused code Update documentation Update README with PyTuya attribution Update DEVELOPMENT.md Document protocol version configuration Final verification Lint and type-check pass All tests pass Documentation complete","title":"Phase 4: Cleanup (Low Risk)"},{"location":"PYTUYA_MIGRATION_PLAN/#api-mapping","text":"","title":"API Mapping"},{"location":"PYTUYA_MIGRATION_PLAN/#current-api-tuyadevice","text":"device = TuyaDevice(dev_id, address, local_key, version=3.1) await device.status() await device.set_dp(value, dp_index)","title":"Current API (TuyaDevice)"},{"location":"PYTUYA_MIGRATION_PLAN/#pytuya-api","text":"device = TuyaInterface(dev_id, address, local_key) device.set_version(3.5) # New capability! status = await device.status() await device.set_dp(value, dp_index)","title":"PyTuya API"},{"location":"PYTUYA_MIGRATION_PLAN/#key-differences","text":"Protocol version setting : Old: Fixed at initialization New: Can be set with set_version() Error handling : PyTuya has more detailed error codes Need to map to our error handling Async handling : PyTuya is fully async Should integrate smoothly with our async code","title":"Key Differences"},{"location":"PYTUYA_MIGRATION_PLAN/#rollback-plan","text":"If migration fails: Revert to previous commit Keep T2276 marked as unsupported Document issues encountered Consider hybrid approach (PyTuya only for T2276)","title":"Rollback Plan"},{"location":"PYTUYA_MIGRATION_PLAN/#success-criteria","text":"\u2705 T2276 works without \"Incomplete read\" errors \u2705 All existing models continue working \u2705 All 196 tests pass \u2705 No regressions in functionality \u2705 Code quality maintained (lint, type-check)","title":"Success Criteria"},{"location":"PYTUYA_MIGRATION_PLAN/#timeline","text":"Phase 1 : 2-3 hours (integration) Phase 2 : 3-4 hours (migration) Phase 3 : 2-3 hours (testing) Phase 4 : 1-2 hours (cleanup) Total : 8-12 hours of work","title":"Timeline"},{"location":"PYTUYA_MIGRATION_PLAN/#risk-assessment","text":"Risk Probability Impact Mitigation Breaking existing models Medium High Thorough testing, gradual rollout API incompatibility Low Medium Adapter layer, careful mapping Performance issues Low Low PyTuya is proven in production New bugs Medium Medium Comprehensive test coverage","title":"Risk Assessment"},{"location":"PYTUYA_MIGRATION_PLAN/#notes","text":"Keep existing implementation initially as fallback Test with real devices if possible (ask users) Monitor GitHub issues for similar migrations Consider releasing as beta first","title":"Notes"},{"location":"PYTUYA_MIGRATION_PLAN/#references","text":"LocalTuya: https://github.com/rospogrigio/localtuya PyTuya module: https://github.com/rospogrigio/localtuya/tree/master/custom_components/localtuya/pytuya Kevin's fork (working T2276): https://github.com/kevinbird15/robovac-ha-integration/blob/purgatory Issue #42: https://github.com/damacus/robovac/issues/42","title":"References"},{"location":"development/","text":"Development Guide \u00b6 This document provides guidance for developers working on the RoboVac integration. Project Structure \u00b6 custom_components/robovac/ \u251c\u2500\u2500 __init__.py # Integration initialization \u251c\u2500\u2500 config_flow.py # Configuration flow for setup \u251c\u2500\u2500 robovac.py # Core RoboVac class with command logic \u251c\u2500\u2500 vacuum.py # Home Assistant vacuum entity \u251c\u2500\u2500 sensor.py # Sensor entities \u251c\u2500\u2500 tuyalocalapi.py # Tuya device communication \u251c\u2500\u2500 tuyalocaldiscovery.py # Device discovery \u251c\u2500\u2500 vacuums/ \u2502 \u251c\u2500\u2500 base.py # Base classes and enums \u2502 \u251c\u2500\u2500 T2250.py through T2262.py # Model-specific command mappings \u2502 \u2514\u2500\u2500 ... (other models) \u2514\u2500\u2500 strings.json # Localization strings tests/ \u251c\u2500\u2500 test_vacuum/ \u2502 \u251c\u2500\u2500 test_t2251_command_mappings.py # Model-specific tests \u2502 \u251c\u2500\u2500 test_get_robovac_human_readable_value.py \u2502 \u251c\u2500\u2500 test_get_robovac_command_value.py \u2502 \u2514\u2500\u2500 ... (other tests) \u2514\u2500\u2500 conftest.py # Pytest configuration and fixtures Key Concepts \u00b6 Command Mappings \u00b6 Each vacuum model defines command mappings in vacuums/T*.py files. These mappings translate between: Device codes : Numeric DPS codes used by the Tuya protocol Command names : Enum values like RobovacCommand.MODE , RobovacCommand.FAN_SPEED Command values : User-friendly strings like \"auto\" , \"turbo\" , \"Standard\" Example structure: RobovacCommand.MODE: { \"code\": 5, # DPS code for this command \"values\": { \"auto\": \"Auto\", # Key: input value, Value: output value \"small_room\": \"SmallRoom\", \"spot\": \"Spot\", }, }, Naming Conventions \u00b6 Keys (input values): Lowercase snake_case (e.g., \"auto\" , \"small_room\" ) Values (output values): PascalCase (e.g., \"Auto\" , \"SmallRoom\" ) Case-insensitive matching : Device responses are matched case-insensitively Case-Insensitive Matching \u00b6 Device responses are matched case-insensitively, so \"AUTO\" , \"auto\" , and \"Auto\" all map to the same value. This eliminates the need for duplicate bidirectional mappings and simplifies the command mapping definitions. Development Workflow \u00b6 Setting Up Development Environment \u00b6 Clone the repository Install dependencies: pip install -r requirements.txt Install development dependencies: pip install -r requirements-dev.txt Run tests to verify setup: task test Running Tests \u00b6 # Run all tests task test # Run specific test file pytest tests/test_vacuum/test_t2251_command_mappings.py -v # Run with coverage task test # Already includes coverage report # Run tests matching a pattern pytest tests/test_vacuum/ -k \"mode\" -v Code Quality Checks \u00b6 # Check code style and formatting task lint # Verify type hints task type-check # Both lint and type-check task lint && task type-check Markdown Documentation \u00b6 # Check markdown formatting task markdownlint # Fix markdown issues task markdownlint --fix Adding a New Vacuum Model \u00b6 1. Create Model File \u00b6 Create custom_components/robovac/vacuums/TXXX.py : \"\"\"Model name (TXXX)\"\"\" from homeassistant.components.vacuum import VacuumEntityFeature from .base import RoboVacEntityFeature, RobovacCommand, RobovacModelDetails class TXXX(RobovacModelDetails): homeassistant_features = ( VacuumEntityFeature.BATTERY | VacuumEntityFeature.START | VacuumEntityFeature.STOP | VacuumEntityFeature.PAUSE | VacuumEntityFeature.RETURN_HOME | VacuumEntityFeature.FAN_SPEED | VacuumEntityFeature.LOCATE ) robovac_features = ( RoboVacEntityFeature.CLEANING_TIME | RoboVacEntityFeature.CLEANING_AREA ) commands = { RobovacCommand.START_PAUSE: { \"code\": 2, }, RobovacCommand.MODE: { \"code\": 5, \"values\": { \"auto\": \"Auto\", \"small_room\": \"SmallRoom\", }, }, # ... other commands } 2. Register Model \u00b6 Add to custom_components/robovac/vacuums/__init__.py : from .TXXX import TXXX ROBOVAC_MODELS = { # ... existing models \"TXXX\": TXXX, } 3. Create Tests \u00b6 Create tests/test_vacuum/test_txxx_command_mappings.py : \"\"\"Tests for TXXX command mappings.\"\"\" import pytest from unittest.mock import patch from custom_components.robovac.robovac import RoboVac from custom_components.robovac.vacuums.base import RobovacCommand @pytest.fixture def mock_txxx_robovac(): \"\"\"Create a mock TXXX RoboVac instance for testing.\"\"\" with patch(\"custom_components.robovac.robovac.TuyaDevice.__init__\", return_value=None): robovac = RoboVac( model_code=\"TXXX\", device_id=\"test_id\", host=\"192.168.1.100\", local_key=\"test_key\", ) return robovac def test_txxx_model_has_required_commands(mock_txxx_robovac): \"\"\"Test that TXXX model has required commands defined.\"\"\" commands = mock_txxx_robovac.model_details.commands assert RobovacCommand.MODE in commands assert RobovacCommand.FAN_SPEED in commands # ... other assertions Logging Strategy \u00b6 Log Levels \u00b6 DEBUG : Diagnostic information for troubleshooting (e.g., value lookups, state changes) INFO : General informational messages (e.g., \"Data points now available\") WARNING : Actual problems that need attention (e.g., initialization failures, update failures) ERROR : Serious errors (e.g., vacuum not initialized for critical operations) Examples \u00b6 # DEBUG: Diagnostic information _LOGGER.debug(\"Successfully updated vacuum %s\", self._attr_name) # WARNING: Actual problem _LOGGER.warning(\"Cannot update vacuum %s: IP address not set\", self._attr_name) # ERROR: Serious issue _LOGGER.error(\"Cannot locate vacuum: vacuum not initialized\") Testing Best Practices \u00b6 Test Structure \u00b6 Follow the pattern from test_t2251_command_mappings.py : Create a fixture for the mock RoboVac instance Test command value mappings Test case-insensitive matching Test model structure (commands present) Test Coverage \u00b6 Aim for 100% coverage of modified code Test both success and failure paths Use mocking to isolate units under test Follow TDD: write tests before implementation Run task test to verify coverage Running Tests with Coverage \u00b6 # View coverage report task test # Generate HTML coverage report pytest --cov=custom_components.robovac --cov-report=html Commit Guidelines \u00b6 Follow Conventional Commits : feat: New feature fix: Bug fix refactor: Code refactoring without behavior change test: Adding or updating tests docs: Documentation updates chore: Maintenance tasks Examples: feat: add T2250 command mappings fix: handle \"No error\" status correctly test: add T2251 command mapping tests refactor: improve value lookup logic docs: update development guide Common Tasks \u00b6 Debugging a Failing Test \u00b6 # Run with verbose output pytest tests/test_vacuum/test_t2251_command_mappings.py -v -s # Run with pdb debugger pytest tests/test_vacuum/test_t2251_command_mappings.py --pdb # Run specific test pytest tests/test_vacuum/test_t2251_command_mappings.py::test_t2251_mode_has_values -v Checking Type Hints \u00b6 # Run type checker task type-check # Check specific file mypy custom_components/robovac/robovac.py Formatting Code \u00b6 # Run linter task lint # Auto-fix formatting issues black custom_components/robovac/ Resources \u00b6 Home Assistant Developer Documentation Tuya Local API Documentation Pytest Documentation Python Type Hints Getting Help \u00b6 Check existing issues and PRs Review the troubleshooting guide Enable debug logging to diagnose issues Create detailed issue reports with logs","title":"Development Workflow"},{"location":"development/#development-guide","text":"This document provides guidance for developers working on the RoboVac integration.","title":"Development Guide"},{"location":"development/#project-structure","text":"custom_components/robovac/ \u251c\u2500\u2500 __init__.py # Integration initialization \u251c\u2500\u2500 config_flow.py # Configuration flow for setup \u251c\u2500\u2500 robovac.py # Core RoboVac class with command logic \u251c\u2500\u2500 vacuum.py # Home Assistant vacuum entity \u251c\u2500\u2500 sensor.py # Sensor entities \u251c\u2500\u2500 tuyalocalapi.py # Tuya device communication \u251c\u2500\u2500 tuyalocaldiscovery.py # Device discovery \u251c\u2500\u2500 vacuums/ \u2502 \u251c\u2500\u2500 base.py # Base classes and enums \u2502 \u251c\u2500\u2500 T2250.py through T2262.py # Model-specific command mappings \u2502 \u2514\u2500\u2500 ... (other models) \u2514\u2500\u2500 strings.json # Localization strings tests/ \u251c\u2500\u2500 test_vacuum/ \u2502 \u251c\u2500\u2500 test_t2251_command_mappings.py # Model-specific tests \u2502 \u251c\u2500\u2500 test_get_robovac_human_readable_value.py \u2502 \u251c\u2500\u2500 test_get_robovac_command_value.py \u2502 \u2514\u2500\u2500 ... (other tests) \u2514\u2500\u2500 conftest.py # Pytest configuration and fixtures","title":"Project Structure"},{"location":"development/#key-concepts","text":"","title":"Key Concepts"},{"location":"development/#command-mappings","text":"Each vacuum model defines command mappings in vacuums/T*.py files. These mappings translate between: Device codes : Numeric DPS codes used by the Tuya protocol Command names : Enum values like RobovacCommand.MODE , RobovacCommand.FAN_SPEED Command values : User-friendly strings like \"auto\" , \"turbo\" , \"Standard\" Example structure: RobovacCommand.MODE: { \"code\": 5, # DPS code for this command \"values\": { \"auto\": \"Auto\", # Key: input value, Value: output value \"small_room\": \"SmallRoom\", \"spot\": \"Spot\", }, },","title":"Command Mappings"},{"location":"development/#naming-conventions","text":"Keys (input values): Lowercase snake_case (e.g., \"auto\" , \"small_room\" ) Values (output values): PascalCase (e.g., \"Auto\" , \"SmallRoom\" ) Case-insensitive matching : Device responses are matched case-insensitively","title":"Naming Conventions"},{"location":"development/#case-insensitive-matching","text":"Device responses are matched case-insensitively, so \"AUTO\" , \"auto\" , and \"Auto\" all map to the same value. This eliminates the need for duplicate bidirectional mappings and simplifies the command mapping definitions.","title":"Case-Insensitive Matching"},{"location":"development/#development-workflow","text":"","title":"Development Workflow"},{"location":"development/#setting-up-development-environment","text":"Clone the repository Install dependencies: pip install -r requirements.txt Install development dependencies: pip install -r requirements-dev.txt Run tests to verify setup: task test","title":"Setting Up Development Environment"},{"location":"development/#running-tests","text":"# Run all tests task test # Run specific test file pytest tests/test_vacuum/test_t2251_command_mappings.py -v # Run with coverage task test # Already includes coverage report # Run tests matching a pattern pytest tests/test_vacuum/ -k \"mode\" -v","title":"Running Tests"},{"location":"development/#code-quality-checks","text":"# Check code style and formatting task lint # Verify type hints task type-check # Both lint and type-check task lint && task type-check","title":"Code Quality Checks"},{"location":"development/#markdown-documentation","text":"# Check markdown formatting task markdownlint # Fix markdown issues task markdownlint --fix","title":"Markdown Documentation"},{"location":"development/#adding-a-new-vacuum-model","text":"","title":"Adding a New Vacuum Model"},{"location":"development/#1-create-model-file","text":"Create custom_components/robovac/vacuums/TXXX.py : \"\"\"Model name (TXXX)\"\"\" from homeassistant.components.vacuum import VacuumEntityFeature from .base import RoboVacEntityFeature, RobovacCommand, RobovacModelDetails class TXXX(RobovacModelDetails): homeassistant_features = ( VacuumEntityFeature.BATTERY | VacuumEntityFeature.START | VacuumEntityFeature.STOP | VacuumEntityFeature.PAUSE | VacuumEntityFeature.RETURN_HOME | VacuumEntityFeature.FAN_SPEED | VacuumEntityFeature.LOCATE ) robovac_features = ( RoboVacEntityFeature.CLEANING_TIME | RoboVacEntityFeature.CLEANING_AREA ) commands = { RobovacCommand.START_PAUSE: { \"code\": 2, }, RobovacCommand.MODE: { \"code\": 5, \"values\": { \"auto\": \"Auto\", \"small_room\": \"SmallRoom\", }, }, # ... other commands }","title":"1. Create Model File"},{"location":"development/#2-register-model","text":"Add to custom_components/robovac/vacuums/__init__.py : from .TXXX import TXXX ROBOVAC_MODELS = { # ... existing models \"TXXX\": TXXX, }","title":"2. Register Model"},{"location":"development/#3-create-tests","text":"Create tests/test_vacuum/test_txxx_command_mappings.py : \"\"\"Tests for TXXX command mappings.\"\"\" import pytest from unittest.mock import patch from custom_components.robovac.robovac import RoboVac from custom_components.robovac.vacuums.base import RobovacCommand @pytest.fixture def mock_txxx_robovac(): \"\"\"Create a mock TXXX RoboVac instance for testing.\"\"\" with patch(\"custom_components.robovac.robovac.TuyaDevice.__init__\", return_value=None): robovac = RoboVac( model_code=\"TXXX\", device_id=\"test_id\", host=\"192.168.1.100\", local_key=\"test_key\", ) return robovac def test_txxx_model_has_required_commands(mock_txxx_robovac): \"\"\"Test that TXXX model has required commands defined.\"\"\" commands = mock_txxx_robovac.model_details.commands assert RobovacCommand.MODE in commands assert RobovacCommand.FAN_SPEED in commands # ... other assertions","title":"3. Create Tests"},{"location":"development/#logging-strategy","text":"","title":"Logging Strategy"},{"location":"development/#log-levels","text":"DEBUG : Diagnostic information for troubleshooting (e.g., value lookups, state changes) INFO : General informational messages (e.g., \"Data points now available\") WARNING : Actual problems that need attention (e.g., initialization failures, update failures) ERROR : Serious errors (e.g., vacuum not initialized for critical operations)","title":"Log Levels"},{"location":"development/#examples","text":"# DEBUG: Diagnostic information _LOGGER.debug(\"Successfully updated vacuum %s\", self._attr_name) # WARNING: Actual problem _LOGGER.warning(\"Cannot update vacuum %s: IP address not set\", self._attr_name) # ERROR: Serious issue _LOGGER.error(\"Cannot locate vacuum: vacuum not initialized\")","title":"Examples"},{"location":"development/#testing-best-practices","text":"","title":"Testing Best Practices"},{"location":"development/#test-structure","text":"Follow the pattern from test_t2251_command_mappings.py : Create a fixture for the mock RoboVac instance Test command value mappings Test case-insensitive matching Test model structure (commands present)","title":"Test Structure"},{"location":"development/#test-coverage","text":"Aim for 100% coverage of modified code Test both success and failure paths Use mocking to isolate units under test Follow TDD: write tests before implementation Run task test to verify coverage","title":"Test Coverage"},{"location":"development/#running-tests-with-coverage","text":"# View coverage report task test # Generate HTML coverage report pytest --cov=custom_components.robovac --cov-report=html","title":"Running Tests with Coverage"},{"location":"development/#commit-guidelines","text":"Follow Conventional Commits : feat: New feature fix: Bug fix refactor: Code refactoring without behavior change test: Adding or updating tests docs: Documentation updates chore: Maintenance tasks Examples: feat: add T2250 command mappings fix: handle \"No error\" status correctly test: add T2251 command mapping tests refactor: improve value lookup logic docs: update development guide","title":"Commit Guidelines"},{"location":"development/#common-tasks","text":"","title":"Common Tasks"},{"location":"development/#debugging-a-failing-test","text":"# Run with verbose output pytest tests/test_vacuum/test_t2251_command_mappings.py -v -s # Run with pdb debugger pytest tests/test_vacuum/test_t2251_command_mappings.py --pdb # Run specific test pytest tests/test_vacuum/test_t2251_command_mappings.py::test_t2251_mode_has_values -v","title":"Debugging a Failing Test"},{"location":"development/#checking-type-hints","text":"# Run type checker task type-check # Check specific file mypy custom_components/robovac/robovac.py","title":"Checking Type Hints"},{"location":"development/#formatting-code","text":"# Run linter task lint # Auto-fix formatting issues black custom_components/robovac/","title":"Formatting Code"},{"location":"development/#resources","text":"Home Assistant Developer Documentation Tuya Local API Documentation Pytest Documentation Python Type Hints","title":"Resources"},{"location":"development/#getting-help","text":"Check existing issues and PRs Review the troubleshooting guide Enable debug logging to diagnose issues Create detailed issue reports with logs","title":"Getting Help"},{"location":"dps_codes/","text":"Understanding and Working with DPS Codes \u00b6 What is a DPS Code? \u00b6 DPS (Data Point Specification) codes are numeric identifiers used in Tuya-based devices like Eufy RoboVacs to control various functions and retrieve device states. Each DPS code maps to a specific function or feature of your vacuum, such as: Battery level Cleaning mode Fan speed Error status Cleaning area Cleaning time In the RoboVac integration, these codes are used to communicate with your vacuum via the Tuya local API. Think of them as the language that allows Home Assistant to talk to your vacuum. How to Find DPS Codes for Your Device \u00b6 Finding the correct DPS codes for your vacuum model is essential for adding support for new devices. Here are methods to discover these codes: Method 1: Use the Model DPS Analysis Tool \u00b6 The repository includes a test that analyzes DPS codes for all supported models: Navigate to the tests/test_vacuum/test_model_dps_analysis.py file (or run analyze_model_dps.py in the root directory). Run this script to generate a report showing: Which models use default codes Which models use custom codes What specific custom codes are used by each model This can help you understand patterns in how different models use DPS codes. Method 2: Enable Debug Logging \u00b6 Enable debug logging for the RoboVac component in your Home Assistant configuration: yaml logger: default: info logs: custom_components.robovac: debug Restart Home Assistant and monitor the logs while operating your vacuum. Look for log entries showing \"Updating entity values from data points: ...\" which will display all the DPS codes and values being reported by your device. Method 3: Analyze Network Traffic (Advanced) \u00b6 For more advanced users: Use a tool like Wireshark to capture traffic between your Home Assistant instance and your vacuum. Filter for traffic to/from your vacuum's IP address. Look for Tuya protocol messages, which contain DPS code information in their payload. Decode these messages to identify which DPS codes your vacuum is using and their functions. Method 4: External Tools \u00b6 If you're comfortable with Python, you can try these tools to capture raw device data: eufy-device-id-python - Gets device info from Eufy servers tinytuya scan - Scans local network for Tuya devices (after you have credentials) Adding Support for a New Device \u00b6 To add support for a new device, you'll need to: Determine your model code : This is typically the first 5 characters of the full model number. Identify required DPS codes : Using the methods above, determine which DPS codes your vacuum uses. Create a model-specific class : If your vacuum uses non-default DPS codes, you'll need to create a model-specific class in the custom_components/robovac/vacuums/ directory. Map commands to DPS codes : In your model class, create mappings between RoboVac commands and the DPS codes your vacuum uses. Example Implementation \u00b6 Here's a simplified example of how a model-specific class looks: from custom_components.robovac.vacuums.base import RobovacModelDetails, RoboVacEntityFeature, RobovacCommand class YourModel(RobovacModelDetails): \"\"\"Implementation for Your Specific Model.\"\"\" # Define which Home Assistant features this vacuum supports homeassistant_features = ( # Add relevant features here ) # Define which RoboVac features this vacuum supports robovac_features = ( # Add relevant features here ) # Map commands to DPS codes - override any that differ from defaults dps_codes = { \"BATTERY_LEVEL\": \"104\", # Example - use actual codes from your device \"STATUS\": \"15\", # Add other codes as needed } # Define available commands commands = { RobovacCommand.START_PAUSE: True, RobovacCommand.BATTERY: True, # Add other commands as appropriate }","title":"Getting DPS Codes"},{"location":"dps_codes/#understanding-and-working-with-dps-codes","text":"","title":"Understanding and Working with DPS Codes"},{"location":"dps_codes/#what-is-a-dps-code","text":"DPS (Data Point Specification) codes are numeric identifiers used in Tuya-based devices like Eufy RoboVacs to control various functions and retrieve device states. Each DPS code maps to a specific function or feature of your vacuum, such as: Battery level Cleaning mode Fan speed Error status Cleaning area Cleaning time In the RoboVac integration, these codes are used to communicate with your vacuum via the Tuya local API. Think of them as the language that allows Home Assistant to talk to your vacuum.","title":"What is a DPS Code?"},{"location":"dps_codes/#how-to-find-dps-codes-for-your-device","text":"Finding the correct DPS codes for your vacuum model is essential for adding support for new devices. Here are methods to discover these codes:","title":"How to Find DPS Codes for Your Device"},{"location":"dps_codes/#method-1-use-the-model-dps-analysis-tool","text":"The repository includes a test that analyzes DPS codes for all supported models: Navigate to the tests/test_vacuum/test_model_dps_analysis.py file (or run analyze_model_dps.py in the root directory). Run this script to generate a report showing: Which models use default codes Which models use custom codes What specific custom codes are used by each model This can help you understand patterns in how different models use DPS codes.","title":"Method 1: Use the Model DPS Analysis Tool"},{"location":"dps_codes/#method-2-enable-debug-logging","text":"Enable debug logging for the RoboVac component in your Home Assistant configuration: yaml logger: default: info logs: custom_components.robovac: debug Restart Home Assistant and monitor the logs while operating your vacuum. Look for log entries showing \"Updating entity values from data points: ...\" which will display all the DPS codes and values being reported by your device.","title":"Method 2: Enable Debug Logging"},{"location":"dps_codes/#method-3-analyze-network-traffic-advanced","text":"For more advanced users: Use a tool like Wireshark to capture traffic between your Home Assistant instance and your vacuum. Filter for traffic to/from your vacuum's IP address. Look for Tuya protocol messages, which contain DPS code information in their payload. Decode these messages to identify which DPS codes your vacuum is using and their functions.","title":"Method 3: Analyze Network Traffic (Advanced)"},{"location":"dps_codes/#method-4-external-tools","text":"If you're comfortable with Python, you can try these tools to capture raw device data: eufy-device-id-python - Gets device info from Eufy servers tinytuya scan - Scans local network for Tuya devices (after you have credentials)","title":"Method 4: External Tools"},{"location":"dps_codes/#adding-support-for-a-new-device","text":"To add support for a new device, you'll need to: Determine your model code : This is typically the first 5 characters of the full model number. Identify required DPS codes : Using the methods above, determine which DPS codes your vacuum uses. Create a model-specific class : If your vacuum uses non-default DPS codes, you'll need to create a model-specific class in the custom_components/robovac/vacuums/ directory. Map commands to DPS codes : In your model class, create mappings between RoboVac commands and the DPS codes your vacuum uses.","title":"Adding Support for a New Device"},{"location":"dps_codes/#example-implementation","text":"Here's a simplified example of how a model-specific class looks: from custom_components.robovac.vacuums.base import RobovacModelDetails, RoboVacEntityFeature, RobovacCommand class YourModel(RobovacModelDetails): \"\"\"Implementation for Your Specific Model.\"\"\" # Define which Home Assistant features this vacuum supports homeassistant_features = ( # Add relevant features here ) # Define which RoboVac features this vacuum supports robovac_features = ( # Add relevant features here ) # Map commands to DPS codes - override any that differ from defaults dps_codes = { \"BATTERY_LEVEL\": \"104\", # Example - use actual codes from your device \"STATUS\": \"15\", # Add other codes as needed } # Define available commands commands = { RobovacCommand.START_PAUSE: True, RobovacCommand.BATTERY: True, # Add other commands as appropriate }","title":"Example Implementation"},{"location":"troubleshooting/","text":"RoboVac Troubleshooting Guide \u00b6 This document provides solutions to common issues with the RoboVac integration. Table of Contents \u00b6 Understanding and Working with DPS Codes Common Connection Issues Feature Support Issues Understanding and Working with DPS Codes \u00b6 Please refer to the dedicated DPS Codes Guide for detailed information on what DPS codes are, how to find them, and how to use them to add support for new devices. Common Connection Issues \u00b6 Coming Soon \u00b6 This section will be expanded in the future. Feature Support Issues \u00b6 Coming Soon \u00b6 This section will be expanded in the future. Common Troubleshooting Tips \u00b6 Device not responding : Verify your IP address and access token are correct. Command not working : Check if the DPS code mapping is correct for that specific command. Values not updating : Ensure the DPS code for status information is correctly mapped.","title":"Troubleshooting"},{"location":"troubleshooting/#robovac-troubleshooting-guide","text":"This document provides solutions to common issues with the RoboVac integration.","title":"RoboVac Troubleshooting Guide"},{"location":"troubleshooting/#table-of-contents","text":"Understanding and Working with DPS Codes Common Connection Issues Feature Support Issues","title":"Table of Contents"},{"location":"troubleshooting/#understanding-and-working-with-dps-codes","text":"Please refer to the dedicated DPS Codes Guide for detailed information on what DPS codes are, how to find them, and how to use them to add support for new devices.","title":"Understanding and Working with DPS Codes"},{"location":"troubleshooting/#common-connection-issues","text":"","title":"Common Connection Issues"},{"location":"troubleshooting/#coming-soon","text":"This section will be expanded in the future.","title":"Coming Soon"},{"location":"troubleshooting/#feature-support-issues","text":"","title":"Feature Support Issues"},{"location":"troubleshooting/#coming-soon_1","text":"This section will be expanded in the future.","title":"Coming Soon"},{"location":"troubleshooting/#common-troubleshooting-tips","text":"Device not responding : Verify your IP address and access token are correct. Command not working : Check if the DPS code mapping is correct for that specific command. Values not updating : Ensure the DPS code for status information is correctly mapped.","title":"Common Troubleshooting Tips"},{"location":"archive/","text":"Archive \u00b6 This directory contains historical documentation from completed improvement initiatives. Contents \u00b6 IMPROVEMENT_PLAN.md - Complete analysis and 4-phase implementation plan for the RoboVac integration improvements (October 2025) NEXT_STEPS.md - Quick reference guide for the improvement plan phases Reference \u00b6 These documents are kept for historical reference and to understand the evolution of the codebase. For current development guidance, see the main Development Workflow section.","title":"Archive"},{"location":"archive/#archive","text":"This directory contains historical documentation from completed improvement initiatives.","title":"Archive"},{"location":"archive/#contents","text":"IMPROVEMENT_PLAN.md - Complete analysis and 4-phase implementation plan for the RoboVac integration improvements (October 2025) NEXT_STEPS.md - Quick reference guide for the improvement plan phases","title":"Contents"},{"location":"archive/#reference","text":"These documents are kept for historical reference and to understand the evolution of the codebase. For current development guidance, see the main Development Workflow section.","title":"Reference"},{"location":"archive/IMPROVEMENT_PLAN/","text":"Code Improvement Plan: more-mappings-work Branch \u00b6 Overview \u00b6 This document outlines improvements needed for the more-mappings-work branch changes, focusing on code quality, test coverage, maintainability, and consistency. Branch Summary \u00b6 Changes Made: Added case-insensitive matching in robovac.py getRoboVacHumanReadableValue() Enhanced error logging with detailed type and debug information Added error code mappings to 8 vacuum models (T2250-T2262 series) Added bidirectional mappings for device-to-human conversion Updated vacuum.py error checking to include \"No error\" string Added tests for case-insensitive matching behavior High Priority Issues \u00b6 1. Bidirectional Mapping Redundancy \u00b6 Problem: Current approach duplicates dictionary entries to handle both directions: \"values\": { \"auto\": \"Auto\", # Human-to-device \"Auto\": \"Auto\", # Bidirectional (redundant with case-insensitive) \"small_room\": \"SmallRoom\", \"SmallRoom\": \"SmallRoom\", } Impact: Code duplication violates DRY principle Maintenance burden (update in 2 places) Confusion about which mapping is canonical Unnecessary memory usage Solution: Remove bidirectional duplicates since case-insensitive matching handles this Establish single canonical format (lowercase snake_case for keys) Document that case-insensitive matching handles device responses Implementation Steps: Create test to verify case-insensitive matching works for all models Remove duplicate bidirectional mappings from T2250, T2252, T2253, T2254, T2255, T2259, T2262 Update documentation explaining mapping convention Verify tests pass Files Affected: vacuums/T2250.py , T2252.py , T2253.py , T2254.py , T2255.py , T2259.py , T2262.py 2. Inconsistent Value Mappings Across Models \u00b6 Problem: Different models use inconsistent capitalization for the same values: T2250: \"auto\": \"Auto\" , \"standard\": \"Standard\" T2252: \"Auto\": \"Auto\" , \"Standard\": \"Standard\" Impact: Confusing for maintainers Potential bugs when comparing across models Harder to write generic tests Solution: Standardize on lowercase snake_case for all mapping keys PascalCase for human-readable values Apply consistently across all 35+ vacuum models Implementation Steps: Audit all T2* model files for mapping consistency Create migration script if needed Update tests to verify consistency Document standard in contributing guide 3. Missing Tests for Modified Models \u00b6 Problem: Modified models (T2250-T2262 series) lack specific tests: No tests for error code mappings No tests for bidirectional MODE mappings No integration tests for case-insensitive behavior Impact: Changes unverified by tests (violates TDD) Regression risk Difficult to validate future changes Solution: Following TDD principles, create comprehensive tests: Test Files Needed: test_t2250_command_mappings.py test_t2251_command_mappings.py test_t2252_command_mappings.py test_t2253_command_mappings.py test_t2254_command_mappings.py test_t2255_command_mappings.py test_t2259_command_mappings.py test_t2262_command_mappings.py Each Test Should Cover: Error code mapping (0 -> \"No error\") MODE command mappings (all variants) FAN_SPEED mappings Case-insensitive matching Feature flag verification Template Structure (based on existing test_t2277_command_mappings.py ): \"\"\"Tests for T2XXX vacuum model commands.\"\"\" import pytest from custom_components.robovac.robovac import RoboVac from custom_components.robovac.vacuums.base import RobovacCommand @pytest.fixture def mock_t2xxx_robovac(): \"\"\"Create a T2XXX RoboVac instance for testing.\"\"\" # Use existing fixture pattern def test_error_code_mapping(mock_t2xxx_robovac): \"\"\"Test error code 0 maps to 'No error'.\"\"\" def test_mode_mappings(mock_t2xxx_robovac): \"\"\"Test MODE command accepts all expected values.\"\"\" def test_fan_speed_mappings(mock_t2xxx_robovac): \"\"\"Test FAN_SPEED command mappings.\"\"\" def test_case_insensitive_mode(mock_t2xxx_robovac): \"\"\"Test MODE accepts case-insensitive values.\"\"\" 4. Incomplete Error Code Mappings \u00b6 Problem: All modified models only define error code 0: RobovacCommand.ERROR: { \"code\": 106, \"values\": { \"0\": \"No error\", }, }, Impact: Users see numeric error codes instead of helpful messages Poor user experience Incomplete implementation Solution: Research actual error codes for each model from: Eufy app APK decompilation User reports Device logs Add comprehensive error mappings Document unknown errors with TODO comments Example Target: RobovacCommand.ERROR: { \"code\": 106, \"values\": { \"0\": \"No error\", \"1\": \"Wheel stuck\", \"2\": \"Side brush stuck\", \"3\": \"Suction motor stuck\", # TODO: Add more error codes as discovered }, }, 5. Warning Message Logic Improvement \u00b6 Problem: Current warning logs extensive debug info for every unmapped value: _LOGGER.warning( \"Command %s with value %r (type: %s, str=%r) not found for model %s. \" \"Available keys: %r (first key repr: %r). \" \"If you know the status...\", # 7 parameters ) Impact: Verbose logs for normal operation Difficult to read/filter Performance impact from repr() calls Solution: Use different log levels: DEBUG for detailed type/key info WARNING for actual issues Rate-limit warnings (already implemented elsewhere) Consolidate debug info Proposed: _LOGGER.debug( \"Unmapped value for %s: %r (type: %s). Available: %s\", command_name, value, type(value).__name__, list(values.keys())[:5] ) _LOGGER.warning( \"Command %s value %s not found for model %s. \" \"Please report this to maintainers with the status shown in Eufy app.\", command_name, value, self.model_code ) Medium Priority Issues \u00b6 6. Improve Type Hints \u00b6 Problem: Some functions lack complete type hints, especially around command value mappings. Solution: Add strict type hints to all public methods Use TypedDict for command structures Enable stricter mypy settings Files: robovac.py vacuum.py vacuums/base.py 7. Extract Case-Insensitive Lookup \u00b6 Problem: Case-insensitive lookup logic is inline and not reusable. Solution: Extract to utility function: def case_insensitive_dict_lookup( d: dict[str, str], key: str ) -> str | None: \"\"\"Case-insensitive dictionary lookup. Args: d: Dictionary to search key: Key to find (case-insensitive) Returns: Value if found, None otherwise \"\"\" # Try exact match first (O(1)) if key in d: return d[key] # Try case-insensitive (O(n)) key_lower = key.lower() for k, v in d.items(): if k.lower() == key_lower: return v return None Benefits: Testable in isolation Reusable Self-documenting Can add caching if needed 8. Add Integration Tests \u00b6 Problem: No tests verify the full flow from device value \u2192 human-readable \u2192 UI display. Solution: Add integration tests that: Mock device status update Verify getRoboVacHumanReadableValue() called correctly Verify vacuum entity state reflects human-readable value Test error state handling with new \"No error\" string 9. Consolidate Error Checking Logic \u00b6 Problem: vacuum.py checks multiple error conditions: elif ( self.error_code is not None and self.error_code not in [0, \"no_error\", \"No error\"] ): Impact: Hard to maintain Case-sensitivity issues Magic strings Solution: def is_error_state(error_code: Any) -> bool: \"\"\"Check if error code indicates an error state. Args: error_code: Error code from device Returns: True if error state, False otherwise \"\"\" if error_code is None or error_code == 0: return False # Handle string \"no error\" case-insensitively if isinstance(error_code, str) and error_code.lower() == \"no error\": return False return True Low Priority Issues \u00b6 10. Documentation Updates \u00b6 Needs: Update README with new case-insensitive behavior Document bidirectional mapping removal Add contributing guide section on command mappings Create error code discovery guide 11. Performance Optimization \u00b6 Potential Improvements: Cache case-insensitive lookups Pre-compute lowercase key mappings Profile frequently called methods Testing Strategy \u00b6 Test Execution \u00b6 Use task test (per memory) to run full test suite. Coverage Goals \u00b6 Maintain or improve current coverage 100% coverage for new/modified code Focus on edge cases (case variants, None values, unknown codes) Test Writing Guidelines \u00b6 Follow existing patterns in test_t2277_command_mappings.py Use descriptive test names Test both success and failure paths Don't test uncertain return values Use fixtures from conftest.py Implementation Order \u00b6 Phase 1: Critical Fixes (Week 1) \u00b6 Remove bidirectional mapping duplicates Standardize mapping conventions Extract case-insensitive lookup utility Phase 2: Test Coverage (Week 2) \u00b6 Create test files for T2250-T2262 models Add integration tests Verify 100% coverage for changes Phase 3: Enhancement (Week 3) - COMPLETE \u00b6 Improve logging strategy Changed value lookup failures from WARNING to DEBUG level Simplified debug message format for clarity Warnings now reserved for actual problems (initialization, update failures) Extract case-insensitive lookup utility Created case_insensitive_lookup.py module Refactored getRoboVacHumanReadableValue() to use utility Reduced code duplication and improved maintainability Updated tests to verify debug logging behavior Add comprehensive type hints Full type annotations in case_insensitive_lookup.py Type hints throughout core modules task type-check passing Phase 4: Polish (Week 4) - COMPLETE \u00b6 \u2705 Update documentation Updated README.md with Development section Created DEVELOPMENT.md with developer guide Removed unnecessary jargon (case_insensitive_lookup mentions) All markdown linting passes \u2705 Code cleanup Removed unused str_value variable All imports are used and necessary Consistent code style throughout No debug code remains \u2705 Final verification All 143 tests passing Type checking: Success (no issues found in 51 source files) Linting: All checks pass (0 errors) Success Criteria \u00b6 [x] All tests pass with task test (143 passed) [x] No duplicate bidirectional mappings [x] Consistent mapping conventions across all models [x] 100% test coverage for modified code [x] All 8 modified models have dedicated test files (7 created) [x] Type hints added with task type-check passing [x] Documentation updated (README.md, DEVELOPMENT.md) [x] No regression in existing functionality [x] Code cleanup complete (linting passes) [x] All markdown files pass linting Notes for Next Developer \u00b6 Key Files to Understand \u00b6 robovac.py - Core RoboVac class with command mapping logic vacuum.py - Home Assistant vacuum entity vacuums/base.py - Base classes and enums vacuums/T2*.py - Model-specific command mappings tests/test_vacuum/test_get_robovac_human_readable_value.py - Test patterns Running Tests \u00b6 # Run all tests task test # Run specific test file pytest tests/test_vacuum/test_t2250_command_mappings.py -v # Run with coverage task test # Already includes coverage Linting and Type Checking \u00b6 task lint task type-check Before Committing \u00b6 Run task test - ensure all tests pass Run task lint - fix any style issues Run task type-check - verify type hints Use conventional commit format: feat: , fix: , refactor: , test: Questions for Maintainer \u00b6 Error Code Research : What's the preferred method for discovering error codes? Breaking Changes : Is it acceptable to remove bidirectional mappings in a minor version? Backwards Compatibility : Should old hardcoded checks for \"no_error\" vs \"No error\" be maintained? Model Priority : Which models should get error code mappings first? Related Issues/PRs \u00b6 PR #161 - Original T2080 implementation with getRoboVacHumanReadableValue() Memory references T2277, T2278, T2320 recent additions CODE_COVERAGE_TODO.md (if exists) for broader testing strategy Document Version: 1.0 Created: 2025-10-21 Branch: more-mappings-work Author: Code Review Bot (Cascade)","title":"Code Improvement Plan: more-mappings-work Branch"},{"location":"archive/IMPROVEMENT_PLAN/#code-improvement-plan-more-mappings-work-branch","text":"","title":"Code Improvement Plan: more-mappings-work Branch"},{"location":"archive/IMPROVEMENT_PLAN/#overview","text":"This document outlines improvements needed for the more-mappings-work branch changes, focusing on code quality, test coverage, maintainability, and consistency.","title":"Overview"},{"location":"archive/IMPROVEMENT_PLAN/#branch-summary","text":"Changes Made: Added case-insensitive matching in robovac.py getRoboVacHumanReadableValue() Enhanced error logging with detailed type and debug information Added error code mappings to 8 vacuum models (T2250-T2262 series) Added bidirectional mappings for device-to-human conversion Updated vacuum.py error checking to include \"No error\" string Added tests for case-insensitive matching behavior","title":"Branch Summary"},{"location":"archive/IMPROVEMENT_PLAN/#high-priority-issues","text":"","title":"High Priority Issues"},{"location":"archive/IMPROVEMENT_PLAN/#1-bidirectional-mapping-redundancy","text":"Problem: Current approach duplicates dictionary entries to handle both directions: \"values\": { \"auto\": \"Auto\", # Human-to-device \"Auto\": \"Auto\", # Bidirectional (redundant with case-insensitive) \"small_room\": \"SmallRoom\", \"SmallRoom\": \"SmallRoom\", } Impact: Code duplication violates DRY principle Maintenance burden (update in 2 places) Confusion about which mapping is canonical Unnecessary memory usage Solution: Remove bidirectional duplicates since case-insensitive matching handles this Establish single canonical format (lowercase snake_case for keys) Document that case-insensitive matching handles device responses Implementation Steps: Create test to verify case-insensitive matching works for all models Remove duplicate bidirectional mappings from T2250, T2252, T2253, T2254, T2255, T2259, T2262 Update documentation explaining mapping convention Verify tests pass Files Affected: vacuums/T2250.py , T2252.py , T2253.py , T2254.py , T2255.py , T2259.py , T2262.py","title":"1. Bidirectional Mapping Redundancy"},{"location":"archive/IMPROVEMENT_PLAN/#2-inconsistent-value-mappings-across-models","text":"Problem: Different models use inconsistent capitalization for the same values: T2250: \"auto\": \"Auto\" , \"standard\": \"Standard\" T2252: \"Auto\": \"Auto\" , \"Standard\": \"Standard\" Impact: Confusing for maintainers Potential bugs when comparing across models Harder to write generic tests Solution: Standardize on lowercase snake_case for all mapping keys PascalCase for human-readable values Apply consistently across all 35+ vacuum models Implementation Steps: Audit all T2* model files for mapping consistency Create migration script if needed Update tests to verify consistency Document standard in contributing guide","title":"2. Inconsistent Value Mappings Across Models"},{"location":"archive/IMPROVEMENT_PLAN/#3-missing-tests-for-modified-models","text":"Problem: Modified models (T2250-T2262 series) lack specific tests: No tests for error code mappings No tests for bidirectional MODE mappings No integration tests for case-insensitive behavior Impact: Changes unverified by tests (violates TDD) Regression risk Difficult to validate future changes Solution: Following TDD principles, create comprehensive tests: Test Files Needed: test_t2250_command_mappings.py test_t2251_command_mappings.py test_t2252_command_mappings.py test_t2253_command_mappings.py test_t2254_command_mappings.py test_t2255_command_mappings.py test_t2259_command_mappings.py test_t2262_command_mappings.py Each Test Should Cover: Error code mapping (0 -> \"No error\") MODE command mappings (all variants) FAN_SPEED mappings Case-insensitive matching Feature flag verification Template Structure (based on existing test_t2277_command_mappings.py ): \"\"\"Tests for T2XXX vacuum model commands.\"\"\" import pytest from custom_components.robovac.robovac import RoboVac from custom_components.robovac.vacuums.base import RobovacCommand @pytest.fixture def mock_t2xxx_robovac(): \"\"\"Create a T2XXX RoboVac instance for testing.\"\"\" # Use existing fixture pattern def test_error_code_mapping(mock_t2xxx_robovac): \"\"\"Test error code 0 maps to 'No error'.\"\"\" def test_mode_mappings(mock_t2xxx_robovac): \"\"\"Test MODE command accepts all expected values.\"\"\" def test_fan_speed_mappings(mock_t2xxx_robovac): \"\"\"Test FAN_SPEED command mappings.\"\"\" def test_case_insensitive_mode(mock_t2xxx_robovac): \"\"\"Test MODE accepts case-insensitive values.\"\"\"","title":"3. Missing Tests for Modified Models"},{"location":"archive/IMPROVEMENT_PLAN/#4-incomplete-error-code-mappings","text":"Problem: All modified models only define error code 0: RobovacCommand.ERROR: { \"code\": 106, \"values\": { \"0\": \"No error\", }, }, Impact: Users see numeric error codes instead of helpful messages Poor user experience Incomplete implementation Solution: Research actual error codes for each model from: Eufy app APK decompilation User reports Device logs Add comprehensive error mappings Document unknown errors with TODO comments Example Target: RobovacCommand.ERROR: { \"code\": 106, \"values\": { \"0\": \"No error\", \"1\": \"Wheel stuck\", \"2\": \"Side brush stuck\", \"3\": \"Suction motor stuck\", # TODO: Add more error codes as discovered }, },","title":"4. Incomplete Error Code Mappings"},{"location":"archive/IMPROVEMENT_PLAN/#5-warning-message-logic-improvement","text":"Problem: Current warning logs extensive debug info for every unmapped value: _LOGGER.warning( \"Command %s with value %r (type: %s, str=%r) not found for model %s. \" \"Available keys: %r (first key repr: %r). \" \"If you know the status...\", # 7 parameters ) Impact: Verbose logs for normal operation Difficult to read/filter Performance impact from repr() calls Solution: Use different log levels: DEBUG for detailed type/key info WARNING for actual issues Rate-limit warnings (already implemented elsewhere) Consolidate debug info Proposed: _LOGGER.debug( \"Unmapped value for %s: %r (type: %s). Available: %s\", command_name, value, type(value).__name__, list(values.keys())[:5] ) _LOGGER.warning( \"Command %s value %s not found for model %s. \" \"Please report this to maintainers with the status shown in Eufy app.\", command_name, value, self.model_code )","title":"5. Warning Message Logic Improvement"},{"location":"archive/IMPROVEMENT_PLAN/#medium-priority-issues","text":"","title":"Medium Priority Issues"},{"location":"archive/IMPROVEMENT_PLAN/#6-improve-type-hints","text":"Problem: Some functions lack complete type hints, especially around command value mappings. Solution: Add strict type hints to all public methods Use TypedDict for command structures Enable stricter mypy settings Files: robovac.py vacuum.py vacuums/base.py","title":"6. Improve Type Hints"},{"location":"archive/IMPROVEMENT_PLAN/#7-extract-case-insensitive-lookup","text":"Problem: Case-insensitive lookup logic is inline and not reusable. Solution: Extract to utility function: def case_insensitive_dict_lookup( d: dict[str, str], key: str ) -> str | None: \"\"\"Case-insensitive dictionary lookup. Args: d: Dictionary to search key: Key to find (case-insensitive) Returns: Value if found, None otherwise \"\"\" # Try exact match first (O(1)) if key in d: return d[key] # Try case-insensitive (O(n)) key_lower = key.lower() for k, v in d.items(): if k.lower() == key_lower: return v return None Benefits: Testable in isolation Reusable Self-documenting Can add caching if needed","title":"7. Extract Case-Insensitive Lookup"},{"location":"archive/IMPROVEMENT_PLAN/#8-add-integration-tests","text":"Problem: No tests verify the full flow from device value \u2192 human-readable \u2192 UI display. Solution: Add integration tests that: Mock device status update Verify getRoboVacHumanReadableValue() called correctly Verify vacuum entity state reflects human-readable value Test error state handling with new \"No error\" string","title":"8. Add Integration Tests"},{"location":"archive/IMPROVEMENT_PLAN/#9-consolidate-error-checking-logic","text":"Problem: vacuum.py checks multiple error conditions: elif ( self.error_code is not None and self.error_code not in [0, \"no_error\", \"No error\"] ): Impact: Hard to maintain Case-sensitivity issues Magic strings Solution: def is_error_state(error_code: Any) -> bool: \"\"\"Check if error code indicates an error state. Args: error_code: Error code from device Returns: True if error state, False otherwise \"\"\" if error_code is None or error_code == 0: return False # Handle string \"no error\" case-insensitively if isinstance(error_code, str) and error_code.lower() == \"no error\": return False return True","title":"9. Consolidate Error Checking Logic"},{"location":"archive/IMPROVEMENT_PLAN/#low-priority-issues","text":"","title":"Low Priority Issues"},{"location":"archive/IMPROVEMENT_PLAN/#10-documentation-updates","text":"Needs: Update README with new case-insensitive behavior Document bidirectional mapping removal Add contributing guide section on command mappings Create error code discovery guide","title":"10. Documentation Updates"},{"location":"archive/IMPROVEMENT_PLAN/#11-performance-optimization","text":"Potential Improvements: Cache case-insensitive lookups Pre-compute lowercase key mappings Profile frequently called methods","title":"11. Performance Optimization"},{"location":"archive/IMPROVEMENT_PLAN/#testing-strategy","text":"","title":"Testing Strategy"},{"location":"archive/IMPROVEMENT_PLAN/#test-execution","text":"Use task test (per memory) to run full test suite.","title":"Test Execution"},{"location":"archive/IMPROVEMENT_PLAN/#coverage-goals","text":"Maintain or improve current coverage 100% coverage for new/modified code Focus on edge cases (case variants, None values, unknown codes)","title":"Coverage Goals"},{"location":"archive/IMPROVEMENT_PLAN/#test-writing-guidelines","text":"Follow existing patterns in test_t2277_command_mappings.py Use descriptive test names Test both success and failure paths Don't test uncertain return values Use fixtures from conftest.py","title":"Test Writing Guidelines"},{"location":"archive/IMPROVEMENT_PLAN/#implementation-order","text":"","title":"Implementation Order"},{"location":"archive/IMPROVEMENT_PLAN/#phase-1-critical-fixes-week-1","text":"Remove bidirectional mapping duplicates Standardize mapping conventions Extract case-insensitive lookup utility","title":"Phase 1: Critical Fixes (Week 1)"},{"location":"archive/IMPROVEMENT_PLAN/#phase-2-test-coverage-week-2","text":"Create test files for T2250-T2262 models Add integration tests Verify 100% coverage for changes","title":"Phase 2: Test Coverage (Week 2)"},{"location":"archive/IMPROVEMENT_PLAN/#phase-3-enhancement-week-3-complete","text":"Improve logging strategy Changed value lookup failures from WARNING to DEBUG level Simplified debug message format for clarity Warnings now reserved for actual problems (initialization, update failures) Extract case-insensitive lookup utility Created case_insensitive_lookup.py module Refactored getRoboVacHumanReadableValue() to use utility Reduced code duplication and improved maintainability Updated tests to verify debug logging behavior Add comprehensive type hints Full type annotations in case_insensitive_lookup.py Type hints throughout core modules task type-check passing","title":"Phase 3: Enhancement (Week 3) - COMPLETE"},{"location":"archive/IMPROVEMENT_PLAN/#phase-4-polish-week-4-complete","text":"\u2705 Update documentation Updated README.md with Development section Created DEVELOPMENT.md with developer guide Removed unnecessary jargon (case_insensitive_lookup mentions) All markdown linting passes \u2705 Code cleanup Removed unused str_value variable All imports are used and necessary Consistent code style throughout No debug code remains \u2705 Final verification All 143 tests passing Type checking: Success (no issues found in 51 source files) Linting: All checks pass (0 errors)","title":"Phase 4: Polish (Week 4) - COMPLETE"},{"location":"archive/IMPROVEMENT_PLAN/#success-criteria","text":"[x] All tests pass with task test (143 passed) [x] No duplicate bidirectional mappings [x] Consistent mapping conventions across all models [x] 100% test coverage for modified code [x] All 8 modified models have dedicated test files (7 created) [x] Type hints added with task type-check passing [x] Documentation updated (README.md, DEVELOPMENT.md) [x] No regression in existing functionality [x] Code cleanup complete (linting passes) [x] All markdown files pass linting","title":"Success Criteria"},{"location":"archive/IMPROVEMENT_PLAN/#notes-for-next-developer","text":"","title":"Notes for Next Developer"},{"location":"archive/IMPROVEMENT_PLAN/#key-files-to-understand","text":"robovac.py - Core RoboVac class with command mapping logic vacuum.py - Home Assistant vacuum entity vacuums/base.py - Base classes and enums vacuums/T2*.py - Model-specific command mappings tests/test_vacuum/test_get_robovac_human_readable_value.py - Test patterns","title":"Key Files to Understand"},{"location":"archive/IMPROVEMENT_PLAN/#running-tests","text":"# Run all tests task test # Run specific test file pytest tests/test_vacuum/test_t2250_command_mappings.py -v # Run with coverage task test # Already includes coverage","title":"Running Tests"},{"location":"archive/IMPROVEMENT_PLAN/#linting-and-type-checking","text":"task lint task type-check","title":"Linting and Type Checking"},{"location":"archive/IMPROVEMENT_PLAN/#before-committing","text":"Run task test - ensure all tests pass Run task lint - fix any style issues Run task type-check - verify type hints Use conventional commit format: feat: , fix: , refactor: , test:","title":"Before Committing"},{"location":"archive/IMPROVEMENT_PLAN/#questions-for-maintainer","text":"Error Code Research : What's the preferred method for discovering error codes? Breaking Changes : Is it acceptable to remove bidirectional mappings in a minor version? Backwards Compatibility : Should old hardcoded checks for \"no_error\" vs \"No error\" be maintained? Model Priority : Which models should get error code mappings first?","title":"Questions for Maintainer"},{"location":"archive/IMPROVEMENT_PLAN/#related-issuesprs","text":"PR #161 - Original T2080 implementation with getRoboVacHumanReadableValue() Memory references T2277, T2278, T2320 recent additions CODE_COVERAGE_TODO.md (if exists) for broader testing strategy Document Version: 1.0 Created: 2025-10-21 Branch: more-mappings-work Author: Code Review Bot (Cascade)","title":"Related Issues/PRs"},{"location":"archive/NEXT_STEPS/","text":"Quick Reference: Next Steps for more-mappings-work \u00b6 TL;DR \u00b6 The branch needs test coverage for modified models, removal of duplicate mappings, and consistent conventions. Immediate Actions \u00b6 1. Remove Duplicate Bidirectional Mappings (30 min) \u00b6 Why: Case-insensitive matching makes them redundant Files: T2250.py, T2252.py, T2253.py, T2254.py, T2255.py, T2259.py, T2262.py # Remove this: \"Auto\": \"Auto\", # Bidirectional duplicate \"SmallRoom\": \"SmallRoom\", # Keep this: \"auto\": \"Auto\", \"small_room\": \"SmallRoom\", 2. Create Missing Tests (4 hours) \u00b6 Critical Gap: No tests for 8 modified models Create these files following test_t2277_command_mappings.py pattern: test_t2250_command_mappings.py test_t2251_command_mappings.py test_t2252_command_mappings.py test_t2253_command_mappings.py test_t2254_command_mappings.py test_t2255_command_mappings.py test_t2259_command_mappings.py test_t2262_command_mappings.py Each test must cover: Error code mapping (0 \u2192 \"No error\") MODE command values Case-insensitive matching FAN_SPEED mappings 3. Standardize Value Conventions (1 hour) \u00b6 Problem: T2250 uses \"auto\" , T2252 uses \"Auto\" Solution: All keys lowercase snake_case, all values PascalCase Running Tests \u00b6 task test # Run all tests task lint # Check code style task type-check # Verify type hints Files Changed in Branch \u00b6 File Change Tests Needed robovac.py Case-insensitive matching \u2705 Done vacuum.py Error check includes \"No error\" \u26a0\ufe0f Integration test needed T2250.py - T2262.py (8 files) Error mappings + bidirectional \u274c No tests Priority Order \u00b6 HIGH: Create test files (violates TDD) HIGH: Remove duplicate mappings (code smell) MEDIUM: Standardize conventions (maintainability) LOW: Enhanced error codes (user experience) Success Checklist \u00b6 [ ] task test passes [ ] 8 new test files created [ ] No \"Bidirectional mappings\" comments remain [ ] All mapping keys use lowercase snake_case [ ] Test coverage \u2265 previous level See Also \u00b6 IMPROVEMENT_PLAN.md - Complete analysis and strategy tests/test_vacuum/test_t2277_command_mappings.py - Test template User rules require TDD: write tests first! Estimated Time: 6 hours total Risk: Low (backward compatible changes) Blocks: None","title":"Quick Reference: Next Steps for more-mappings-work"},{"location":"archive/NEXT_STEPS/#quick-reference-next-steps-for-more-mappings-work","text":"","title":"Quick Reference: Next Steps for more-mappings-work"},{"location":"archive/NEXT_STEPS/#tldr","text":"The branch needs test coverage for modified models, removal of duplicate mappings, and consistent conventions.","title":"TL;DR"},{"location":"archive/NEXT_STEPS/#immediate-actions","text":"","title":"Immediate Actions"},{"location":"archive/NEXT_STEPS/#1-remove-duplicate-bidirectional-mappings-30-min","text":"Why: Case-insensitive matching makes them redundant Files: T2250.py, T2252.py, T2253.py, T2254.py, T2255.py, T2259.py, T2262.py # Remove this: \"Auto\": \"Auto\", # Bidirectional duplicate \"SmallRoom\": \"SmallRoom\", # Keep this: \"auto\": \"Auto\", \"small_room\": \"SmallRoom\",","title":"1. Remove Duplicate Bidirectional Mappings (30 min)"},{"location":"archive/NEXT_STEPS/#2-create-missing-tests-4-hours","text":"Critical Gap: No tests for 8 modified models Create these files following test_t2277_command_mappings.py pattern: test_t2250_command_mappings.py test_t2251_command_mappings.py test_t2252_command_mappings.py test_t2253_command_mappings.py test_t2254_command_mappings.py test_t2255_command_mappings.py test_t2259_command_mappings.py test_t2262_command_mappings.py Each test must cover: Error code mapping (0 \u2192 \"No error\") MODE command values Case-insensitive matching FAN_SPEED mappings","title":"2. Create Missing Tests (4 hours)"},{"location":"archive/NEXT_STEPS/#3-standardize-value-conventions-1-hour","text":"Problem: T2250 uses \"auto\" , T2252 uses \"Auto\" Solution: All keys lowercase snake_case, all values PascalCase","title":"3. Standardize Value Conventions (1 hour)"},{"location":"archive/NEXT_STEPS/#running-tests","text":"task test # Run all tests task lint # Check code style task type-check # Verify type hints","title":"Running Tests"},{"location":"archive/NEXT_STEPS/#files-changed-in-branch","text":"File Change Tests Needed robovac.py Case-insensitive matching \u2705 Done vacuum.py Error check includes \"No error\" \u26a0\ufe0f Integration test needed T2250.py - T2262.py (8 files) Error mappings + bidirectional \u274c No tests","title":"Files Changed in Branch"},{"location":"archive/NEXT_STEPS/#priority-order","text":"HIGH: Create test files (violates TDD) HIGH: Remove duplicate mappings (code smell) MEDIUM: Standardize conventions (maintainability) LOW: Enhanced error codes (user experience)","title":"Priority Order"},{"location":"archive/NEXT_STEPS/#success-checklist","text":"[ ] task test passes [ ] 8 new test files created [ ] No \"Bidirectional mappings\" comments remain [ ] All mapping keys use lowercase snake_case [ ] Test coverage \u2265 previous level","title":"Success Checklist"},{"location":"archive/NEXT_STEPS/#see-also","text":"IMPROVEMENT_PLAN.md - Complete analysis and strategy tests/test_vacuum/test_t2277_command_mappings.py - Test template User rules require TDD: write tests first! Estimated Time: 6 hours total Risk: Low (backward compatible changes) Blocks: None","title":"See Also"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/","text":"Issue #186 Analysis Summary \u00b6 Quick Answer \u00b6 Is the error still present? \u26a0\ufe0f YES The underlying problem still exists, but the symptom has changed: Before: WARNING logs flooding Home Assistant Now: DEBUG logs (less visible) + status values not translated to human-readable form Root Cause: T2262 model definition missing STATUS value mappings The Problem \u00b6 Users with T2262 vacuum models report these status values cannot be translated: \"Charging\" \"Sleeping\" \"completed\" Current T2262 Definition: RobovacCommand.STATUS: { \"code\": 15, }, Missing the values dictionary that maps device responses to human-readable strings. What Happens: Device sends status like \"Charging\" getRoboVacHumanReadableValue() can't find mapping Returns raw value as-is Logs debug message (not visible unless debug logging enabled) Home Assistant might display raw value instead of friendly status Why We Can't Fix It Immediately \u00b6 CRITICAL BLOCKER: We need actual device data. T2262 uses STATUS code 15 T2277 (which has mappings) uses code 153 Different codes = different value encodings Cannot safely copy mappings between models Example from T2277 (code 153): \"Charging\": \"BBADGgA=\", # Base64-encoded \"Sleeping\": \"AhAB\", T2262's code 15 likely uses completely different values. Solution Path \u00b6 Step 1: Get Real Data (REQUIRED) \u00b6 Contact users via issue #186 and request: # Enable debug logging in Home Assistant logger: default: info logs: custom_components.robovac: debug Need them to capture: Raw value device sends What Eufy app displayed Do this for: Charging, Sleeping, Completed, Standby, Paused, Cleaning, etc. Step 2: Implement Fix (TDD) \u00b6 Write failing test for STATUS values Add mappings to T2262.py Verify tests pass User validation on real device Step 3: Apply to Related Models \u00b6 These models also have STATUS code 15 with no values: T2253 (specifically mentioned in issue) T2250, T2251, T2252, T2254, T2255, T2259, T2268, T2270, T2272, T2273 What I've Created \u00b6 \ud83d\udccb ISSUE_186_FIX_PLAN.md \u00b6 Comprehensive implementation plan including: \u2705 Detailed step-by-step instructions \u2705 TDD workflow (test first!) \u2705 Code examples and templates \u2705 Testing requirements \u2705 User validation checklist \u2705 Git workflow with commit messages \u2705 Risk assessment \u2705 Success criteria This plan is ready to hand off to another LLM or developer. Key Instructions for Next LLM \u00b6 DO NOT Proceed Until \u00b6 \u274c User provides actual T2262 device data \u274c At least 5-7 status values collected \u274c User confirms Eufy app display for each value MUST Follow TDD \u00b6 \u2705 Write test FIRST \u2705 Verify test FAILS \u2705 Implement feature \u2705 Verify test PASSES \u2705 Run full test suite DO NOT \u00b6 \u274c Guess at status values \u274c Copy from T2277 (different code!) \u274c Skip tests \u274c Implement without data Current Status \u00b6 Phase Status Blocker Data Collection \u23f8\ufe0f Waiting Need user input Implementation \u23f8\ufe0f Blocked Waiting on data Testing \u23f8\ufe0f Blocked Waiting on implementation User Validation \u23f8\ufe0f Blocked Waiting on implementation Next Actions \u00b6 For You (Repository Owner) \u00b6 Post comment on issue #186 requesting device data: Hi everyone! To fix this issue properly, I need actual device data from T2262 owners. Could you please: 1. Enable debug logging in Home Assistant: ```yaml logger: default: info logs: custom_components.robovac: debug ``` 1. Watch your logs and note when you see messages like: \"Command status with value X not found for model T2262\" 1. For each message, tell me: - The raw value (X in the message) - What the Eufy app showed at that exact time Example: - Raw value: \"charging\" - Eufy app showed: \"Charging\" Especially interested in these states: - Charging - Sleeping - Completed/Finished - Standby/Idle - Paused - Cleaning/Auto - Returning home Thank you! \ud83d\ude4f Wait for user responses with data Hand off to LLM with collected data + ISSUE_186_FIX_PLAN.md For Next LLM \u00b6 Read ISSUE_186_FIX_PLAN.md thoroughly Verify you have user data Follow TDD workflow exactly Test with task test Validate with users Files Created \u00b6 \u2705 ISSUE_186_FIX_PLAN.md - Detailed implementation plan \u2705 ISSUE_186_ANALYSIS.md - This summary References \u00b6 Issue: https://github.com/damacus/robovac/issues/186 Test Pattern: tests/test_vacuum/test_t2262_command_mappings.py Model File: custom_components/robovac/vacuums/T2262.py Similar Working Model: custom_components/robovac/vacuums/T2277.py Analysis Date: 2025-10-22 Status: Error confirmed, plan created, awaiting user data","title":"Issue #186 Analysis Summary"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#issue-186-analysis-summary","text":"","title":"Issue #186 Analysis Summary"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#quick-answer","text":"Is the error still present? \u26a0\ufe0f YES The underlying problem still exists, but the symptom has changed: Before: WARNING logs flooding Home Assistant Now: DEBUG logs (less visible) + status values not translated to human-readable form Root Cause: T2262 model definition missing STATUS value mappings","title":"Quick Answer"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#the-problem","text":"Users with T2262 vacuum models report these status values cannot be translated: \"Charging\" \"Sleeping\" \"completed\" Current T2262 Definition: RobovacCommand.STATUS: { \"code\": 15, }, Missing the values dictionary that maps device responses to human-readable strings. What Happens: Device sends status like \"Charging\" getRoboVacHumanReadableValue() can't find mapping Returns raw value as-is Logs debug message (not visible unless debug logging enabled) Home Assistant might display raw value instead of friendly status","title":"The Problem"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#why-we-cant-fix-it-immediately","text":"CRITICAL BLOCKER: We need actual device data. T2262 uses STATUS code 15 T2277 (which has mappings) uses code 153 Different codes = different value encodings Cannot safely copy mappings between models Example from T2277 (code 153): \"Charging\": \"BBADGgA=\", # Base64-encoded \"Sleeping\": \"AhAB\", T2262's code 15 likely uses completely different values.","title":"Why We Can't Fix It Immediately"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#solution-path","text":"","title":"Solution Path"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#step-1-get-real-data-required","text":"Contact users via issue #186 and request: # Enable debug logging in Home Assistant logger: default: info logs: custom_components.robovac: debug Need them to capture: Raw value device sends What Eufy app displayed Do this for: Charging, Sleeping, Completed, Standby, Paused, Cleaning, etc.","title":"Step 1: Get Real Data (REQUIRED)"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#step-2-implement-fix-tdd","text":"Write failing test for STATUS values Add mappings to T2262.py Verify tests pass User validation on real device","title":"Step 2: Implement Fix (TDD)"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#step-3-apply-to-related-models","text":"These models also have STATUS code 15 with no values: T2253 (specifically mentioned in issue) T2250, T2251, T2252, T2254, T2255, T2259, T2268, T2270, T2272, T2273","title":"Step 3: Apply to Related Models"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#what-ive-created","text":"","title":"What I've Created"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#issue_186_fix_planmd","text":"Comprehensive implementation plan including: \u2705 Detailed step-by-step instructions \u2705 TDD workflow (test first!) \u2705 Code examples and templates \u2705 Testing requirements \u2705 User validation checklist \u2705 Git workflow with commit messages \u2705 Risk assessment \u2705 Success criteria This plan is ready to hand off to another LLM or developer.","title":"\ud83d\udccb ISSUE_186_FIX_PLAN.md"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#key-instructions-for-next-llm","text":"","title":"Key Instructions for Next LLM"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#do-not-proceed-until","text":"\u274c User provides actual T2262 device data \u274c At least 5-7 status values collected \u274c User confirms Eufy app display for each value","title":"DO NOT Proceed Until"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#must-follow-tdd","text":"\u2705 Write test FIRST \u2705 Verify test FAILS \u2705 Implement feature \u2705 Verify test PASSES \u2705 Run full test suite","title":"MUST Follow TDD"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#do-not","text":"\u274c Guess at status values \u274c Copy from T2277 (different code!) \u274c Skip tests \u274c Implement without data","title":"DO NOT"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#current-status","text":"Phase Status Blocker Data Collection \u23f8\ufe0f Waiting Need user input Implementation \u23f8\ufe0f Blocked Waiting on data Testing \u23f8\ufe0f Blocked Waiting on implementation User Validation \u23f8\ufe0f Blocked Waiting on implementation","title":"Current Status"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#next-actions","text":"","title":"Next Actions"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#for-you-repository-owner","text":"Post comment on issue #186 requesting device data: Hi everyone! To fix this issue properly, I need actual device data from T2262 owners. Could you please: 1. Enable debug logging in Home Assistant: ```yaml logger: default: info logs: custom_components.robovac: debug ``` 1. Watch your logs and note when you see messages like: \"Command status with value X not found for model T2262\" 1. For each message, tell me: - The raw value (X in the message) - What the Eufy app showed at that exact time Example: - Raw value: \"charging\" - Eufy app showed: \"Charging\" Especially interested in these states: - Charging - Sleeping - Completed/Finished - Standby/Idle - Paused - Cleaning/Auto - Returning home Thank you! \ud83d\ude4f Wait for user responses with data Hand off to LLM with collected data + ISSUE_186_FIX_PLAN.md","title":"For You (Repository Owner)"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#for-next-llm","text":"Read ISSUE_186_FIX_PLAN.md thoroughly Verify you have user data Follow TDD workflow exactly Test with task test Validate with users","title":"For Next LLM"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#files-created","text":"\u2705 ISSUE_186_FIX_PLAN.md - Detailed implementation plan \u2705 ISSUE_186_ANALYSIS.md - This summary","title":"Files Created"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#references","text":"Issue: https://github.com/damacus/robovac/issues/186 Test Pattern: tests/test_vacuum/test_t2262_command_mappings.py Model File: custom_components/robovac/vacuums/T2262.py Similar Working Model: custom_components/robovac/vacuums/T2277.py Analysis Date: 2025-10-22 Status: Error confirmed, plan created, awaiting user data","title":"References"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/","text":"Fix Plan for Issue #186: T2262 Missing STATUS Value Mappings \u00b6 Issue Summary \u00b6 Title: T2262: Missing command mapping for status value \"Charging\" Problem: T2262 vacuum model has STATUS command defined (code 15) but lacks value mappings. When the device sends status updates like \"Charging\", \"Sleeping\", or \"completed\", they cannot be translated to human-readable values, resulting in debug logs and potentially confusing status displays. Affected Users: Multiple users (SGXander, JBenson74, dxmnkd316) reported this issue. Related Models: T2253 also has the same issue (STATUS code 15, no values defined). Current State Analysis \u00b6 What We Know \u00b6 T2262 Current Implementation ( custom_components/robovac/vacuums/T2262.py ): python RobovacCommand.STATUS: { \"code\": 15, }, Has STATUS command defined Code is 15 No values dict defined Missing Status Values (reported by users): \"Charging\" \"Sleeping\" \"completed\" Error value \"0\" (already handled in ERROR command) Similar Working Model (T2277) - Uses different code (153): python RobovacCommand.STATUS: { \"code\": 153, \"values\": { \"Charging\": \"BBADGgA=\", \"Sleeping\": \"AhAB\", \"completed\": \"BhADGgIIAQ==\", \"Standby\": \"AA==\", \"Paused\": \"CAoAEAUyAggB\", # ... bidirectional mappings }, } Current Behavior: When device sends unmapped status, getRoboVacHumanReadableValue() returns the original value Logs debug message (changed from WARNING in previous fix) Status may display as raw value instead of human-readable string What We Don't Know \u00b6 CRITICAL: We lack actual T2262 device data showing: What exact values the device sends for STATUS code 15 Whether values are base64-encoded strings or plain text Bidirectional mapping requirements Why This Matters: STATUS code 15 (T2262) likely uses different encoding than code 153 (T2277). Cannot safely copy mappings between models. Solution Strategy \u00b6 Phase 1: Data Collection (PREREQUISITE) \u00b6 Objective: Gather actual T2262 device data from users. Action Items: Contact affected users via GitHub issue #186 Request device data collection using Home Assistant debug logs: yaml logger: default: info logs: custom_components.robovac: debug Data needed for each status: Raw value received from device What Eufy app displayed at that time Example statuses: Charging, Sleeping, Completed, Standby, Paused, Cleaning, etc. Document findings in issue comments before proceeding to implementation. Phase 2: Implementation (TDD Approach) \u00b6 Prerequisites: \u2705 Phase 1 data collection complete \u2705 Verify at least 5-7 status mappings available \u2705 Confirm with user that test data matches their observations Step 1: Write Failing Tests FIRST \u00b6 File: tests/test_vacuum/test_t2262_command_mappings.py Add comprehensive STATUS value tests: def test_t2262_status_human_readable_values(mock_t2262_robovac) -> None: \"\"\"Test T2262 STATUS command translates device values to human-readable strings.\"\"\" # TODO: Replace with ACTUAL device values from Phase 1 # Example structure (DO NOT USE without real data): # assert mock_t2262_robovac.getRoboVacHumanReadableValue( # RobovacCommand.STATUS, \"DEVICE_VALUE_HERE\" # ) == \"Charging\" # Add tests for ALL collected status values: # - Charging # - Sleeping # - Completed # - Standby # - Paused # - Cleaning/Auto # - Returning home # - etc. pass # Remove after adding real tests def test_t2262_status_case_insensitive(mock_t2262_robovac) -> None: \"\"\"Test T2262 STATUS values work with case-insensitive lookup.\"\"\" # Test that case variations of device values still match pass # Implement with real data def test_t2262_status_bidirectional_mapping(mock_t2262_robovac) -> None: \"\"\"Test T2262 STATUS supports bidirectional lookups if needed.\"\"\" # Only if device uses bidirectional mapping (check T2277 pattern) pass # Implement if needed Run tests to verify they fail: task test Expected: New tests fail because T2262.py lacks STATUS values. Step 2: Implement Status Values \u00b6 File: custom_components/robovac/vacuums/T2262.py Update STATUS command with collected data: RobovacCommand.STATUS: { \"code\": 15, \"values\": { # TODO: Add mappings from Phase 1 data collection # Follow this pattern based on actual device data: # \"device_value\": \"HumanReadable\", # \"HumanReadable\": \"device_value\", # If bidirectional needed # EXAMPLE ONLY - Replace with real data: # \"charging\": \"Charging\", # \"Charging\": \"charging\", # \"sleeping\": \"Sleeping\", # \"Sleeping\": \"sleeping\", # \"completed\": \"Completed\", # etc. }, }, Important Notes: Maintain consistency with existing models' capitalization patterns Add bidirectional mappings if device requires reverse lookups Include comments noting source of mappings (user data, firmware version, etc.) Step 3: Verify Tests Pass \u00b6 task test Expected: All new STATUS tests pass. Step 4: Run Full Test Suite \u00b6 task test Expected: All existing tests still pass (no regressions). Step 5: Code Quality Checks \u00b6 task lint task type-check Expected: No linting or type errors. Phase 3: Documentation & Validation \u00b6 Update Documentation \u00b6 Add comment in T2262.py noting data source: python RobovacCommand.STATUS: { \"code\": 15, # Mappings confirmed by users: @SGXander, @dxmnkd316 # Firmware version: [if known] # Date verified: 2025-10-22 \"values\": { # ... }, }, Update DEVELOPMENT.md if new patterns introduced Add to CODE_COVERAGE_TODO.md if other models need similar fixes User Validation \u00b6 Create test branch with changes Share with affected users via GitHub issue Request testing on actual devices Gather feedback before merging Phase 4: Related Models (Optional) \u00b6 Check if other models need similar fixes: Models with STATUS code 15 and no values: T2253 (mentioned in issue comments) T2250, T2251, T2252, T2254, T2255, T2259, T2268, T2270, T2272, T2273 Decision: Fix T2262 first, then evaluate if pattern applies to others. Testing Strategy \u00b6 Test Coverage Requirements \u00b6 All tests must pass before merging: \u2705 STATUS value translations work \u2705 Case-insensitive lookup works \u2705 Bidirectional mapping works (if applicable) \u2705 Unknown values return as-is (existing behavior) \u2705 No regressions in other commands \u2705 Full test suite passes \u2705 Linting passes \u2705 Type checking passes Manual Testing Checklist \u00b6 Before marking issue as resolved: [ ] User confirms status displays correctly in Home Assistant [ ] \"Charging\" shows as \"Charging\" (not raw value) [ ] \"Sleeping\" shows correctly [ ] \"Completed\" shows correctly [ ] No debug logs for mapped values [ ] Device commands still work [ ] State transitions work correctly Implementation Notes for LLM \u00b6 DO NOT Proceed Without Data \u00b6 STOP if: Phase 1 data collection incomplete User data not available Uncertain about mappings ASK for: Actual device logs User confirmation Additional test cases TDD Discipline \u00b6 ALWAYS: Write test first Verify it fails Implement feature Verify test passes Run full suite Refactor if needed NEVER: Skip tests Implement without failing test Guess at device values Copy mappings from different model codes Code Standards \u00b6 Follow existing patterns: Use lowercase snake_case for keys (e.g., \"charging\") Use PascalCase for values (e.g., \"Charging\") Maintain bidirectional mappings if model requires it Add type hints Include docstrings for new functions Git Workflow \u00b6 Conventional Commits: # After Phase 1 git checkout -b fix/issue-186-t2262-status-mappings # After implementation git add tests/test_vacuum/test_t2262_command_mappings.py git commit -m \"test: add T2262 STATUS value mapping tests\" git add custom_components/robovac/vacuums/T2262.py git commit -m \"fix(T2262): add STATUS command value mappings - Add Charging, Sleeping, completed status values - Fixes #186 - Confirmed with users @SGXander @dxmnkd316\" # After validation git push origin fix/issue-186-t2262-status-mappings PR Description Template: ## Fixes #186 ### Changes - Added STATUS value mappings for T2262 model - Added comprehensive test coverage for STATUS values ### Testing - \u2705 All tests pass - \u2705 Lint/type checks pass - \u2705 User validation: @username confirmed working ### Data Source Status mappings provided by users: - @SGXander - @dxmnkd316 ### Notes [Any important context about the mappings] Risk Assessment \u00b6 Low Risk \u2705 \u00b6 Adding value mappings to existing command Following established patterns Comprehensive test coverage Medium Risk \u26a0\ufe0f \u00b6 Status values might change with firmware updates Users on different firmware versions may see different values Mitigation \u00b6 Document firmware version in comments Add fallback behavior (return raw value if unmapped) Monitor issue for additional reports Success Criteria \u00b6 Issue can be closed when: \u2705 T2262 has STATUS values mapped \u2705 All tests pass \u2705 Users confirm fix works on real devices \u2705 No debug logs for mapped status values \u2705 Documentation updated \u2705 Code merged to main branch Questions for User (if blocked) \u00b6 If you need clarification: \"Can you enable debug logging and share the exact raw values your T2262 sends for STATUS code 15?\" \"What does the Eufy app show when you see the 'Charging' debug message?\" \"Can you test this branch and confirm the status displays correctly?\" \"What firmware version is your T2262 running?\" Estimated Effort \u00b6 Phase 1 (Data Collection): 2-5 days (waiting on users) Phase 2 (Implementation): 30-60 minutes (with data) Phase 3 (Documentation): 15 minutes Phase 4 (User Validation): 1-3 days Total: ~3-8 days (mostly waiting for user feedback) References \u00b6 Issue: https://github.com/damacus/robovac/issues/186 Related PR (T2277 model): Check for STATUS implementation pattern Test pattern: tests/test_vacuum/test_t2278_command_mappings.py Similar fix: T2252 (see previous memory about mapping fixes) Last Updated: 2025-10-22 Status: Ready for data collection Assigned To: [LLM or developer name]","title":"Fix Plan for Issue #186: T2262 Missing STATUS Value Mappings"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#fix-plan-for-issue-186-t2262-missing-status-value-mappings","text":"","title":"Fix Plan for Issue #186: T2262 Missing STATUS Value Mappings"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#issue-summary","text":"Title: T2262: Missing command mapping for status value \"Charging\" Problem: T2262 vacuum model has STATUS command defined (code 15) but lacks value mappings. When the device sends status updates like \"Charging\", \"Sleeping\", or \"completed\", they cannot be translated to human-readable values, resulting in debug logs and potentially confusing status displays. Affected Users: Multiple users (SGXander, JBenson74, dxmnkd316) reported this issue. Related Models: T2253 also has the same issue (STATUS code 15, no values defined).","title":"Issue Summary"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#current-state-analysis","text":"","title":"Current State Analysis"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#what-we-know","text":"T2262 Current Implementation ( custom_components/robovac/vacuums/T2262.py ): python RobovacCommand.STATUS: { \"code\": 15, }, Has STATUS command defined Code is 15 No values dict defined Missing Status Values (reported by users): \"Charging\" \"Sleeping\" \"completed\" Error value \"0\" (already handled in ERROR command) Similar Working Model (T2277) - Uses different code (153): python RobovacCommand.STATUS: { \"code\": 153, \"values\": { \"Charging\": \"BBADGgA=\", \"Sleeping\": \"AhAB\", \"completed\": \"BhADGgIIAQ==\", \"Standby\": \"AA==\", \"Paused\": \"CAoAEAUyAggB\", # ... bidirectional mappings }, } Current Behavior: When device sends unmapped status, getRoboVacHumanReadableValue() returns the original value Logs debug message (changed from WARNING in previous fix) Status may display as raw value instead of human-readable string","title":"What We Know"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#what-we-dont-know","text":"CRITICAL: We lack actual T2262 device data showing: What exact values the device sends for STATUS code 15 Whether values are base64-encoded strings or plain text Bidirectional mapping requirements Why This Matters: STATUS code 15 (T2262) likely uses different encoding than code 153 (T2277). Cannot safely copy mappings between models.","title":"What We Don't Know"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#solution-strategy","text":"","title":"Solution Strategy"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-1-data-collection-prerequisite","text":"Objective: Gather actual T2262 device data from users. Action Items: Contact affected users via GitHub issue #186 Request device data collection using Home Assistant debug logs: yaml logger: default: info logs: custom_components.robovac: debug Data needed for each status: Raw value received from device What Eufy app displayed at that time Example statuses: Charging, Sleeping, Completed, Standby, Paused, Cleaning, etc. Document findings in issue comments before proceeding to implementation.","title":"Phase 1: Data Collection (PREREQUISITE)"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-2-implementation-tdd-approach","text":"Prerequisites: \u2705 Phase 1 data collection complete \u2705 Verify at least 5-7 status mappings available \u2705 Confirm with user that test data matches their observations","title":"Phase 2: Implementation (TDD Approach)"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-1-write-failing-tests-first","text":"File: tests/test_vacuum/test_t2262_command_mappings.py Add comprehensive STATUS value tests: def test_t2262_status_human_readable_values(mock_t2262_robovac) -> None: \"\"\"Test T2262 STATUS command translates device values to human-readable strings.\"\"\" # TODO: Replace with ACTUAL device values from Phase 1 # Example structure (DO NOT USE without real data): # assert mock_t2262_robovac.getRoboVacHumanReadableValue( # RobovacCommand.STATUS, \"DEVICE_VALUE_HERE\" # ) == \"Charging\" # Add tests for ALL collected status values: # - Charging # - Sleeping # - Completed # - Standby # - Paused # - Cleaning/Auto # - Returning home # - etc. pass # Remove after adding real tests def test_t2262_status_case_insensitive(mock_t2262_robovac) -> None: \"\"\"Test T2262 STATUS values work with case-insensitive lookup.\"\"\" # Test that case variations of device values still match pass # Implement with real data def test_t2262_status_bidirectional_mapping(mock_t2262_robovac) -> None: \"\"\"Test T2262 STATUS supports bidirectional lookups if needed.\"\"\" # Only if device uses bidirectional mapping (check T2277 pattern) pass # Implement if needed Run tests to verify they fail: task test Expected: New tests fail because T2262.py lacks STATUS values.","title":"Step 1: Write Failing Tests FIRST"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-2-implement-status-values","text":"File: custom_components/robovac/vacuums/T2262.py Update STATUS command with collected data: RobovacCommand.STATUS: { \"code\": 15, \"values\": { # TODO: Add mappings from Phase 1 data collection # Follow this pattern based on actual device data: # \"device_value\": \"HumanReadable\", # \"HumanReadable\": \"device_value\", # If bidirectional needed # EXAMPLE ONLY - Replace with real data: # \"charging\": \"Charging\", # \"Charging\": \"charging\", # \"sleeping\": \"Sleeping\", # \"Sleeping\": \"sleeping\", # \"completed\": \"Completed\", # etc. }, }, Important Notes: Maintain consistency with existing models' capitalization patterns Add bidirectional mappings if device requires reverse lookups Include comments noting source of mappings (user data, firmware version, etc.)","title":"Step 2: Implement Status Values"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-3-verify-tests-pass","text":"task test Expected: All new STATUS tests pass.","title":"Step 3: Verify Tests Pass"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-4-run-full-test-suite","text":"task test Expected: All existing tests still pass (no regressions).","title":"Step 4: Run Full Test Suite"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-5-code-quality-checks","text":"task lint task type-check Expected: No linting or type errors.","title":"Step 5: Code Quality Checks"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-3-documentation-validation","text":"","title":"Phase 3: Documentation &amp; Validation"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#update-documentation","text":"Add comment in T2262.py noting data source: python RobovacCommand.STATUS: { \"code\": 15, # Mappings confirmed by users: @SGXander, @dxmnkd316 # Firmware version: [if known] # Date verified: 2025-10-22 \"values\": { # ... }, }, Update DEVELOPMENT.md if new patterns introduced Add to CODE_COVERAGE_TODO.md if other models need similar fixes","title":"Update Documentation"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#user-validation","text":"Create test branch with changes Share with affected users via GitHub issue Request testing on actual devices Gather feedback before merging","title":"User Validation"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-4-related-models-optional","text":"Check if other models need similar fixes: Models with STATUS code 15 and no values: T2253 (mentioned in issue comments) T2250, T2251, T2252, T2254, T2255, T2259, T2268, T2270, T2272, T2273 Decision: Fix T2262 first, then evaluate if pattern applies to others.","title":"Phase 4: Related Models (Optional)"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#testing-strategy","text":"","title":"Testing Strategy"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#test-coverage-requirements","text":"All tests must pass before merging: \u2705 STATUS value translations work \u2705 Case-insensitive lookup works \u2705 Bidirectional mapping works (if applicable) \u2705 Unknown values return as-is (existing behavior) \u2705 No regressions in other commands \u2705 Full test suite passes \u2705 Linting passes \u2705 Type checking passes","title":"Test Coverage Requirements"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#manual-testing-checklist","text":"Before marking issue as resolved: [ ] User confirms status displays correctly in Home Assistant [ ] \"Charging\" shows as \"Charging\" (not raw value) [ ] \"Sleeping\" shows correctly [ ] \"Completed\" shows correctly [ ] No debug logs for mapped values [ ] Device commands still work [ ] State transitions work correctly","title":"Manual Testing Checklist"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#implementation-notes-for-llm","text":"","title":"Implementation Notes for LLM"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#do-not-proceed-without-data","text":"STOP if: Phase 1 data collection incomplete User data not available Uncertain about mappings ASK for: Actual device logs User confirmation Additional test cases","title":"DO NOT Proceed Without Data"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#tdd-discipline","text":"ALWAYS: Write test first Verify it fails Implement feature Verify test passes Run full suite Refactor if needed NEVER: Skip tests Implement without failing test Guess at device values Copy mappings from different model codes","title":"TDD Discipline"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#code-standards","text":"Follow existing patterns: Use lowercase snake_case for keys (e.g., \"charging\") Use PascalCase for values (e.g., \"Charging\") Maintain bidirectional mappings if model requires it Add type hints Include docstrings for new functions","title":"Code Standards"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#git-workflow","text":"Conventional Commits: # After Phase 1 git checkout -b fix/issue-186-t2262-status-mappings # After implementation git add tests/test_vacuum/test_t2262_command_mappings.py git commit -m \"test: add T2262 STATUS value mapping tests\" git add custom_components/robovac/vacuums/T2262.py git commit -m \"fix(T2262): add STATUS command value mappings - Add Charging, Sleeping, completed status values - Fixes #186 - Confirmed with users @SGXander @dxmnkd316\" # After validation git push origin fix/issue-186-t2262-status-mappings PR Description Template: ## Fixes #186 ### Changes - Added STATUS value mappings for T2262 model - Added comprehensive test coverage for STATUS values ### Testing - \u2705 All tests pass - \u2705 Lint/type checks pass - \u2705 User validation: @username confirmed working ### Data Source Status mappings provided by users: - @SGXander - @dxmnkd316 ### Notes [Any important context about the mappings]","title":"Git Workflow"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#risk-assessment","text":"","title":"Risk Assessment"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#low-risk","text":"Adding value mappings to existing command Following established patterns Comprehensive test coverage","title":"Low Risk \u2705"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#medium-risk","text":"Status values might change with firmware updates Users on different firmware versions may see different values","title":"Medium Risk \u26a0\ufe0f"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#mitigation","text":"Document firmware version in comments Add fallback behavior (return raw value if unmapped) Monitor issue for additional reports","title":"Mitigation"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#success-criteria","text":"Issue can be closed when: \u2705 T2262 has STATUS values mapped \u2705 All tests pass \u2705 Users confirm fix works on real devices \u2705 No debug logs for mapped status values \u2705 Documentation updated \u2705 Code merged to main branch","title":"Success Criteria"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#questions-for-user-if-blocked","text":"If you need clarification: \"Can you enable debug logging and share the exact raw values your T2262 sends for STATUS code 15?\" \"What does the Eufy app show when you see the 'Charging' debug message?\" \"Can you test this branch and confirm the status displays correctly?\" \"What firmware version is your T2262 running?\"","title":"Questions for User (if blocked)"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#estimated-effort","text":"Phase 1 (Data Collection): 2-5 days (waiting on users) Phase 2 (Implementation): 30-60 minutes (with data) Phase 3 (Documentation): 15 minutes Phase 4 (User Validation): 1-3 days Total: ~3-8 days (mostly waiting for user feedback)","title":"Estimated Effort"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#references","text":"Issue: https://github.com/damacus/robovac/issues/186 Related PR (T2277 model): Check for STATUS implementation pattern Test pattern: tests/test_vacuum/test_t2278_command_mappings.py Similar fix: T2252 (see previous memory about mapping fixes) Last Updated: 2025-10-22 Status: Ready for data collection Assigned To: [LLM or developer name]","title":"References"},{"location":"archive/pr171/","text":"PR #171 Archive \u00b6 This directory contains working documents from PR #171 - Type Annotations Implementation. Files \u00b6 IMPLEMENTATION_PLAN_PR171.md - Comprehensive implementation plan and progress tracking PR171_REVIEW_SUMMARY.md - Review summary and analysis QUICK_START_PR171.md - Quick start guide for the PR work Summary \u00b6 PR #171 successfully added comprehensive type annotations to the entire test suite: Added type annotations to 27+ test files Fixed 178+ mypy errors All 191 tests passing Zero mypy errors in custom_components/ and tests/ Follows strict type checking requirements Date Completed \u00b6 October 22, 2025 Related Issues \u00b6 Issue #171: Add type annotations to test suite","title":"PR #171 Archive"},{"location":"archive/pr171/#pr-171-archive","text":"This directory contains working documents from PR #171 - Type Annotations Implementation.","title":"PR #171 Archive"},{"location":"archive/pr171/#files","text":"IMPLEMENTATION_PLAN_PR171.md - Comprehensive implementation plan and progress tracking PR171_REVIEW_SUMMARY.md - Review summary and analysis QUICK_START_PR171.md - Quick start guide for the PR work","title":"Files"},{"location":"archive/pr171/#summary","text":"PR #171 successfully added comprehensive type annotations to the entire test suite: Added type annotations to 27+ test files Fixed 178+ mypy errors All 191 tests passing Zero mypy errors in custom_components/ and tests/ Follows strict type checking requirements","title":"Summary"},{"location":"archive/pr171/#date-completed","text":"October 22, 2025","title":"Date Completed"},{"location":"archive/pr171/#related-issues","text":"Issue #171: Add type annotations to test suite","title":"Related Issues"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/","text":"Implementation Plan: PR #171 - Battery Deprecation & Model Validation \u00b6 PR Review Summary \u00b6 Changes from PR #171 \u00b6 Battery Deprecation Fixes (HA 2026.8 compatibility) Remove VacuumEntityFeature.BATTERY from 35+ vacuum models Remove deprecated _attr_battery_level from vacuum.py entity Maintain existing battery sensor functionality (no breaking changes) Error Handling Improvements Fix typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\" Add getErrorMessageWithContext() function with actionable troubleshooting Enhanced error messages with user guidance Model Validation Tools model_validator.py : Library module with series detection (C, G, L, X series) model_validator_cli.py : Standalone CLI tool for users Automatic unsupported model suggestions Series-specific troubleshooting guides Code Review Findings \u00b6 Style Issues: Generally clean, follows Python conventions Some flake8 violations were fixed in PR (whitespace, line breaks) Type hints need to be added for new functions Conciseness: Model validator has good abstraction with series detection Error context function could be more modular CLI tool has appropriate separation from library Readability: Clear function names and structure Some functions are long and could benefit from decomposition Documentation is comprehensive Maintainability: Series detection makes adding new models easier Model list is centralized (good) CLI tool has fallback for standalone usage (good) Tests needed for all new functionality Implementation Plan \u00b6 Phase 1: Battery Deprecation (Test-First) \u00b6 Step 1.1: Write Failing Tests for Battery Feature Removal \u00b6 Task: Create test file for battery feature validation File: tests/test_vacuum/test_battery_feature_removal.py Test Cases: # Test 1: Verify VacuumEntityFeature.BATTERY is NOT in homeassistant_features for all models # Test 2: Verify battery command mappings still exist (backward compatibility) # Test 3: Verify battery level property is removed from vacuum entity # Test 4: Verify battery sensor still works independently Implementation Details: Import all vacuum models from custom_components/robovac/vacuums Iterate through all T* models Assert VacuumEntityFeature.BATTERY not in homeassistant_features Assert RobovacCommand.BATTERY still exists in commands Verify vacuum entity does not have _attr_battery_level attribute Run tests (should fail): task test tests/test_vacuum/test_battery_feature_removal.py Step 1.2: Remove Battery Feature from Vacuum Models \u00b6 Task: Remove VacuumEntityFeature.BATTERY from all 35 vacuum model files Files to modify: All vacuum models in custom_components/robovac/vacuums/T2*.py Pattern to apply: # BEFORE: homeassistant_features = ( VacuumEntityFeature.BATTERY | VacuumEntityFeature.FAN_SPEED | ... ) # AFTER: homeassistant_features = ( VacuumEntityFeature.FAN_SPEED | ... ) Models to update: (35 files) T2080, T2103, T2117, T2118, T2119, T2120, T2123, T2128, T2130, T2132 T2150, T2181, T2190, T2192, T2193, T2194, T2250, T2251, T2252, T2253 T2254, T2255, T2259, T2261, T2262, T2267, T2268, T2270, T2272, T2273 T2275, T2276, T2277, T2278, T2320 Implementation: Use multi_edit tool for batch updates Preserve all other features and command mappings Maintain code formatting and structure Run tests (should pass): task test tests/test_vacuum/test_battery_feature_removal.py Step 1.3: Remove _attr_battery_level from VacuumEntity \u00b6 Task: Remove deprecated battery level attribute from vacuum.py File: custom_components/robovac/vacuum.py Search for: _attr_battery_level declarations battery_level property Any references to battery level in entity Modification: Remove attribute declaration (if exists) Remove property (if exists) Ensure battery sensor component handles battery reporting independently Validation: Check that battery sensor in sensor.py is unaffected Run full test suite Verify no regressions Run tests: task test Step 1.4: Commit Changes \u00b6 Commit message: fix: remove deprecated battery feature from vacuum models Remove VacuumEntityFeature.BATTERY from all 35 vacuum models to prepare for Home Assistant 2026.8 compatibility. - Remove battery feature flag from homeassistant_features - Maintain battery command mappings for backward compatibility - Battery reporting continues via dedicated battery sensor - No breaking changes for existing users Refs: #171 Phase 2: Error Message Improvements (Test-First) \u00b6 Step 2.1: Write Failing Tests for Error Messages \u00b6 Task: Create test file for error message enhancements File: tests/test_errors.py Test Cases: # Test 1: Verify typo fix - \"Laser sensor stuck\" not \"Laser sesor stuck\" # Test 2: Test getErrorMessage() returns correct messages # Test 3: Test getErrorMessageWithContext() returns message + context # Test 4: Test context includes troubleshooting steps # Test 5: Test context includes series-specific guidance # Test 6: Test unknown error codes return gracefully Implementation Details: Test error code 19 returns \"Laser sensor stuck\" Test getErrorMessageWithContext(19) returns dict with 'message', 'troubleshooting', 'common_causes' Test contextual information is helpful and actionable Test function handles None, str, and int error codes Run tests (should fail): task test tests/test_errors.py Step 2.2: Fix Typo in ERROR_MESSAGES \u00b6 Task: Fix \"sesor\" \u2192 \"sensor\" typo File: custom_components/robovac/errors.py Change: # Line 20 # BEFORE: 19: \"Laser sesor stuck\", # AFTER: 19: \"Laser sensor stuck\", Run tests (should pass typo test): task test tests/test_errors.py::test_laser_sensor_typo_fixed Step 2.3: Implement getErrorMessageWithContext() \u00b6 Task: Add enhanced error messaging function File: custom_components/robovac/errors.py Function signature: def getErrorMessageWithContext( code: str | int, model_code: str | None = None ) -> dict[str, str | list[str]]: \"\"\"Get error message with troubleshooting context. Args: code: The error code to look up model_code: Optional model code for model-specific guidance Returns: Dictionary containing: - message: The error message - troubleshooting: List of troubleshooting steps - common_causes: List of common causes - series_info: Model series-specific information (if applicable) \"\"\" Implementation Details: Build on existing ERROR_MESSAGES dict Add TROUBLESHOOTING_CONTEXT dict with error-specific guidance Detect model series (C, G, L, X) from model_code if provided Return structured dict with actionable information Handle missing/unknown codes gracefully Error context examples: TROUBLESHOOTING_CONTEXT = { 1: { # Front bumper stuck \"troubleshooting\": [ \"Check front bumper for obstructions\", \"Clean bumper sensors\", \"Ensure bumper moves freely\" ], \"common_causes\": [ \"Hair or debris blocking bumper\", \"Damaged bumper spring\", \"Sensor misalignment\" ] }, 19: { # Laser sensor stuck \"troubleshooting\": [ \"Remove any stickers or tape from laser sensor\", \"Clean laser sensor cover\", \"Check for physical damage to sensor\", \"Restart vacuum\" ], \"common_causes\": [ \"Protective film not removed\", \"Dust or debris on sensor\", \"Physical damage to sensor cover\" ] }, # ... add for other common errors } Run tests (should pass): task test tests/test_errors.py Step 2.4: Add Type Hints and Documentation \u00b6 Task: Ensure all error functions have proper typing Files: custom_components/robovac/errors.py Requirements: Add type hints to all functions Add comprehensive docstrings (Google style) Document return types clearly Add examples in docstrings Run type check: task type-check Step 2.5: Commit Changes \u00b6 Commit message: feat: enhance error messages with troubleshooting context Add getErrorMessageWithContext() function to provide users with actionable troubleshooting steps and common causes for error codes. - Fix typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\" - Add TROUBLESHOOTING_CONTEXT with detailed guidance - Support model series-specific troubleshooting - Maintain backward compatibility with getErrorMessage() Refs: #171 Phase 3: Model Validator Library (Test-First) \u00b6 Step 3.1: Write Failing Tests for Model Validator \u00b6 Task: Create comprehensive test file for model validator File: tests/test_model_validator.py Test Cases: # Series Detection Tests # Test 1: Detect C series (RoboVac C models) # Test 2: Detect G series (RoboVac G series) # Test 3: Detect L series (Clean L series) # Test 4: Detect X series (RoboVac X series) # Test 5: Handle unknown series # Test 6: Handle None/invalid model codes # Model Validation Tests # Test 7: Validate supported models return True # Test 8: Validate unsupported models return False # Test 9: Get model list # Test 10: Get supported model for device code (T2278 \u2192 T2278) # Suggestion Tests # Test 11: Suggest similar models for unsupported model # Test 12: Suggest series alternatives # Test 13: Handle edge cases (empty suggestions) # Troubleshooting Tests # Test 14: Get series-specific troubleshooting guide # Test 15: Get general troubleshooting guide # Test 16: Validate troubleshooting content is helpful Implementation Details: Test all public functions Test edge cases and error handling Mock ROBOVAC_MODELS import Verify series detection logic Validate suggestion algorithm Run tests (should fail): task test tests/test_model_validator.py Step 3.2: Create Model Validator Module \u00b6 Task: Implement model validator library File: custom_components/robovac/model_validator.py Module structure: \"\"\"Model validation and series detection for RoboVac devices. This module provides utilities for validating RoboVac model codes, detecting model series (C, G, L, X), and providing troubleshooting guidance for unsupported models. \"\"\" from typing import Dict, List, Optional, Tuple import re # Series detection patterns SERIES_PATTERNS = { 'C': r'^T2(103|123)$', # RoboVac C series 'G': r'^T2(150|261)$', # RoboVac G series 'L': r'^T2(2[67][0-9]|278|320)$', # Clean L series 'X': r'^T2(080|117|118|119|120|128|130|132|181|190|192|193|194|25[0-9]|262)$', # RoboVac X series } def detect_series(model_code: str) -> Optional[str]: \"\"\"Detect the series of a RoboVac model.\"\"\" def is_supported_model(model_code: str) -> bool: \"\"\"Check if a model code is supported.\"\"\" def get_supported_models() -> List[str]: \"\"\"Get list of all supported model codes.\"\"\" def suggest_similar_models(model_code: str, max_suggestions: int = 5) -> List[Tuple[str, str]]: \"\"\"Suggest similar supported models for an unsupported model.\"\"\" def get_troubleshooting_guide(model_code: str) -> Dict[str, str | List[str]]: \"\"\"Get series-specific troubleshooting guide.\"\"\" Implementation Requirements: Import ROBOVAC_MODELS from vacuums. init Use regex for series detection Implement similarity algorithm for suggestions Provide comprehensive troubleshooting guides per series Handle import failures gracefully (for standalone usage) Add full type hints Add comprehensive docstrings Run tests (should pass): task test tests/test_model_validator.py Step 3.3: Add Type Hints and Linting \u00b6 Task: Ensure code quality standards Files: custom_components/robovac/model_validator.py Requirements: Run task lint Run task type-check Fix any violations Ensure all functions have type hints Ensure all functions have docstrings Run quality checks: task lint task type-check Step 3.4: Commit Changes \u00b6 Commit message: feat: add model validator library with series detection Add model_validator.py module to provide: - Automatic model series identification (C, G, L, X) - Model validation against supported models - Smart suggestions for unsupported models - Series-specific troubleshooting guides Refs: #171 Phase 4: Model Validator CLI Tool (Test-First) \u00b6 Step 4.1: Write Tests for CLI Tool \u00b6 Task: Create test file for CLI functionality File: tests/test_model_validator_cli.py Test Cases: # Argument Parsing Tests # Test 1: Parse model code argument # Test 2: Parse --list flag # Test 3: Parse --help flag # Test 4: Handle missing arguments # Output Tests # Test 5: Supported model shows success message # Test 6: Unsupported model shows suggestions # Test 7: List mode shows all models # Test 8: Output format is user-friendly # Integration Tests # Test 9: Standalone mode works without imports # Test 10: Integrated mode uses actual ROBOVAC_MODELS Implementation Details: Use unittest.mock for subprocess testing Mock sys.argv for argument testing Capture stdout/stderr Test CLI exit codes (0 = success, 1 = error) Run tests (should fail): task test tests/test_model_validator_cli.py Step 4.2: Create CLI Tool \u00b6 Task: Implement standalone CLI tool File: custom_components/robovac/model_validator_cli.py Module structure: #!/usr/bin/env python3 \"\"\"Standalone CLI tool for RoboVac model validation. This tool can be used independently to validate RoboVac model compatibility and get suggestions for unsupported models. Usage: python model_validator_cli.py T2278 python model_validator_cli.py --list \"\"\" import argparse import sys from typing import Optional try: from .model_validator import ( is_supported_model, get_supported_models, suggest_similar_models, get_troubleshooting_guide, detect_series ) STANDALONE = False except ImportError: # Fallback for standalone usage STANDALONE = True # Minimal implementation with hardcoded model list def main(): \"\"\"Main CLI entry point.\"\"\" parser = argparse.ArgumentParser( description=\"Validate RoboVac model compatibility\" ) parser.add_argument( \"model\", nargs=\"?\", help=\"Model code to validate (e.g., T2278)\" ) parser.add_argument( \"--list\", action=\"store_true\", help=\"List all supported models\" ) args = parser.parse_args() # Implementation if __name__ == \"__main__\": sys.exit(main()) Implementation Requirements: Use argparse for CLI arguments Provide clean, user-friendly output Use colors if terminal supports (optional) Handle errors gracefully Support standalone mode (fallback if module import fails) Make executable with shebang Exit with appropriate codes (0 = success, 1 = error, 2 = validation failure) Run tests (should pass): task test tests/test_model_validator_cli.py Step 4.3: Add Documentation and Make Executable \u00b6 Task: Finalize CLI tool Files: custom_components/robovac/model_validator_cli.py README.md (add usage documentation) Requirements: Add comprehensive --help text Add usage examples in docstring Update README.md with CLI tool section Test manually: python custom_components/robovac/model_validator_cli.py T2278 Run lint: task lint Step 4.4: Commit Changes \u00b6 Commit message: feat: add standalone CLI tool for model validation Add model_validator_cli.py tool for users to validate RoboVac model compatibility before setting up integration. - Supports standalone usage without integration installed - Shows model validation status - Suggests similar models for unsupported devices - Lists all supported models with --list flag - Provides troubleshooting guidance Usage: python model_validator_cli.py T2278 Refs: #171 Phase 5: Integration and Documentation \u00b6 Step 5.1: Integration Tests \u00b6 Task: Create end-to-end integration tests File: tests/test_integration_pr171.py Test Cases: # Test 1: Vacuum entity initializes without battery feature # Test 2: Battery sensor still reports battery level # Test 3: Error messages include context when displayed # Test 4: Model validator works with actual vacuum models # Test 5: CLI tool works with integration Run tests: task test tests/test_integration_pr171.py Step 5.2: Update Documentation \u00b6 Task: Update project documentation Files to update: README.md : Add model validator CLI usage DEVELOPMENT.md : Document error context system CHANGELOG.md : Add entry for this feature set README.md additions: ## Model Validation Before setting up the integration, you can validate if your RoboVac model is supported: ```bash python custom_components/robovac/model_validator_cli.py T2278 To see all supported models: python custom_components/robovac/model_validator_cli.py --list Run markdown lint: npx markdownlint-cli2 \"**/*.md\" Step 5.3: Full Test Suite \u00b6 Task: Run complete test suite Commands: task lint task type-check task test Validation: All tests pass No linting errors No type checking errors No markdown lint errors Test coverage maintained or improved Step 5.4: Final Commit \u00b6 Commit message: docs: update documentation for PR #171 features Add documentation for: - Model validator CLI tool usage - Error message improvements - Battery deprecation changes - Integration guide updates Refs: #171 Phase 6: Review and Cleanup \u00b6 Step 6.1: Code Review Checklist \u00b6 [ ] All tests pass [ ] Type hints on all new functions [ ] Docstrings follow Google style [ ] No flake8 violations [ ] No markdown lint errors [ ] Follows existing code patterns [ ] No code duplication [ ] Error handling comprehensive [ ] Backward compatibility maintained [ ] No breaking changes Step 6.2: Create Summary Document \u00b6 Task: Create summary of changes for review File: IMPLEMENTATION_SUMMARY_PR171.md Contents: List of all files modified/created Test coverage report Key design decisions Migration guide (if needed) Known limitations Future improvements Step 6.3: Final Validation \u00b6 Task: Run full validation suite # Run all tests task test # Check code quality task lint task type-check # Verify documentation npx markdownlint-cli2 \"**/*.md\" # Manual testing python custom_components/robovac/model_validator_cli.py T2278 python custom_components/robovac/model_validator_cli.py T9999 python custom_components/robovac/model_validator_cli.py --list Execution Notes for LLM \u00b6 TDD Workflow \u00b6 Always write tests first - Tests define expected behavior Run tests (should fail) - Confirms tests are actually testing something Implement minimal code - Just enough to pass tests Run tests (should pass) - Confirms implementation works Refactor if needed - Improve code while keeping tests green Commit - Small, focused commits with conventional commit messages Code Quality Standards \u00b6 Type hints: Required on all function parameters and returns Docstrings: Google style, required on all public functions Linting: Run task lint before committing Type checking: Run task type-check before committing Testing: Run task test after each phase Testing Commands \u00b6 # Run specific test file task test tests/test_model_validator.py # Run specific test function task test tests/test_model_validator.py::test_detect_c_series # Run all tests task test # Run with coverage ```bash task test --cov Commit Message Format \u00b6 <type>: <description> <body> Refs: #171 Types: feat , fix , refactor , test , docs , chore File Modification Strategy \u00b6 Read file first to understand structure Make minimal changes Preserve existing formatting Use multi_edit for batch updates Run tests after each file modification Error Handling \u00b6 Always handle None/null cases Provide meaningful error messages Don't crash on unexpected input Log errors appropriately (DEBUG level for expected errors) Dependencies \u00b6 Don't add new external dependencies without explicit approval Use stdlib where possible Leverage existing project utilities Success Criteria \u00b6 Must Have \u00b6 [ ] All 35 vacuum models have battery feature removed [ ] Error message typo fixed [ ] getErrorMessageWithContext() implemented and tested [ ] model_validator.py implemented and tested [ ] model_validator_cli.py implemented and tested [ ] All tests pass [ ] No linting errors [ ] No type checking errors [ ] Documentation updated Should Have \u00b6 [ ] Integration tests pass [ ] Test coverage \u2265 90% for new code [ ] CLI tool tested manually [ ] README examples work [ ] Backward compatibility verified Nice to Have \u00b6 [ ] Performance benchmarks [ ] User testimonials [ ] Video demo of CLI tool [ ] Blog post about features Timeline Estimate \u00b6 Phase 1: Battery Deprecation - 2-3 hours Phase 2: Error Messages - 2-3 hours Phase 3: Model Validator Library - 3-4 hours Phase 4: CLI Tool - 2-3 hours Phase 5: Integration & Docs - 2-3 hours Phase 6: Review & Cleanup - 1-2 hours Total: 12-18 hours of focused development Questions/Clarifications Needed \u00b6 Should model_validator.py be exposed as a public API? Should CLI tool be installed system-wide or just in project? Any specific Home Assistant version requirements? Should we add warnings for deprecated battery feature in logs? Performance requirements for model suggestion algorithm? References \u00b6 PR #171: https://github.com/damacus/robovac/pull/171 Home Assistant 2026.8 Deprecations Project coding standards: .windsurf/rules/ Test patterns: tests/test_vacuum/test_t2278_command_mappings.py","title":"Implementation Plan: PR #171 - Battery Deprecation &amp; Model Validation"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#implementation-plan-pr-171-battery-deprecation-model-validation","text":"","title":"Implementation Plan: PR #171 - Battery Deprecation &amp; Model Validation"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#pr-review-summary","text":"","title":"PR Review Summary"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#changes-from-pr-171","text":"Battery Deprecation Fixes (HA 2026.8 compatibility) Remove VacuumEntityFeature.BATTERY from 35+ vacuum models Remove deprecated _attr_battery_level from vacuum.py entity Maintain existing battery sensor functionality (no breaking changes) Error Handling Improvements Fix typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\" Add getErrorMessageWithContext() function with actionable troubleshooting Enhanced error messages with user guidance Model Validation Tools model_validator.py : Library module with series detection (C, G, L, X series) model_validator_cli.py : Standalone CLI tool for users Automatic unsupported model suggestions Series-specific troubleshooting guides","title":"Changes from PR #171"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#code-review-findings","text":"Style Issues: Generally clean, follows Python conventions Some flake8 violations were fixed in PR (whitespace, line breaks) Type hints need to be added for new functions Conciseness: Model validator has good abstraction with series detection Error context function could be more modular CLI tool has appropriate separation from library Readability: Clear function names and structure Some functions are long and could benefit from decomposition Documentation is comprehensive Maintainability: Series detection makes adding new models easier Model list is centralized (good) CLI tool has fallback for standalone usage (good) Tests needed for all new functionality","title":"Code Review Findings"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#implementation-plan","text":"","title":"Implementation Plan"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-1-battery-deprecation-test-first","text":"","title":"Phase 1: Battery Deprecation (Test-First)"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-11-write-failing-tests-for-battery-feature-removal","text":"Task: Create test file for battery feature validation File: tests/test_vacuum/test_battery_feature_removal.py Test Cases: # Test 1: Verify VacuumEntityFeature.BATTERY is NOT in homeassistant_features for all models # Test 2: Verify battery command mappings still exist (backward compatibility) # Test 3: Verify battery level property is removed from vacuum entity # Test 4: Verify battery sensor still works independently Implementation Details: Import all vacuum models from custom_components/robovac/vacuums Iterate through all T* models Assert VacuumEntityFeature.BATTERY not in homeassistant_features Assert RobovacCommand.BATTERY still exists in commands Verify vacuum entity does not have _attr_battery_level attribute Run tests (should fail): task test tests/test_vacuum/test_battery_feature_removal.py","title":"Step 1.1: Write Failing Tests for Battery Feature Removal"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-12-remove-battery-feature-from-vacuum-models","text":"Task: Remove VacuumEntityFeature.BATTERY from all 35 vacuum model files Files to modify: All vacuum models in custom_components/robovac/vacuums/T2*.py Pattern to apply: # BEFORE: homeassistant_features = ( VacuumEntityFeature.BATTERY | VacuumEntityFeature.FAN_SPEED | ... ) # AFTER: homeassistant_features = ( VacuumEntityFeature.FAN_SPEED | ... ) Models to update: (35 files) T2080, T2103, T2117, T2118, T2119, T2120, T2123, T2128, T2130, T2132 T2150, T2181, T2190, T2192, T2193, T2194, T2250, T2251, T2252, T2253 T2254, T2255, T2259, T2261, T2262, T2267, T2268, T2270, T2272, T2273 T2275, T2276, T2277, T2278, T2320 Implementation: Use multi_edit tool for batch updates Preserve all other features and command mappings Maintain code formatting and structure Run tests (should pass): task test tests/test_vacuum/test_battery_feature_removal.py","title":"Step 1.2: Remove Battery Feature from Vacuum Models"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-13-remove-_attr_battery_level-from-vacuumentity","text":"Task: Remove deprecated battery level attribute from vacuum.py File: custom_components/robovac/vacuum.py Search for: _attr_battery_level declarations battery_level property Any references to battery level in entity Modification: Remove attribute declaration (if exists) Remove property (if exists) Ensure battery sensor component handles battery reporting independently Validation: Check that battery sensor in sensor.py is unaffected Run full test suite Verify no regressions Run tests: task test","title":"Step 1.3: Remove _attr_battery_level from VacuumEntity"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-14-commit-changes","text":"Commit message: fix: remove deprecated battery feature from vacuum models Remove VacuumEntityFeature.BATTERY from all 35 vacuum models to prepare for Home Assistant 2026.8 compatibility. - Remove battery feature flag from homeassistant_features - Maintain battery command mappings for backward compatibility - Battery reporting continues via dedicated battery sensor - No breaking changes for existing users Refs: #171","title":"Step 1.4: Commit Changes"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-2-error-message-improvements-test-first","text":"","title":"Phase 2: Error Message Improvements (Test-First)"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-21-write-failing-tests-for-error-messages","text":"Task: Create test file for error message enhancements File: tests/test_errors.py Test Cases: # Test 1: Verify typo fix - \"Laser sensor stuck\" not \"Laser sesor stuck\" # Test 2: Test getErrorMessage() returns correct messages # Test 3: Test getErrorMessageWithContext() returns message + context # Test 4: Test context includes troubleshooting steps # Test 5: Test context includes series-specific guidance # Test 6: Test unknown error codes return gracefully Implementation Details: Test error code 19 returns \"Laser sensor stuck\" Test getErrorMessageWithContext(19) returns dict with 'message', 'troubleshooting', 'common_causes' Test contextual information is helpful and actionable Test function handles None, str, and int error codes Run tests (should fail): task test tests/test_errors.py","title":"Step 2.1: Write Failing Tests for Error Messages"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-22-fix-typo-in-error_messages","text":"Task: Fix \"sesor\" \u2192 \"sensor\" typo File: custom_components/robovac/errors.py Change: # Line 20 # BEFORE: 19: \"Laser sesor stuck\", # AFTER: 19: \"Laser sensor stuck\", Run tests (should pass typo test): task test tests/test_errors.py::test_laser_sensor_typo_fixed","title":"Step 2.2: Fix Typo in ERROR_MESSAGES"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-23-implement-geterrormessagewithcontext","text":"Task: Add enhanced error messaging function File: custom_components/robovac/errors.py Function signature: def getErrorMessageWithContext( code: str | int, model_code: str | None = None ) -> dict[str, str | list[str]]: \"\"\"Get error message with troubleshooting context. Args: code: The error code to look up model_code: Optional model code for model-specific guidance Returns: Dictionary containing: - message: The error message - troubleshooting: List of troubleshooting steps - common_causes: List of common causes - series_info: Model series-specific information (if applicable) \"\"\" Implementation Details: Build on existing ERROR_MESSAGES dict Add TROUBLESHOOTING_CONTEXT dict with error-specific guidance Detect model series (C, G, L, X) from model_code if provided Return structured dict with actionable information Handle missing/unknown codes gracefully Error context examples: TROUBLESHOOTING_CONTEXT = { 1: { # Front bumper stuck \"troubleshooting\": [ \"Check front bumper for obstructions\", \"Clean bumper sensors\", \"Ensure bumper moves freely\" ], \"common_causes\": [ \"Hair or debris blocking bumper\", \"Damaged bumper spring\", \"Sensor misalignment\" ] }, 19: { # Laser sensor stuck \"troubleshooting\": [ \"Remove any stickers or tape from laser sensor\", \"Clean laser sensor cover\", \"Check for physical damage to sensor\", \"Restart vacuum\" ], \"common_causes\": [ \"Protective film not removed\", \"Dust or debris on sensor\", \"Physical damage to sensor cover\" ] }, # ... add for other common errors } Run tests (should pass): task test tests/test_errors.py","title":"Step 2.3: Implement getErrorMessageWithContext()"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-24-add-type-hints-and-documentation","text":"Task: Ensure all error functions have proper typing Files: custom_components/robovac/errors.py Requirements: Add type hints to all functions Add comprehensive docstrings (Google style) Document return types clearly Add examples in docstrings Run type check: task type-check","title":"Step 2.4: Add Type Hints and Documentation"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-25-commit-changes","text":"Commit message: feat: enhance error messages with troubleshooting context Add getErrorMessageWithContext() function to provide users with actionable troubleshooting steps and common causes for error codes. - Fix typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\" - Add TROUBLESHOOTING_CONTEXT with detailed guidance - Support model series-specific troubleshooting - Maintain backward compatibility with getErrorMessage() Refs: #171","title":"Step 2.5: Commit Changes"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-3-model-validator-library-test-first","text":"","title":"Phase 3: Model Validator Library (Test-First)"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-31-write-failing-tests-for-model-validator","text":"Task: Create comprehensive test file for model validator File: tests/test_model_validator.py Test Cases: # Series Detection Tests # Test 1: Detect C series (RoboVac C models) # Test 2: Detect G series (RoboVac G series) # Test 3: Detect L series (Clean L series) # Test 4: Detect X series (RoboVac X series) # Test 5: Handle unknown series # Test 6: Handle None/invalid model codes # Model Validation Tests # Test 7: Validate supported models return True # Test 8: Validate unsupported models return False # Test 9: Get model list # Test 10: Get supported model for device code (T2278 \u2192 T2278) # Suggestion Tests # Test 11: Suggest similar models for unsupported model # Test 12: Suggest series alternatives # Test 13: Handle edge cases (empty suggestions) # Troubleshooting Tests # Test 14: Get series-specific troubleshooting guide # Test 15: Get general troubleshooting guide # Test 16: Validate troubleshooting content is helpful Implementation Details: Test all public functions Test edge cases and error handling Mock ROBOVAC_MODELS import Verify series detection logic Validate suggestion algorithm Run tests (should fail): task test tests/test_model_validator.py","title":"Step 3.1: Write Failing Tests for Model Validator"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-32-create-model-validator-module","text":"Task: Implement model validator library File: custom_components/robovac/model_validator.py Module structure: \"\"\"Model validation and series detection for RoboVac devices. This module provides utilities for validating RoboVac model codes, detecting model series (C, G, L, X), and providing troubleshooting guidance for unsupported models. \"\"\" from typing import Dict, List, Optional, Tuple import re # Series detection patterns SERIES_PATTERNS = { 'C': r'^T2(103|123)$', # RoboVac C series 'G': r'^T2(150|261)$', # RoboVac G series 'L': r'^T2(2[67][0-9]|278|320)$', # Clean L series 'X': r'^T2(080|117|118|119|120|128|130|132|181|190|192|193|194|25[0-9]|262)$', # RoboVac X series } def detect_series(model_code: str) -> Optional[str]: \"\"\"Detect the series of a RoboVac model.\"\"\" def is_supported_model(model_code: str) -> bool: \"\"\"Check if a model code is supported.\"\"\" def get_supported_models() -> List[str]: \"\"\"Get list of all supported model codes.\"\"\" def suggest_similar_models(model_code: str, max_suggestions: int = 5) -> List[Tuple[str, str]]: \"\"\"Suggest similar supported models for an unsupported model.\"\"\" def get_troubleshooting_guide(model_code: str) -> Dict[str, str | List[str]]: \"\"\"Get series-specific troubleshooting guide.\"\"\" Implementation Requirements: Import ROBOVAC_MODELS from vacuums. init Use regex for series detection Implement similarity algorithm for suggestions Provide comprehensive troubleshooting guides per series Handle import failures gracefully (for standalone usage) Add full type hints Add comprehensive docstrings Run tests (should pass): task test tests/test_model_validator.py","title":"Step 3.2: Create Model Validator Module"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-33-add-type-hints-and-linting","text":"Task: Ensure code quality standards Files: custom_components/robovac/model_validator.py Requirements: Run task lint Run task type-check Fix any violations Ensure all functions have type hints Ensure all functions have docstrings Run quality checks: task lint task type-check","title":"Step 3.3: Add Type Hints and Linting"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-34-commit-changes","text":"Commit message: feat: add model validator library with series detection Add model_validator.py module to provide: - Automatic model series identification (C, G, L, X) - Model validation against supported models - Smart suggestions for unsupported models - Series-specific troubleshooting guides Refs: #171","title":"Step 3.4: Commit Changes"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-4-model-validator-cli-tool-test-first","text":"","title":"Phase 4: Model Validator CLI Tool (Test-First)"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-41-write-tests-for-cli-tool","text":"Task: Create test file for CLI functionality File: tests/test_model_validator_cli.py Test Cases: # Argument Parsing Tests # Test 1: Parse model code argument # Test 2: Parse --list flag # Test 3: Parse --help flag # Test 4: Handle missing arguments # Output Tests # Test 5: Supported model shows success message # Test 6: Unsupported model shows suggestions # Test 7: List mode shows all models # Test 8: Output format is user-friendly # Integration Tests # Test 9: Standalone mode works without imports # Test 10: Integrated mode uses actual ROBOVAC_MODELS Implementation Details: Use unittest.mock for subprocess testing Mock sys.argv for argument testing Capture stdout/stderr Test CLI exit codes (0 = success, 1 = error) Run tests (should fail): task test tests/test_model_validator_cli.py","title":"Step 4.1: Write Tests for CLI Tool"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-42-create-cli-tool","text":"Task: Implement standalone CLI tool File: custom_components/robovac/model_validator_cli.py Module structure: #!/usr/bin/env python3 \"\"\"Standalone CLI tool for RoboVac model validation. This tool can be used independently to validate RoboVac model compatibility and get suggestions for unsupported models. Usage: python model_validator_cli.py T2278 python model_validator_cli.py --list \"\"\" import argparse import sys from typing import Optional try: from .model_validator import ( is_supported_model, get_supported_models, suggest_similar_models, get_troubleshooting_guide, detect_series ) STANDALONE = False except ImportError: # Fallback for standalone usage STANDALONE = True # Minimal implementation with hardcoded model list def main(): \"\"\"Main CLI entry point.\"\"\" parser = argparse.ArgumentParser( description=\"Validate RoboVac model compatibility\" ) parser.add_argument( \"model\", nargs=\"?\", help=\"Model code to validate (e.g., T2278)\" ) parser.add_argument( \"--list\", action=\"store_true\", help=\"List all supported models\" ) args = parser.parse_args() # Implementation if __name__ == \"__main__\": sys.exit(main()) Implementation Requirements: Use argparse for CLI arguments Provide clean, user-friendly output Use colors if terminal supports (optional) Handle errors gracefully Support standalone mode (fallback if module import fails) Make executable with shebang Exit with appropriate codes (0 = success, 1 = error, 2 = validation failure) Run tests (should pass): task test tests/test_model_validator_cli.py","title":"Step 4.2: Create CLI Tool"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-43-add-documentation-and-make-executable","text":"Task: Finalize CLI tool Files: custom_components/robovac/model_validator_cli.py README.md (add usage documentation) Requirements: Add comprehensive --help text Add usage examples in docstring Update README.md with CLI tool section Test manually: python custom_components/robovac/model_validator_cli.py T2278 Run lint: task lint","title":"Step 4.3: Add Documentation and Make Executable"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-44-commit-changes","text":"Commit message: feat: add standalone CLI tool for model validation Add model_validator_cli.py tool for users to validate RoboVac model compatibility before setting up integration. - Supports standalone usage without integration installed - Shows model validation status - Suggests similar models for unsupported devices - Lists all supported models with --list flag - Provides troubleshooting guidance Usage: python model_validator_cli.py T2278 Refs: #171","title":"Step 4.4: Commit Changes"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-5-integration-and-documentation","text":"","title":"Phase 5: Integration and Documentation"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-51-integration-tests","text":"Task: Create end-to-end integration tests File: tests/test_integration_pr171.py Test Cases: # Test 1: Vacuum entity initializes without battery feature # Test 2: Battery sensor still reports battery level # Test 3: Error messages include context when displayed # Test 4: Model validator works with actual vacuum models # Test 5: CLI tool works with integration Run tests: task test tests/test_integration_pr171.py","title":"Step 5.1: Integration Tests"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-52-update-documentation","text":"Task: Update project documentation Files to update: README.md : Add model validator CLI usage DEVELOPMENT.md : Document error context system CHANGELOG.md : Add entry for this feature set README.md additions: ## Model Validation Before setting up the integration, you can validate if your RoboVac model is supported: ```bash python custom_components/robovac/model_validator_cli.py T2278 To see all supported models: python custom_components/robovac/model_validator_cli.py --list Run markdown lint: npx markdownlint-cli2 \"**/*.md\"","title":"Step 5.2: Update Documentation"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-53-full-test-suite","text":"Task: Run complete test suite Commands: task lint task type-check task test Validation: All tests pass No linting errors No type checking errors No markdown lint errors Test coverage maintained or improved","title":"Step 5.3: Full Test Suite"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-54-final-commit","text":"Commit message: docs: update documentation for PR #171 features Add documentation for: - Model validator CLI tool usage - Error message improvements - Battery deprecation changes - Integration guide updates Refs: #171","title":"Step 5.4: Final Commit"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-6-review-and-cleanup","text":"","title":"Phase 6: Review and Cleanup"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-61-code-review-checklist","text":"[ ] All tests pass [ ] Type hints on all new functions [ ] Docstrings follow Google style [ ] No flake8 violations [ ] No markdown lint errors [ ] Follows existing code patterns [ ] No code duplication [ ] Error handling comprehensive [ ] Backward compatibility maintained [ ] No breaking changes","title":"Step 6.1: Code Review Checklist"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-62-create-summary-document","text":"Task: Create summary of changes for review File: IMPLEMENTATION_SUMMARY_PR171.md Contents: List of all files modified/created Test coverage report Key design decisions Migration guide (if needed) Known limitations Future improvements","title":"Step 6.2: Create Summary Document"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-63-final-validation","text":"Task: Run full validation suite # Run all tests task test # Check code quality task lint task type-check # Verify documentation npx markdownlint-cli2 \"**/*.md\" # Manual testing python custom_components/robovac/model_validator_cli.py T2278 python custom_components/robovac/model_validator_cli.py T9999 python custom_components/robovac/model_validator_cli.py --list","title":"Step 6.3: Final Validation"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#execution-notes-for-llm","text":"","title":"Execution Notes for LLM"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#tdd-workflow","text":"Always write tests first - Tests define expected behavior Run tests (should fail) - Confirms tests are actually testing something Implement minimal code - Just enough to pass tests Run tests (should pass) - Confirms implementation works Refactor if needed - Improve code while keeping tests green Commit - Small, focused commits with conventional commit messages","title":"TDD Workflow"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#code-quality-standards","text":"Type hints: Required on all function parameters and returns Docstrings: Google style, required on all public functions Linting: Run task lint before committing Type checking: Run task type-check before committing Testing: Run task test after each phase","title":"Code Quality Standards"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#testing-commands","text":"# Run specific test file task test tests/test_model_validator.py # Run specific test function task test tests/test_model_validator.py::test_detect_c_series # Run all tests task test # Run with coverage ```bash task test --cov","title":"Testing Commands"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#commit-message-format","text":"<type>: <description> <body> Refs: #171 Types: feat , fix , refactor , test , docs , chore","title":"Commit Message Format"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#file-modification-strategy","text":"Read file first to understand structure Make minimal changes Preserve existing formatting Use multi_edit for batch updates Run tests after each file modification","title":"File Modification Strategy"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#error-handling","text":"Always handle None/null cases Provide meaningful error messages Don't crash on unexpected input Log errors appropriately (DEBUG level for expected errors)","title":"Error Handling"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#dependencies","text":"Don't add new external dependencies without explicit approval Use stdlib where possible Leverage existing project utilities","title":"Dependencies"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#success-criteria","text":"","title":"Success Criteria"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#must-have","text":"[ ] All 35 vacuum models have battery feature removed [ ] Error message typo fixed [ ] getErrorMessageWithContext() implemented and tested [ ] model_validator.py implemented and tested [ ] model_validator_cli.py implemented and tested [ ] All tests pass [ ] No linting errors [ ] No type checking errors [ ] Documentation updated","title":"Must Have"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#should-have","text":"[ ] Integration tests pass [ ] Test coverage \u2265 90% for new code [ ] CLI tool tested manually [ ] README examples work [ ] Backward compatibility verified","title":"Should Have"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#nice-to-have","text":"[ ] Performance benchmarks [ ] User testimonials [ ] Video demo of CLI tool [ ] Blog post about features","title":"Nice to Have"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#timeline-estimate","text":"Phase 1: Battery Deprecation - 2-3 hours Phase 2: Error Messages - 2-3 hours Phase 3: Model Validator Library - 3-4 hours Phase 4: CLI Tool - 2-3 hours Phase 5: Integration & Docs - 2-3 hours Phase 6: Review & Cleanup - 1-2 hours Total: 12-18 hours of focused development","title":"Timeline Estimate"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#questionsclarifications-needed","text":"Should model_validator.py be exposed as a public API? Should CLI tool be installed system-wide or just in project? Any specific Home Assistant version requirements? Should we add warnings for deprecated battery feature in logs? Performance requirements for model suggestion algorithm?","title":"Questions/Clarifications Needed"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#references","text":"PR #171: https://github.com/damacus/robovac/pull/171 Home Assistant 2026.8 Deprecations Project coding standards: .windsurf/rules/ Test patterns: tests/test_vacuum/test_t2278_command_mappings.py","title":"References"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/","text":"PR #171 Review Summary \u00b6 PR Link: https://github.com/damacus/robovac/pull/171 PR Title: Enhance user experience: battery deprecation fixes and model validation tools Status: Open, awaiting merge Review Conducted \u00b6 Reviewed PR #171 against the project's code style guidelines: \u2705 Conciseness: Good abstraction with series detection patterns \u2705 Readability: Clear function names and comprehensive documentation \u2705 Maintainability: Centralized model list, good separation of concerns \u26a0\ufe0f Style: Some flake8 violations were fixed in PR (addressed) Key Changes in PR #171 \u00b6 1. Battery Deprecation (HA 2026.8 Compatibility) \u00b6 Removes VacuumEntityFeature.BATTERY from 35+ vacuum models Removes _attr_battery_level from vacuum entity Impact: Prepares for Home Assistant 2026.8 deprecation Backward Compatibility: Battery sensor continues to work independently 2. Error Message Improvements \u00b6 Fixes typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\" Adds getErrorMessageWithContext() function with troubleshooting guidance Provides actionable error context for users 3. Model Validation Tools \u00b6 model_validator.py: Library module for model validation Series detection (C, G, L, X) Model similarity suggestions Series-specific troubleshooting model_validator_cli.py: Standalone CLI tool Validate model compatibility List supported models Get suggestions for unsupported models Implementation Plan Created \u00b6 A comprehensive, multi-phased implementation plan has been created: File: IMPLEMENTATION_PLAN_PR171.md Plan Structure \u00b6 Phase 1: Battery Deprecation (Test-First) \u00b6 Write failing tests for battery feature removal Remove battery feature from 35 vacuum models Remove _attr_battery_level from vacuum entity Verify battery sensor still works Phase 2: Error Message Improvements (Test-First) \u00b6 Write tests for error message enhancements Fix typo in error messages Implement getErrorMessageWithContext() function Add troubleshooting context dictionary Phase 3: Model Validator Library (Test-First) \u00b6 Write comprehensive tests for model validator Create model_validator.py module Implement series detection Add model suggestion algorithm Provide troubleshooting guides Phase 4: Model Validator CLI Tool (Test-First) \u00b6 Write tests for CLI functionality Create model_validator_cli.py tool Support standalone usage Add user-friendly output Phase 5: Integration and Documentation \u00b6 Create end-to-end integration tests Update README, DEVELOPMENT.md, CHANGELOG.md Run full test suite Validate all quality checks pass Phase 6: Review and Cleanup \u00b6 Complete code review checklist Create implementation summary Final validation Key Design Decisions \u00b6 TDD Approach \u00b6 All phases follow strict Test-Driven Development: Write failing tests first Implement minimal code to pass Refactor while keeping tests green Commit small, focused changes Code Quality Standards \u00b6 Type hints: Required on all functions Docstrings: Google style for all public functions Linting: Must pass task lint Type checking: Must pass task type-check Testing: Must pass task test Backward Compatibility \u00b6 No breaking changes for existing users Battery sensor continues to work via separate sensor component Error message function maintains existing interface Model validator gracefully handles import failures Success Criteria \u00b6 Must Have \u00b6 [ ] All 35 vacuum models have battery feature removed [ ] Error message typo fixed [ ] getErrorMessageWithContext() implemented and tested [ ] model_validator.py implemented and tested [ ] model_validator_cli.py implemented and tested [ ] All tests pass [ ] No linting errors [ ] No type checking errors [ ] Documentation updated Should Have \u00b6 [ ] Integration tests pass [ ] Test coverage \u2265 90% for new code [ ] CLI tool tested manually [ ] README examples work [ ] Backward compatibility verified Timeline Estimate \u00b6 Phase 1: Battery Deprecation - 2-3 hours Phase 2: Error Messages - 2-3 hours Phase 3: Model Validator Library - 3-4 hours Phase 4: CLI Tool - 2-3 hours Phase 5: Integration & Docs - 2-3 hours Phase 6: Review & Cleanup - 1-2 hours Total: 12-18 hours of focused development Next Steps for Implementer \u00b6 Read the full implementation plan: IMPLEMENTATION_PLAN_PR171.md Start with Phase 1, Step 1.1 (write failing tests) Follow TDD cycle strictly: Red \u2192 Green \u2192 Refactor Make small, atomic commits with conventional commit messages Run quality checks after each phase Update this summary as phases are completed Files to be Created/Modified \u00b6 New Files \u00b6 tests/test_vacuum/test_battery_feature_removal.py tests/test_errors.py tests/test_model_validator.py tests/test_model_validator_cli.py tests/test_integration_pr171.py custom_components/robovac/model_validator.py custom_components/robovac/model_validator_cli.py IMPLEMENTATION_SUMMARY_PR171.md (after completion) Modified Files \u00b6 All 35 vacuum model files in custom_components/robovac/vacuums/T2*.py custom_components/robovac/vacuum.py custom_components/robovac/errors.py README.md DEVELOPMENT.md CHANGELOG.md Questions to Clarify \u00b6 Should model_validator.py be exposed as a public API? Should CLI tool be installed system-wide or just in project? Any specific Home Assistant version requirements beyond 2026.8? Should we add deprecation warnings for battery feature in logs? Performance requirements for model suggestion algorithm? Notes \u00b6 PR has already addressed flake8 errors from initial review Author (magicalyak) is responsive and has fixed issues quickly CI needs maintainer approval to run on latest commits All Copilot review comments have been addressed or clarified Plan is detailed enough for another LLM to execute independently Conclusion \u00b6 PR #171 adds valuable features with good code quality. The implementation plan provides a comprehensive, test-first approach to replicate this functionality on the current branch while adhering to project coding standards. Recommendation: Follow the detailed implementation plan in IMPLEMENTATION_PLAN_PR171.md to implement these features with full test coverage and quality assurance.","title":"PR #171 Review Summary"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#pr-171-review-summary","text":"PR Link: https://github.com/damacus/robovac/pull/171 PR Title: Enhance user experience: battery deprecation fixes and model validation tools Status: Open, awaiting merge","title":"PR #171 Review Summary"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#review-conducted","text":"Reviewed PR #171 against the project's code style guidelines: \u2705 Conciseness: Good abstraction with series detection patterns \u2705 Readability: Clear function names and comprehensive documentation \u2705 Maintainability: Centralized model list, good separation of concerns \u26a0\ufe0f Style: Some flake8 violations were fixed in PR (addressed)","title":"Review Conducted"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#key-changes-in-pr-171","text":"","title":"Key Changes in PR #171"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#1-battery-deprecation-ha-20268-compatibility","text":"Removes VacuumEntityFeature.BATTERY from 35+ vacuum models Removes _attr_battery_level from vacuum entity Impact: Prepares for Home Assistant 2026.8 deprecation Backward Compatibility: Battery sensor continues to work independently","title":"1. Battery Deprecation (HA 2026.8 Compatibility)"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#2-error-message-improvements","text":"Fixes typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\" Adds getErrorMessageWithContext() function with troubleshooting guidance Provides actionable error context for users","title":"2. Error Message Improvements"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#3-model-validation-tools","text":"model_validator.py: Library module for model validation Series detection (C, G, L, X) Model similarity suggestions Series-specific troubleshooting model_validator_cli.py: Standalone CLI tool Validate model compatibility List supported models Get suggestions for unsupported models","title":"3. Model Validation Tools"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#implementation-plan-created","text":"A comprehensive, multi-phased implementation plan has been created: File: IMPLEMENTATION_PLAN_PR171.md","title":"Implementation Plan Created"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#plan-structure","text":"","title":"Plan Structure"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-1-battery-deprecation-test-first","text":"Write failing tests for battery feature removal Remove battery feature from 35 vacuum models Remove _attr_battery_level from vacuum entity Verify battery sensor still works","title":"Phase 1: Battery Deprecation (Test-First)"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-2-error-message-improvements-test-first","text":"Write tests for error message enhancements Fix typo in error messages Implement getErrorMessageWithContext() function Add troubleshooting context dictionary","title":"Phase 2: Error Message Improvements (Test-First)"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-3-model-validator-library-test-first","text":"Write comprehensive tests for model validator Create model_validator.py module Implement series detection Add model suggestion algorithm Provide troubleshooting guides","title":"Phase 3: Model Validator Library (Test-First)"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-4-model-validator-cli-tool-test-first","text":"Write tests for CLI functionality Create model_validator_cli.py tool Support standalone usage Add user-friendly output","title":"Phase 4: Model Validator CLI Tool (Test-First)"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-5-integration-and-documentation","text":"Create end-to-end integration tests Update README, DEVELOPMENT.md, CHANGELOG.md Run full test suite Validate all quality checks pass","title":"Phase 5: Integration and Documentation"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-6-review-and-cleanup","text":"Complete code review checklist Create implementation summary Final validation","title":"Phase 6: Review and Cleanup"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#key-design-decisions","text":"","title":"Key Design Decisions"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#tdd-approach","text":"All phases follow strict Test-Driven Development: Write failing tests first Implement minimal code to pass Refactor while keeping tests green Commit small, focused changes","title":"TDD Approach"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#code-quality-standards","text":"Type hints: Required on all functions Docstrings: Google style for all public functions Linting: Must pass task lint Type checking: Must pass task type-check Testing: Must pass task test","title":"Code Quality Standards"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#backward-compatibility","text":"No breaking changes for existing users Battery sensor continues to work via separate sensor component Error message function maintains existing interface Model validator gracefully handles import failures","title":"Backward Compatibility"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#success-criteria","text":"","title":"Success Criteria"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#must-have","text":"[ ] All 35 vacuum models have battery feature removed [ ] Error message typo fixed [ ] getErrorMessageWithContext() implemented and tested [ ] model_validator.py implemented and tested [ ] model_validator_cli.py implemented and tested [ ] All tests pass [ ] No linting errors [ ] No type checking errors [ ] Documentation updated","title":"Must Have"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#should-have","text":"[ ] Integration tests pass [ ] Test coverage \u2265 90% for new code [ ] CLI tool tested manually [ ] README examples work [ ] Backward compatibility verified","title":"Should Have"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#timeline-estimate","text":"Phase 1: Battery Deprecation - 2-3 hours Phase 2: Error Messages - 2-3 hours Phase 3: Model Validator Library - 3-4 hours Phase 4: CLI Tool - 2-3 hours Phase 5: Integration & Docs - 2-3 hours Phase 6: Review & Cleanup - 1-2 hours Total: 12-18 hours of focused development","title":"Timeline Estimate"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#next-steps-for-implementer","text":"Read the full implementation plan: IMPLEMENTATION_PLAN_PR171.md Start with Phase 1, Step 1.1 (write failing tests) Follow TDD cycle strictly: Red \u2192 Green \u2192 Refactor Make small, atomic commits with conventional commit messages Run quality checks after each phase Update this summary as phases are completed","title":"Next Steps for Implementer"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#files-to-be-createdmodified","text":"","title":"Files to be Created/Modified"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#new-files","text":"tests/test_vacuum/test_battery_feature_removal.py tests/test_errors.py tests/test_model_validator.py tests/test_model_validator_cli.py tests/test_integration_pr171.py custom_components/robovac/model_validator.py custom_components/robovac/model_validator_cli.py IMPLEMENTATION_SUMMARY_PR171.md (after completion)","title":"New Files"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#modified-files","text":"All 35 vacuum model files in custom_components/robovac/vacuums/T2*.py custom_components/robovac/vacuum.py custom_components/robovac/errors.py README.md DEVELOPMENT.md CHANGELOG.md","title":"Modified Files"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#questions-to-clarify","text":"Should model_validator.py be exposed as a public API? Should CLI tool be installed system-wide or just in project? Any specific Home Assistant version requirements beyond 2026.8? Should we add deprecation warnings for battery feature in logs? Performance requirements for model suggestion algorithm?","title":"Questions to Clarify"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#notes","text":"PR has already addressed flake8 errors from initial review Author (magicalyak) is responsive and has fixed issues quickly CI needs maintainer approval to run on latest commits All Copilot review comments have been addressed or clarified Plan is detailed enough for another LLM to execute independently","title":"Notes"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#conclusion","text":"PR #171 adds valuable features with good code quality. The implementation plan provides a comprehensive, test-first approach to replicate this functionality on the current branch while adhering to project coding standards. Recommendation: Follow the detailed implementation plan in IMPLEMENTATION_PLAN_PR171.md to implement these features with full test coverage and quality assurance.","title":"Conclusion"},{"location":"archive/pr171/QUICK_START_PR171/","text":"Quick Start Guide: Implementing PR #171 Features \u00b6 Overview \u00b6 This guide provides a quick reference for implementing the features from PR #171 on your current branch. Full details: See IMPLEMENTATION_PLAN_PR171.md What You're Building \u00b6 Battery Deprecation - Remove deprecated battery feature from 35+ vacuum models Error Context - Enhanced error messages with troubleshooting guidance Model Validator - Library for validating and suggesting model compatibility CLI Tool - Standalone tool for users to check model support Quick Start \u00b6 Step 1: Read the Plans \u00b6 # Review summary cat PR171_REVIEW_SUMMARY.md # Read full implementation plan cat IMPLEMENTATION_PLAN_PR171.md Step 2: Start Phase 1 \u00b6 # Create test file touch tests/test_vacuum/test_battery_feature_removal.py # Write failing tests first (see plan for test cases) # Then implement changes Step 3: Follow TDD Cycle \u00b6 For each phase: \u270d\ufe0f Write failing tests \u2705 Run tests (should fail) \ud83d\udd27 Implement minimal code \u2705 Run tests (should pass) \ud83d\udd04 Refactor if needed \ud83d\udcdd Commit changes Step 4: Quality Checks \u00b6 After each phase: task lint task type-check task test Phase Overview \u00b6 Phase Task Time Status 1 Battery Deprecation 2-3h \u2b1c Not Started 2 Error Messages 2-3h \u2b1c Not Started 3 Model Validator 3-4h \u2b1c Not Started 4 CLI Tool 2-3h \u2b1c Not Started 5 Integration & Docs 2-3h \u2b1c Not Started 6 Review & Cleanup 1-2h \u2b1c Not Started Total: 12-18 hours Testing Commands \u00b6 # Run specific test file task test tests/test_errors.py # Run specific test task test tests/test_errors.py::test_laser_sensor_typo_fixed # Run all tests task test # Run with coverage task test --cov Commit Message Template \u00b6 <type>: <short description> <detailed description> - Bullet point 1 - Bullet point 2 Refs: #171 Types: feat , fix , refactor , test , docs , chore Key Files \u00b6 To Create \u00b6 custom_components/robovac/model_validator.py custom_components/robovac/model_validator_cli.py tests/test_battery_feature_removal.py tests/test_errors.py tests/test_model_validator.py tests/test_model_validator_cli.py tests/test_integration_pr171.py To Modify \u00b6 All 35 vacuum models ( custom_components/robovac/vacuums/T2*.py ) custom_components/robovac/vacuum.py custom_components/robovac/errors.py README.md DEVELOPMENT.md CHANGELOG.md Rules to Remember \u00b6 Code Quality \u00b6 \u2705 Type hints on all functions \u2705 Google-style docstrings \u2705 No flake8 violations \u2705 Pass type checking \u2705 Pass all tests Testing \u00b6 \u2705 Write tests BEFORE implementation \u2705 Test edge cases \u2705 Test error handling \u2705 Use existing test patterns \u2705 Run task test not pytest Commits \u00b6 \u2705 Small, focused commits \u2705 Conventional commit messages \u2705 One feature per commit \u2705 Reference issue (#171) Progress Tracking \u00b6 Mark each step as complete: Phase 1: Battery Deprecation \u00b6 [ ] Step 1.1: Write failing tests [ ] Step 1.2: Remove battery feature (35 files) [ ] Step 1.3: Remove _attr_battery_level [ ] Step 1.4: Commit Phase 2: Error Messages \u00b6 [ ] Step 2.1: Write failing tests [ ] Step 2.2: Fix typo [ ] Step 2.3: Implement getErrorMessageWithContext() [ ] Step 2.4: Add type hints [ ] Step 2.5: Commit Phase 3: Model Validator \u00b6 [ ] Step 3.1: Write failing tests [ ] Step 3.2: Create module [ ] Step 3.3: Quality checks [ ] Step 3.4: Commit Phase 4: CLI Tool \u00b6 [ ] Step 4.1: Write tests [ ] Step 4.2: Create CLI [ ] Step 4.3: Documentation [ ] Step 4.4: Commit Phase 5: Integration \u00b6 [ ] Step 5.1: Integration tests [ ] Step 5.2: Update docs [ ] Step 5.3: Full test suite [ ] Step 5.4: Commit Phase 6: Review \u00b6 [ ] Step 6.1: Code review checklist [ ] Step 6.2: Summary document [ ] Step 6.3: Final validation Getting Help \u00b6 \ud83d\udcd6 Full plan: IMPLEMENTATION_PLAN_PR171.md \ud83d\udccb Review summary: PR171_REVIEW_SUMMARY.md \ud83d\udd17 Original PR: https://github.com/damacus/robovac/pull/171 \ud83d\udcda Coding standards: .windsurf/rules/ \ud83e\uddea Test patterns: tests/test_vacuum/test_t2278_command_mappings.py Quick Validation \u00b6 Before committing any phase: # Check linting task lint # Check types task type-check # Run tests task test # Check markdown npx markdownlint-cli2 \"**/*.md\" All should pass! \u2705 Success Checklist \u00b6 At the end, verify: [ ] All 35 vacuum models updated [ ] Error typo fixed [ ] getErrorMessageWithContext() works [ ] model_validator.py works [ ] model_validator_cli.py works [ ] All tests pass (task test) [ ] No lint errors (task lint) [ ] No type errors (task type-check) [ ] Docs updated [ ] No markdown lint errors Ready to Start? \u00b6 # Ensure you're on the right branch git status # Start Phase 1, Step 1.1 # Open: tests/test_vacuum/test_battery_feature_removal.py Good luck! Follow the detailed plan and you'll have all features implemented with full test coverage. \ud83d\ude80","title":"Quick Start Guide: Implementing PR #171 Features"},{"location":"archive/pr171/QUICK_START_PR171/#quick-start-guide-implementing-pr-171-features","text":"","title":"Quick Start Guide: Implementing PR #171 Features"},{"location":"archive/pr171/QUICK_START_PR171/#overview","text":"This guide provides a quick reference for implementing the features from PR #171 on your current branch. Full details: See IMPLEMENTATION_PLAN_PR171.md","title":"Overview"},{"location":"archive/pr171/QUICK_START_PR171/#what-youre-building","text":"Battery Deprecation - Remove deprecated battery feature from 35+ vacuum models Error Context - Enhanced error messages with troubleshooting guidance Model Validator - Library for validating and suggesting model compatibility CLI Tool - Standalone tool for users to check model support","title":"What You're Building"},{"location":"archive/pr171/QUICK_START_PR171/#quick-start","text":"","title":"Quick Start"},{"location":"archive/pr171/QUICK_START_PR171/#step-1-read-the-plans","text":"# Review summary cat PR171_REVIEW_SUMMARY.md # Read full implementation plan cat IMPLEMENTATION_PLAN_PR171.md","title":"Step 1: Read the Plans"},{"location":"archive/pr171/QUICK_START_PR171/#step-2-start-phase-1","text":"# Create test file touch tests/test_vacuum/test_battery_feature_removal.py # Write failing tests first (see plan for test cases) # Then implement changes","title":"Step 2: Start Phase 1"},{"location":"archive/pr171/QUICK_START_PR171/#step-3-follow-tdd-cycle","text":"For each phase: \u270d\ufe0f Write failing tests \u2705 Run tests (should fail) \ud83d\udd27 Implement minimal code \u2705 Run tests (should pass) \ud83d\udd04 Refactor if needed \ud83d\udcdd Commit changes","title":"Step 3: Follow TDD Cycle"},{"location":"archive/pr171/QUICK_START_PR171/#step-4-quality-checks","text":"After each phase: task lint task type-check task test","title":"Step 4: Quality Checks"},{"location":"archive/pr171/QUICK_START_PR171/#phase-overview","text":"Phase Task Time Status 1 Battery Deprecation 2-3h \u2b1c Not Started 2 Error Messages 2-3h \u2b1c Not Started 3 Model Validator 3-4h \u2b1c Not Started 4 CLI Tool 2-3h \u2b1c Not Started 5 Integration & Docs 2-3h \u2b1c Not Started 6 Review & Cleanup 1-2h \u2b1c Not Started Total: 12-18 hours","title":"Phase Overview"},{"location":"archive/pr171/QUICK_START_PR171/#testing-commands","text":"# Run specific test file task test tests/test_errors.py # Run specific test task test tests/test_errors.py::test_laser_sensor_typo_fixed # Run all tests task test # Run with coverage task test --cov","title":"Testing Commands"},{"location":"archive/pr171/QUICK_START_PR171/#commit-message-template","text":"<type>: <short description> <detailed description> - Bullet point 1 - Bullet point 2 Refs: #171 Types: feat , fix , refactor , test , docs , chore","title":"Commit Message Template"},{"location":"archive/pr171/QUICK_START_PR171/#key-files","text":"","title":"Key Files"},{"location":"archive/pr171/QUICK_START_PR171/#to-create","text":"custom_components/robovac/model_validator.py custom_components/robovac/model_validator_cli.py tests/test_battery_feature_removal.py tests/test_errors.py tests/test_model_validator.py tests/test_model_validator_cli.py tests/test_integration_pr171.py","title":"To Create"},{"location":"archive/pr171/QUICK_START_PR171/#to-modify","text":"All 35 vacuum models ( custom_components/robovac/vacuums/T2*.py ) custom_components/robovac/vacuum.py custom_components/robovac/errors.py README.md DEVELOPMENT.md CHANGELOG.md","title":"To Modify"},{"location":"archive/pr171/QUICK_START_PR171/#rules-to-remember","text":"","title":"Rules to Remember"},{"location":"archive/pr171/QUICK_START_PR171/#code-quality","text":"\u2705 Type hints on all functions \u2705 Google-style docstrings \u2705 No flake8 violations \u2705 Pass type checking \u2705 Pass all tests","title":"Code Quality"},{"location":"archive/pr171/QUICK_START_PR171/#testing","text":"\u2705 Write tests BEFORE implementation \u2705 Test edge cases \u2705 Test error handling \u2705 Use existing test patterns \u2705 Run task test not pytest","title":"Testing"},{"location":"archive/pr171/QUICK_START_PR171/#commits","text":"\u2705 Small, focused commits \u2705 Conventional commit messages \u2705 One feature per commit \u2705 Reference issue (#171)","title":"Commits"},{"location":"archive/pr171/QUICK_START_PR171/#progress-tracking","text":"Mark each step as complete:","title":"Progress Tracking"},{"location":"archive/pr171/QUICK_START_PR171/#phase-1-battery-deprecation","text":"[ ] Step 1.1: Write failing tests [ ] Step 1.2: Remove battery feature (35 files) [ ] Step 1.3: Remove _attr_battery_level [ ] Step 1.4: Commit","title":"Phase 1: Battery Deprecation"},{"location":"archive/pr171/QUICK_START_PR171/#phase-2-error-messages","text":"[ ] Step 2.1: Write failing tests [ ] Step 2.2: Fix typo [ ] Step 2.3: Implement getErrorMessageWithContext() [ ] Step 2.4: Add type hints [ ] Step 2.5: Commit","title":"Phase 2: Error Messages"},{"location":"archive/pr171/QUICK_START_PR171/#phase-3-model-validator","text":"[ ] Step 3.1: Write failing tests [ ] Step 3.2: Create module [ ] Step 3.3: Quality checks [ ] Step 3.4: Commit","title":"Phase 3: Model Validator"},{"location":"archive/pr171/QUICK_START_PR171/#phase-4-cli-tool","text":"[ ] Step 4.1: Write tests [ ] Step 4.2: Create CLI [ ] Step 4.3: Documentation [ ] Step 4.4: Commit","title":"Phase 4: CLI Tool"},{"location":"archive/pr171/QUICK_START_PR171/#phase-5-integration","text":"[ ] Step 5.1: Integration tests [ ] Step 5.2: Update docs [ ] Step 5.3: Full test suite [ ] Step 5.4: Commit","title":"Phase 5: Integration"},{"location":"archive/pr171/QUICK_START_PR171/#phase-6-review","text":"[ ] Step 6.1: Code review checklist [ ] Step 6.2: Summary document [ ] Step 6.3: Final validation","title":"Phase 6: Review"},{"location":"archive/pr171/QUICK_START_PR171/#getting-help","text":"\ud83d\udcd6 Full plan: IMPLEMENTATION_PLAN_PR171.md \ud83d\udccb Review summary: PR171_REVIEW_SUMMARY.md \ud83d\udd17 Original PR: https://github.com/damacus/robovac/pull/171 \ud83d\udcda Coding standards: .windsurf/rules/ \ud83e\uddea Test patterns: tests/test_vacuum/test_t2278_command_mappings.py","title":"Getting Help"},{"location":"archive/pr171/QUICK_START_PR171/#quick-validation","text":"Before committing any phase: # Check linting task lint # Check types task type-check # Run tests task test # Check markdown npx markdownlint-cli2 \"**/*.md\" All should pass! \u2705","title":"Quick Validation"},{"location":"archive/pr171/QUICK_START_PR171/#success-checklist","text":"At the end, verify: [ ] All 35 vacuum models updated [ ] Error typo fixed [ ] getErrorMessageWithContext() works [ ] model_validator.py works [ ] model_validator_cli.py works [ ] All tests pass (task test) [ ] No lint errors (task lint) [ ] No type errors (task type-check) [ ] Docs updated [ ] No markdown lint errors","title":"Success Checklist"},{"location":"archive/pr171/QUICK_START_PR171/#ready-to-start","text":"# Ensure you're on the right branch git status # Start Phase 1, Step 1.1 # Open: tests/test_vacuum/test_battery_feature_removal.py Good luck! Follow the detailed plan and you'll have all features implemented with full test coverage. \ud83d\ude80","title":"Ready to Start?"},{"location":"development/","text":"Development Workflow \u00b6 This section will describe how to contribute to the RoboVac integration. Content migration from existing documents is in progress.","title":"Development Workflow"},{"location":"development/#development-workflow","text":"This section will describe how to contribute to the RoboVac integration. Content migration from existing documents is in progress.","title":"Development Workflow"}]}