{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"RoboVac Documentation","text":"<p>Welcome to the unified documentation hub for the RoboVac integration with Home Assistant.</p>"},{"location":"#getting-started","title":"Getting Started","text":"<ul> <li>DPS Codes Guide: Learn how to find and use Data Point Specification codes for your device.</li> <li>Troubleshooting: Solutions for common issues and connection problems.</li> <li>Development: Guide for contributors and developers.</li> </ul>"},{"location":"#reference","title":"Reference","text":"<ul> <li>Protocol 3.5 Support: Details about Tuya protocol 3.5 support.</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<ol> <li>Set up the development environment with <code>task install-dev</code>.</li> <li>Run the test suite using <code>task test</code>.</li> <li>Ensure all linting and type checks pass before submitting changes.</li> </ol>"},{"location":"ISSUE_42_T2276_INVESTIGATION/","title":"T2276 (X8 Pro SES) Investigation","text":""},{"location":"ISSUE_42_T2276_INVESTIGATION/#issue-summary","title":"Issue Summary","text":"<p>T2276 (X8 Pro SES) vacuum is experiencing connection issues with the following symptoms:</p> <ul> <li>Device connects to Home Assistant</li> <li>Repeated \"Incomplete read\" errors in logs</li> <li>Empty data points (<code>{}</code>) returned from vacuum</li> <li>No status updates received</li> </ul>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#current-status","title":"Current Status","text":"<p>Model Support: Partial Tests: \u2705 Passing Protocol: \u26a0\ufe0f Issues</p>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#technical-analysis","title":"Technical Analysis","text":""},{"location":"ISSUE_42_T2276_INVESTIGATION/#symptoms","title":"Symptoms","text":"<p>From user logs:</p> <pre><code>2025-10-22 13:10:04.065 DEBUG [custom_components.robovac.tuyalocalapi] Incomplete read\n2025-10-22 13:10:22.225 DEBUG [custom_components.robovac.tuyalocalapi] Disconnected\n2025-10-22 13:10:22.241 DEBUG [custom_components.robovac.tuyalocalapi] Connecting\n</code></pre> <p>The vacuum connects but doesn't respond to status requests, resulting in:</p> <pre><code>2025-05-09 08:23:04.568 DEBUG [custom_components.robovac.vacuum] Updating entity values from data points: {}\n</code></pre>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#current-configuration","title":"Current Configuration","text":"<p>T2276 is currently configured with the following DPS codes:</p> <ul> <li>MODE: 152</li> <li>STATUS: 173</li> <li>RETURN_HOME: 153</li> <li>FAN_SPEED: 154</li> <li>LOCATE: 153</li> <li>BATTERY: 172</li> <li>ERROR: 169</li> </ul> <p>These codes are identical to T2275 and T2278 models.</p>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#possible-causes","title":"Possible Causes","text":"<ol> <li>Incorrect DPS Codes: T2276 may use different data point codes than T2275/T2278</li> <li>Protocol Version: Device may use a different Tuya protocol version</li> <li>Encryption: Device may require different encryption handling</li> <li>Timing Issues: Device may need different timeout or retry settings</li> </ol>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#next-steps","title":"Next Steps","text":""},{"location":"ISSUE_42_T2276_INVESTIGATION/#for-users","title":"For Users","text":"<p>Good news: You don't need to manually extract credentials! This integration already does that automatically when you enter your Eufy app email/password in the Home Assistant config flow.</p> <p>If you have a T2276 vacuum, please help us debug the communication issue:</p> <ol> <li>Enable Debug Logging:    In Home Assistant, add to <code>configuration.yaml</code>:</li> </ol> <pre><code>logger:\n  default: info\n  logs:\n    custom_components.robovac: debug\n    custom_components.robovac.tuyalocalapi: debug\n</code></pre> <p>Restart Home Assistant, then let it try to connect to your T2276 for a few minutes.</p> <ol> <li>Provide Debug Logs:</li> <li>Go to Settings \u2192 System \u2192 Logs</li> <li>Download the full log</li> <li> <p>Share the relevant sections showing:</p> <ul> <li>Connection attempts</li> <li>\"Incomplete read\" errors</li> <li>Any data point (DPS) values that do appear</li> <li>The complete error sequence</li> </ul> </li> <li> <p>Device Information:</p> </li> <li>Exact model name from Eufy app (confirm it's T2276/X8 Pro SES)</li> <li>Firmware version (found in Eufy app settings)</li> <li> <p>Does the vacuum work in the Eufy app?</p> </li> <li> <p>Test Alternative Integration:</p> </li> <li>Try kevinbird15's fork: https://github.com/kevinbird15/robovac-ha-integration</li> <li>Report if it works differently</li> <li> <p>If it works, note any differences in behavior</p> </li> <li> <p>Optional - Advanced Users:    If you're comfortable with Python, you can try these tools to capture raw device data:</p> </li> <li>https://github.com/markbajaj/eufy-device-id-python - Gets device info from Eufy servers</li> <li><code>tinytuya scan</code> - Scans local network for Tuya devices (after you have credentials)</li> </ol> <p>But this is NOT required - debug logs are more helpful!</p>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#for-developers","title":"For Developers","text":"<ol> <li>Compare with Working Implementation:</li> <li>Review kevinbird15's implementation that reportedly works</li> <li> <p>Identify protocol or configuration differences</p> </li> <li> <p>Protocol Analysis:</p> </li> <li>Add more detailed logging around message parsing</li> <li> <p>Capture raw Tuya messages for analysis</p> </li> <li> <p>Test Different Configurations:</p> </li> <li>Try different DPS code combinations</li> <li>Test with different protocol versions</li> <li>Experiment with timeout values</li> </ol>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#related-issues","title":"Related Issues","text":"<ul> <li>GitHub Issue #42: https://github.com/damacus/robovac/issues/42</li> <li>kevinbird15's working fork: https://github.com/kevinbird15/robovac-ha-integration</li> </ul>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#references","title":"References","text":"<ul> <li>User report from @Casper9228 (2025-04-29)</li> <li>User report from @peggleg (2025-10-22)</li> <li>User report from @kevinbird15 with alternative implementation (2025-09-18)</li> </ul>"},{"location":"ISSUE_42_T2276_INVESTIGATION/#updates","title":"Updates","text":"<ul> <li>2025-10-22: Initial investigation documented</li> <li>Tests created and passing for T2276 command mappings</li> <li>Model file exists with standard configuration</li> <li>Issue appears to be at protocol/communication level, not configuration</li> <li>Root cause identified: T2276 requires Tuya protocol version 3.5 (current implementation uses 3.1)</li> <li>Solution decided: Migrate from custom Tuya implementation to LocalTuya's PyTuya</li> <li>Supports protocols 3.1, 3.2, 3.3, 3.4, 3.5</li> <li>Battle-tested by thousands of users</li> <li>Actively maintained</li> <li>Drop-in replacement for custom code</li> <li>See: https://github.com/rospogrigio/localtuya</li> </ul>"},{"location":"PROTOCOL_35_SUPPORT/","title":"Protocol 3.5 Support","text":""},{"location":"PROTOCOL_35_SUPPORT/#overview","title":"Overview","text":"<p>The RoboVac integration now supports Tuya protocol versions 3.4 and 3.5, which use HMAC-SHA256 for message authentication instead of CRC32. This is required for newer devices like the X8 Pro SES (T2276).</p>"},{"location":"PROTOCOL_35_SUPPORT/#protocol-versions","title":"Protocol Versions","text":"Version Authentication Encoding Notes 3.1 CRC32 (payload only) Base64 Legacy protocol 3.2 CRC32 (payload only) Base64 Same as 3.1 with type_0d 3.3 CRC32 (header + payload) Raw Most common 3.4 HMAC-SHA256 Raw Newer devices 3.5 HMAC-SHA256 Raw Latest protocol"},{"location":"PROTOCOL_35_SUPPORT/#implementation-details","title":"Implementation Details","text":""},{"location":"PROTOCOL_35_SUPPORT/#hmac-sha256-protocol-34","title":"HMAC-SHA256 (Protocol 3.4+)","text":"<p>For protocol versions 3.4 and above, messages use HMAC-SHA256 for authentication:</p> <ol> <li>Message Structure:</li> </ol> <pre><code>[Header: 16 bytes] + [Payload: variable] + [HMAC: 32 bytes] + [Suffix: 4 bytes]\n</code></pre> <ol> <li>HMAC Calculation:</li> <li>Key: Device local key (16 characters)</li> <li>Data: Header + Payload</li> <li>Algorithm: HMAC-SHA256</li> <li> <p>Output: 32 bytes</p> </li> <li> <p>Verification:</p> </li> <li>Received messages are validated by computing HMAC and comparing</li> <li>Invalid HMAC results in message rejection</li> </ol>"},{"location":"PROTOCOL_35_SUPPORT/#crc32-protocol-34","title":"CRC32 (Protocol &lt; 3.4)","text":"<p>Earlier protocols use CRC32 for checksums:</p> <ol> <li>Protocol 3.3:</li> <li>CRC32 calculated on: Header + Payload</li> <li> <p>4-byte checksum</p> </li> <li> <p>Protocol &lt; 3.3:</p> </li> <li>CRC32 calculated on: Payload only</li> <li>4-byte checksum</li> <li>Payload is base64 encoded</li> </ol>"},{"location":"PROTOCOL_35_SUPPORT/#using-protocol-35","title":"Using Protocol 3.5","text":""},{"location":"PROTOCOL_35_SUPPORT/#in-code","title":"In Code","text":"<p>The <code>TuyaDevice</code> class accepts a <code>version</code> parameter:</p> <pre><code>from custom_components.robovac.tuyalocalapi import TuyaDevice\n\n# Protocol 3.5\ndevice = TuyaDevice(\n    model_details=model,\n    device_id=\"your_device_id\",\n    host=\"192.168.1.100\",\n    local_key=\"your_local_key\",\n    timeout=10.0,\n    ping_interval=30.0,\n    update_entity_state=callback,\n    version=(3, 5)  # Specify protocol version\n)\n</code></pre>"},{"location":"PROTOCOL_35_SUPPORT/#for-model-definitions","title":"For Model Definitions","text":"<p>Models can specify their required protocol version in the model file:</p> <pre><code># In custom_components/robovac/vacuums/T2276.py\nclass T2276(RobovacModelDetails):\n    # Model uses protocol 3.5\n    protocol_version = (3, 5)\n</code></pre> <p>Then in <code>RoboVac.__init__()</code>:</p> <pre><code># Get protocol version from model details\nprotocol_version = getattr(\n    self.model_details,\n    'protocol_version',\n    (3, 3)  # Default to 3.3\n)\n\n# Pass to TuyaDevice\nTuyaDevice.__init__(\n    self,\n    model_details=self.model_details,\n    device_id=device_id,\n    host=host,\n    local_key=local_key,\n    timeout=timeout,\n    ping_interval=ping_interval,\n    update_entity_state=update_entity_state,\n    version=protocol_version,\n    port=port,\n)\n</code></pre>"},{"location":"PROTOCOL_35_SUPPORT/#troubleshooting","title":"Troubleshooting","text":""},{"location":"PROTOCOL_35_SUPPORT/#hmac-verification-failed","title":"\"HMAC verification failed\"","text":"<p>This error indicates:</p> <ul> <li>Wrong local key</li> <li>Protocol version mismatch</li> <li>Corrupted message</li> </ul> <p>Solution: Verify the local key and protocol version for your device.</p>"},{"location":"PROTOCOL_35_SUPPORT/#incomplete-read-errors","title":"\"Incomplete read\" errors","text":"<p>For devices that previously had incomplete read errors (like T2276), upgrading to protocol 3.5 should resolve the issue.</p> <p>Steps:</p> <ol> <li>Add <code>protocol_version = (3, 5)</code> to the model file</li> <li>Update <code>RoboVac.__init__()</code> to use the protocol version</li> <li>Test with your device</li> </ol>"},{"location":"PROTOCOL_35_SUPPORT/#determining-protocol-version","title":"Determining Protocol Version","text":"<p>To find the correct protocol version for your device:</p> <ol> <li>Check device documentation - Newer devices typically use 3.4+</li> <li>Try incrementally:</li> <li>Start with 3.3 (most common)</li> <li>If incomplete reads occur, try 3.4</li> <li>If still issues, try 3.5</li> <li>Check logs - Look for authentication or checksum errors</li> </ol>"},{"location":"PROTOCOL_35_SUPPORT/#testing","title":"Testing","text":"<p>All protocol versions are tested with the existing test suite:</p> <pre><code>task test\n</code></pre> <p>The implementation maintains backward compatibility, so existing devices using protocols 3.1-3.3 continue to work without changes.</p>"},{"location":"PROTOCOL_35_SUPPORT/#references","title":"References","text":"<ul> <li>TinyTuya Protocol Documentation</li> <li>Tuya IoT Protocol</li> <li>Issue #42: X8 Pro SES incomplete read errors</li> </ul>"},{"location":"PYTUYA_MIGRATION_PLAN/","title":"PyTuya Migration Plan","text":""},{"location":"PYTUYA_MIGRATION_PLAN/#goal","title":"Goal","text":"<p>Replace custom <code>tuyalocalapi.py</code> implementation with LocalTuya's battle-tested <code>pytuya</code> module to support Tuya protocol versions 3.1-3.5.</p>"},{"location":"PYTUYA_MIGRATION_PLAN/#why-migrate","title":"Why Migrate?","text":"<ul> <li>T2276 (X8 Pro SES) requires protocol 3.5 - current implementation only supports 3.1</li> <li>Future-proof - supports all protocol versions as Tuya evolves</li> <li>Community maintained - actively developed by LocalTuya team</li> <li>Production proven - used by thousands of users</li> <li>Better maintenance - we don't have to maintain protocol implementation</li> </ul>"},{"location":"PYTUYA_MIGRATION_PLAN/#source","title":"Source","text":"<p>LocalTuya PyTuya: https://github.com/rospogrigio/localtuya/tree/master/custom_components/localtuya/pytuya</p>"},{"location":"PYTUYA_MIGRATION_PLAN/#migration-steps","title":"Migration Steps","text":""},{"location":"PYTUYA_MIGRATION_PLAN/#phase-1-integration-low-risk","title":"Phase 1: Integration (Low Risk)","text":"<ol> <li>Download PyTuya module</li> <li>Copy <code>pytuya/__init__.py</code> from LocalTuya</li> <li>Place in <code>custom_components/robovac/pytuya/</code></li> <li> <p>Maintain as separate module initially</p> </li> <li> <p>Update dependencies</p> </li> <li>Already have <code>cryptography</code> - no new dependencies needed</li> <li> <p>Verify version compatibility</p> </li> <li> <p>Create wrapper/adapter layer</p> </li> <li>Map our API to PyTuya API</li> <li>Minimize changes to existing code initially</li> </ol>"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-2-gradual-migration-medium-risk","title":"Phase 2: Gradual Migration (Medium Risk)","text":"<ol> <li>Update <code>robovac.py</code></li> <li>Replace <code>TuyaDevice</code> imports with PyTuya</li> <li>Update initialization to use PyTuya API</li> <li> <p>Set protocol version per model</p> </li> <li> <p>Update model configurations</p> </li> <li>Add <code>protocol_version</code> attribute to models</li> <li>Default to 3.1 for existing models</li> <li> <p>Set 3.5 for T2276</p> </li> <li> <p>Update <code>vacuum.py</code></p> </li> <li>Adjust for any API differences</li> <li>Update status polling logic</li> <li>Update command sending logic</li> </ol>"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-3-testing-critical","title":"Phase 3: Testing (Critical)","text":"<ol> <li>Test T2276 specifically</li> <li>Verify protocol 3.5 communication works</li> <li>Confirm \"Incomplete read\" errors are resolved</li> <li> <p>Test all commands (start, stop, return home, etc.)</p> </li> <li> <p>Regression test existing models</p> </li> <li>Test at least 3 different model types</li> <li>Verify protocol 3.1 still works</li> <li> <p>Ensure no breaking changes</p> </li> <li> <p>Run full test suite</p> </li> <li>All 196 tests must pass</li> <li>Add new tests for protocol version selection</li> <li>Test error handling</li> </ol>"},{"location":"PYTUYA_MIGRATION_PLAN/#phase-4-cleanup-low-risk","title":"Phase 4: Cleanup (Low Risk)","text":"<ol> <li>Remove old implementation</li> <li>Delete <code>tuyalocalapi.py</code> if fully replaced</li> <li>Or keep as fallback initially</li> <li> <p>Clean up unused code</p> </li> <li> <p>Update documentation</p> </li> <li>Update README with PyTuya attribution</li> <li>Update DEVELOPMENT.md</li> <li> <p>Document protocol version configuration</p> </li> <li> <p>Final verification</p> </li> <li>Lint and type-check pass</li> <li>All tests pass</li> <li>Documentation complete</li> </ol>"},{"location":"PYTUYA_MIGRATION_PLAN/#api-mapping","title":"API Mapping","text":""},{"location":"PYTUYA_MIGRATION_PLAN/#current-api-tuyadevice","title":"Current API (TuyaDevice)","text":"<pre><code>device = TuyaDevice(dev_id, address, local_key, version=3.1)\nawait device.status()\nawait device.set_dp(value, dp_index)\n</code></pre>"},{"location":"PYTUYA_MIGRATION_PLAN/#pytuya-api","title":"PyTuya API","text":"<pre><code>device = TuyaInterface(dev_id, address, local_key)\ndevice.set_version(3.5)  # New capability!\nstatus = await device.status()\nawait device.set_dp(value, dp_index)\n</code></pre>"},{"location":"PYTUYA_MIGRATION_PLAN/#key-differences","title":"Key Differences","text":"<ol> <li>Protocol version setting:</li> <li>Old: Fixed at initialization</li> <li> <p>New: Can be set with <code>set_version()</code></p> </li> <li> <p>Error handling:</p> </li> <li>PyTuya has more detailed error codes</li> <li> <p>Need to map to our error handling</p> </li> <li> <p>Async handling:</p> </li> <li>PyTuya is fully async</li> <li>Should integrate smoothly with our async code</li> </ol>"},{"location":"PYTUYA_MIGRATION_PLAN/#rollback-plan","title":"Rollback Plan","text":"<p>If migration fails:</p> <ol> <li>Revert to previous commit</li> <li>Keep T2276 marked as unsupported</li> <li>Document issues encountered</li> <li>Consider hybrid approach (PyTuya only for T2276)</li> </ol>"},{"location":"PYTUYA_MIGRATION_PLAN/#success-criteria","title":"Success Criteria","text":"<ul> <li>\u2705 T2276 works without \"Incomplete read\" errors</li> <li>\u2705 All existing models continue working</li> <li>\u2705 All 196 tests pass</li> <li>\u2705 No regressions in functionality</li> <li>\u2705 Code quality maintained (lint, type-check)</li> </ul>"},{"location":"PYTUYA_MIGRATION_PLAN/#timeline","title":"Timeline","text":"<ul> <li>Phase 1: 2-3 hours (integration)</li> <li>Phase 2: 3-4 hours (migration)</li> <li>Phase 3: 2-3 hours (testing)</li> <li>Phase 4: 1-2 hours (cleanup)</li> </ul> <p>Total: 8-12 hours of work</p>"},{"location":"PYTUYA_MIGRATION_PLAN/#risk-assessment","title":"Risk Assessment","text":"Risk Probability Impact Mitigation Breaking existing models Medium High Thorough testing, gradual rollout API incompatibility Low Medium Adapter layer, careful mapping Performance issues Low Low PyTuya is proven in production New bugs Medium Medium Comprehensive test coverage"},{"location":"PYTUYA_MIGRATION_PLAN/#notes","title":"Notes","text":"<ul> <li>Keep existing implementation initially as fallback</li> <li>Test with real devices if possible (ask users)</li> <li>Monitor GitHub issues for similar migrations</li> <li>Consider releasing as beta first</li> </ul>"},{"location":"PYTUYA_MIGRATION_PLAN/#references","title":"References","text":"<ul> <li>LocalTuya: https://github.com/rospogrigio/localtuya</li> <li>PyTuya module: https://github.com/rospogrigio/localtuya/tree/master/custom_components/localtuya/pytuya</li> <li>Kevin's fork (working T2276): https://github.com/kevinbird15/robovac-ha-integration/blob/purgatory</li> <li>Issue #42: https://github.com/damacus/robovac/issues/42</li> </ul>"},{"location":"development/","title":"Development Guide","text":"<p>This document provides guidance for developers working on the RoboVac integration.</p>"},{"location":"development/#project-structure","title":"Project Structure","text":"<pre><code>custom_components/robovac/\n\u251c\u2500\u2500 __init__.py                 # Integration initialization\n\u251c\u2500\u2500 config_flow.py              # Configuration flow for setup\n\u251c\u2500\u2500 robovac.py                  # Core RoboVac class with command logic\n\u251c\u2500\u2500 vacuum.py                   # Home Assistant vacuum entity\n\u251c\u2500\u2500 sensor.py                   # Sensor entities\n\u251c\u2500\u2500 tuyalocalapi.py             # Tuya device communication\n\u251c\u2500\u2500 tuyalocaldiscovery.py       # Device discovery\n\u251c\u2500\u2500 vacuums/\n\u2502   \u251c\u2500\u2500 base.py                 # Base classes and enums\n\u2502   \u251c\u2500\u2500 T2250.py through T2262.py  # Model-specific command mappings\n\u2502   \u2514\u2500\u2500 ... (other models)\n\u2514\u2500\u2500 strings.json                # Localization strings\n\ntests/\n\u251c\u2500\u2500 test_vacuum/\n\u2502   \u251c\u2500\u2500 test_t2251_command_mappings.py  # Model-specific tests\n\u2502   \u251c\u2500\u2500 test_get_robovac_human_readable_value.py\n\u2502   \u251c\u2500\u2500 test_get_robovac_command_value.py\n\u2502   \u2514\u2500\u2500 ... (other tests)\n\u2514\u2500\u2500 conftest.py                 # Pytest configuration and fixtures\n</code></pre>"},{"location":"development/#key-concepts","title":"Key Concepts","text":""},{"location":"development/#command-mappings","title":"Command Mappings","text":"<p>Each vacuum model defines command mappings in <code>vacuums/T*.py</code> files. These mappings translate between:</p> <ul> <li>Device codes: Numeric DPS codes used by the Tuya protocol</li> <li>Command names: Enum values like <code>RobovacCommand.MODE</code>, <code>RobovacCommand.FAN_SPEED</code></li> <li>Command values: User-friendly strings like <code>\"auto\"</code>, <code>\"turbo\"</code>, <code>\"Standard\"</code></li> </ul> <p>Example structure:</p> <pre><code>RobovacCommand.MODE: {\n    \"code\": 5,  # DPS code for this command\n    \"values\": {\n        \"auto\": \"Auto\",           # Key: input value, Value: output value\n        \"small_room\": \"SmallRoom\",\n        \"spot\": \"Spot\",\n    },\n},\n</code></pre>"},{"location":"development/#naming-conventions","title":"Naming Conventions","text":"<ul> <li>Keys (input values): Lowercase snake_case (e.g., <code>\"auto\"</code>, <code>\"small_room\"</code>)</li> <li>Values (output values): PascalCase (e.g., <code>\"Auto\"</code>, <code>\"SmallRoom\"</code>)</li> <li>Case-insensitive matching: Device responses are matched case-insensitively</li> </ul>"},{"location":"development/#case-insensitive-matching","title":"Case-Insensitive Matching","text":"<p>Device responses are matched case-insensitively, so <code>\"AUTO\"</code>, <code>\"auto\"</code>, and <code>\"Auto\"</code> all map to the same value. This eliminates the need for duplicate bidirectional mappings and simplifies the command mapping definitions.</p>"},{"location":"development/#development-workflow","title":"Development Workflow","text":""},{"location":"development/#setting-up-development-environment","title":"Setting Up Development Environment","text":"<ol> <li>Clone the repository</li> <li>Install dependencies: <code>pip install -r requirements.txt</code></li> <li>Install development dependencies: <code>pip install -r requirements-dev.txt</code></li> <li>Run tests to verify setup: <code>task test</code></li> </ol>"},{"location":"development/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\ntask test\n\n# Run specific test file\npytest tests/test_vacuum/test_t2251_command_mappings.py -v\n\n# Run with coverage\ntask test  # Already includes coverage report\n\n# Run tests matching a pattern\npytest tests/test_vacuum/ -k \"mode\" -v\n</code></pre>"},{"location":"development/#code-quality-checks","title":"Code Quality Checks","text":"<pre><code># Check code style and formatting\ntask lint\n\n# Verify type hints\ntask type-check\n\n# Both lint and type-check\ntask lint &amp;&amp; task type-check\n</code></pre>"},{"location":"development/#markdown-documentation","title":"Markdown Documentation","text":"<pre><code># Check markdown formatting\ntask markdownlint\n\n# Fix markdown issues\ntask markdownlint --fix\n</code></pre>"},{"location":"development/#adding-a-new-vacuum-model","title":"Adding a New Vacuum Model","text":""},{"location":"development/#1-create-model-file","title":"1. Create Model File","text":"<p>Create <code>custom_components/robovac/vacuums/TXXX.py</code>:</p> <pre><code>\"\"\"Model name (TXXX)\"\"\"\nfrom homeassistant.components.vacuum import VacuumEntityFeature\nfrom .base import RoboVacEntityFeature, RobovacCommand, RobovacModelDetails\n\n\nclass TXXX(RobovacModelDetails):\n    homeassistant_features = (\n        VacuumEntityFeature.BATTERY\n        | VacuumEntityFeature.START\n        | VacuumEntityFeature.STOP\n        | VacuumEntityFeature.PAUSE\n        | VacuumEntityFeature.RETURN_HOME\n        | VacuumEntityFeature.FAN_SPEED\n        | VacuumEntityFeature.LOCATE\n    )\n    robovac_features = (\n        RoboVacEntityFeature.CLEANING_TIME\n        | RoboVacEntityFeature.CLEANING_AREA\n    )\n    commands = {\n        RobovacCommand.START_PAUSE: {\n            \"code\": 2,\n        },\n        RobovacCommand.MODE: {\n            \"code\": 5,\n            \"values\": {\n                \"auto\": \"Auto\",\n                \"small_room\": \"SmallRoom\",\n            },\n        },\n        # ... other commands\n    }\n</code></pre>"},{"location":"development/#2-register-model","title":"2. Register Model","text":"<p>Add to <code>custom_components/robovac/vacuums/__init__.py</code>:</p> <pre><code>from .TXXX import TXXX\n\nROBOVAC_MODELS = {\n    # ... existing models\n    \"TXXX\": TXXX,\n}\n</code></pre>"},{"location":"development/#3-create-tests","title":"3. Create Tests","text":"<p>Create <code>tests/test_vacuum/test_txxx_command_mappings.py</code>:</p> <pre><code>\"\"\"Tests for TXXX command mappings.\"\"\"\n\nimport pytest\nfrom unittest.mock import patch\n\nfrom custom_components.robovac.robovac import RoboVac\nfrom custom_components.robovac.vacuums.base import RobovacCommand\n\n\n@pytest.fixture\ndef mock_txxx_robovac():\n    \"\"\"Create a mock TXXX RoboVac instance for testing.\"\"\"\n    with patch(\"custom_components.robovac.robovac.TuyaDevice.__init__\", return_value=None):\n        robovac = RoboVac(\n            model_code=\"TXXX\",\n            device_id=\"test_id\",\n            host=\"192.168.1.100\",\n            local_key=\"test_key\",\n        )\n        return robovac\n\n\ndef test_txxx_model_has_required_commands(mock_txxx_robovac):\n    \"\"\"Test that TXXX model has required commands defined.\"\"\"\n    commands = mock_txxx_robovac.model_details.commands\n\n    assert RobovacCommand.MODE in commands\n    assert RobovacCommand.FAN_SPEED in commands\n    # ... other assertions\n</code></pre>"},{"location":"development/#logging-strategy","title":"Logging Strategy","text":""},{"location":"development/#log-levels","title":"Log Levels","text":"<ul> <li>DEBUG: Diagnostic information for troubleshooting (e.g., value lookups, state changes)</li> <li>INFO: General informational messages (e.g., \"Data points now available\")</li> <li>WARNING: Actual problems that need attention (e.g., initialization failures, update failures)</li> <li>ERROR: Serious errors (e.g., vacuum not initialized for critical operations)</li> </ul>"},{"location":"development/#examples","title":"Examples","text":"<pre><code># DEBUG: Diagnostic information\n_LOGGER.debug(\"Successfully updated vacuum %s\", self._attr_name)\n\n# WARNING: Actual problem\n_LOGGER.warning(\"Cannot update vacuum %s: IP address not set\", self._attr_name)\n\n# ERROR: Serious issue\n_LOGGER.error(\"Cannot locate vacuum: vacuum not initialized\")\n</code></pre>"},{"location":"development/#testing-best-practices","title":"Testing Best Practices","text":""},{"location":"development/#test-structure","title":"Test Structure","text":"<p>Follow the pattern from <code>test_t2251_command_mappings.py</code>:</p> <ol> <li>Create a fixture for the mock RoboVac instance</li> <li>Test command value mappings</li> <li>Test case-insensitive matching</li> <li>Test model structure (commands present)</li> </ol>"},{"location":"development/#test-coverage","title":"Test Coverage","text":"<ul> <li>Aim for 100% coverage of modified code</li> <li>Test both success and failure paths</li> <li>Use mocking to isolate units under test</li> <li>Follow TDD: write tests before implementation</li> <li>Run <code>task test</code> to verify coverage</li> </ul>"},{"location":"development/#running-tests-with-coverage","title":"Running Tests with Coverage","text":"<pre><code># View coverage report\ntask test\n\n# Generate HTML coverage report\npytest --cov=custom_components.robovac --cov-report=html\n</code></pre>"},{"location":"development/#commit-guidelines","title":"Commit Guidelines","text":"<p>Follow Conventional Commits:</p> <ul> <li><code>feat:</code> New feature</li> <li><code>fix:</code> Bug fix</li> <li><code>refactor:</code> Code refactoring without behavior change</li> <li><code>test:</code> Adding or updating tests</li> <li><code>docs:</code> Documentation updates</li> <li><code>chore:</code> Maintenance tasks</li> </ul> <p>Examples:</p> <pre><code>feat: add T2250 command mappings\nfix: handle \"No error\" status correctly\ntest: add T2251 command mapping tests\nrefactor: improve value lookup logic\ndocs: update development guide\n</code></pre>"},{"location":"development/#common-tasks","title":"Common Tasks","text":""},{"location":"development/#debugging-a-failing-test","title":"Debugging a Failing Test","text":"<pre><code># Run with verbose output\npytest tests/test_vacuum/test_t2251_command_mappings.py -v -s\n\n# Run with pdb debugger\npytest tests/test_vacuum/test_t2251_command_mappings.py --pdb\n\n# Run specific test\npytest tests/test_vacuum/test_t2251_command_mappings.py::test_t2251_mode_has_values -v\n</code></pre>"},{"location":"development/#checking-type-hints","title":"Checking Type Hints","text":"<pre><code># Run type checker\ntask type-check\n\n# Check specific file\nmypy custom_components/robovac/robovac.py\n</code></pre>"},{"location":"development/#formatting-code","title":"Formatting Code","text":"<pre><code># Run linter\ntask lint\n\n# Auto-fix formatting issues\nblack custom_components/robovac/\n</code></pre>"},{"location":"development/#resources","title":"Resources","text":"<ul> <li>Home Assistant Developer Documentation</li> <li>Tuya Local API Documentation</li> <li>Pytest Documentation</li> <li>Python Type Hints</li> </ul>"},{"location":"development/#getting-help","title":"Getting Help","text":"<ul> <li>Check existing issues and PRs</li> <li>Review the troubleshooting guide</li> <li>Enable debug logging to diagnose issues</li> <li>Create detailed issue reports with logs</li> </ul>"},{"location":"dps_codes/","title":"Understanding and Working with DPS Codes","text":""},{"location":"dps_codes/#what-is-a-dps-code","title":"What is a DPS Code?","text":"<p>DPS (Data Point Specification) codes are numeric identifiers used in Tuya-based devices like Eufy RoboVacs to control various functions and retrieve device states. Each DPS code maps to a specific function or feature of your vacuum, such as:</p> <ul> <li>Battery level</li> <li>Cleaning mode</li> <li>Fan speed</li> <li>Error status</li> <li>Cleaning area</li> <li>Cleaning time</li> </ul> <p>In the RoboVac integration, these codes are used to communicate with your vacuum via the Tuya local API. Think of them as the language that allows Home Assistant to talk to your vacuum.</p>"},{"location":"dps_codes/#how-to-find-dps-codes-for-your-device","title":"How to Find DPS Codes for Your Device","text":"<p>Finding the correct DPS codes for your vacuum model is essential for adding support for new devices. Here are methods to discover these codes:</p>"},{"location":"dps_codes/#method-1-use-the-model-dps-analysis-tool","title":"Method 1: Use the Model DPS Analysis Tool","text":"<p>The repository includes a test that analyzes DPS codes for all supported models:</p> <ol> <li>Navigate to the <code>tests/test_vacuum/test_model_dps_analysis.py</code> file (or run <code>analyze_model_dps.py</code> in the root directory).</li> <li>Run this script to generate a report showing:</li> <li>Which models use default codes</li> <li>Which models use custom codes</li> <li>What specific custom codes are used by each model</li> </ol> <p>This can help you understand patterns in how different models use DPS codes.</p>"},{"location":"dps_codes/#method-2-enable-debug-logging","title":"Method 2: Enable Debug Logging","text":"<ol> <li>Enable debug logging for the RoboVac component in your Home Assistant configuration:</li> </ol> <pre><code>logger:\n  default: info\n  logs:\n    custom_components.robovac: debug\n</code></pre> <ol> <li>Restart Home Assistant and monitor the logs while operating your vacuum.</li> <li>Look for log entries showing <code>\"Updating entity values from data points: ...\"</code> which will display all the DPS codes and values being reported by your device.</li> </ol>"},{"location":"dps_codes/#method-3-analyze-network-traffic-advanced","title":"Method 3: Analyze Network Traffic (Advanced)","text":"<p>For more advanced users:</p> <ol> <li>Use a tool like Wireshark to capture traffic between your Home Assistant instance and your vacuum.</li> <li>Filter for traffic to/from your vacuum's IP address.</li> <li>Look for Tuya protocol messages, which contain DPS code information in their payload.</li> <li>Decode these messages to identify which DPS codes your vacuum is using and their functions.</li> </ol>"},{"location":"dps_codes/#method-4-external-tools","title":"Method 4: External Tools","text":"<p>If you're comfortable with Python, you can try these tools to capture raw device data:</p> <ul> <li>eufy-device-id-python - Gets device info from Eufy servers</li> <li><code>tinytuya scan</code> - Scans local network for Tuya devices (after you have credentials)</li> </ul>"},{"location":"dps_codes/#adding-support-for-a-new-device","title":"Adding Support for a New Device","text":"<p>To add support for a new device, you'll need to:</p> <ol> <li>Determine your model code: This is typically the first 5 characters of the full model number.</li> <li>Identify required DPS codes: Using the methods above, determine which DPS codes your vacuum uses.</li> <li>Create a model-specific class: If your vacuum uses non-default DPS codes, you'll need to create a model-specific class in the <code>custom_components/robovac/vacuums/</code> directory.</li> <li>Map commands to DPS codes: In your model class, create mappings between RoboVac commands and the DPS codes your vacuum uses.</li> </ol>"},{"location":"dps_codes/#example-implementation","title":"Example Implementation","text":"<p>Here's a simplified example of how a model-specific class looks:</p> <pre><code>from custom_components.robovac.vacuums.base import RobovacModelDetails, RoboVacEntityFeature, RobovacCommand\n\nclass YourModel(RobovacModelDetails):\n    \"\"\"Implementation for Your Specific Model.\"\"\"\n\n    # Define which Home Assistant features this vacuum supports\n    homeassistant_features = (\n        # Add relevant features here\n    )\n\n    # Define which RoboVac features this vacuum supports\n    robovac_features = (\n        # Add relevant features here\n    )\n\n    # Map commands to DPS codes - override any that differ from defaults\n    dps_codes = {\n        \"BATTERY_LEVEL\": \"104\",  # Example - use actual codes from your device\n        \"STATUS\": \"15\",\n        # Add other codes as needed\n    }\n\n    # Define available commands\n    commands = {\n        RobovacCommand.START_PAUSE: True,\n        RobovacCommand.BATTERY: True,\n        # Add other commands as appropriate\n    }\n</code></pre>"},{"location":"troubleshooting/","title":"RoboVac Troubleshooting Guide","text":"<p>This document provides solutions to common issues with the RoboVac integration.</p>"},{"location":"troubleshooting/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Understanding and Working with DPS Codes</li> <li>Common Connection Issues</li> <li>Feature Support Issues</li> </ul>"},{"location":"troubleshooting/#understanding-and-working-with-dps-codes","title":"Understanding and Working with DPS Codes","text":"<p>Please refer to the dedicated DPS Codes Guide for detailed information on what DPS codes are, how to find them, and how to use them to add support for new devices.</p>"},{"location":"troubleshooting/#common-connection-issues","title":"Common Connection Issues","text":""},{"location":"troubleshooting/#coming-soon","title":"Coming Soon","text":"<p>This section will be expanded in the future.</p>"},{"location":"troubleshooting/#feature-support-issues","title":"Feature Support Issues","text":""},{"location":"troubleshooting/#coming-soon_1","title":"Coming Soon","text":"<p>This section will be expanded in the future.</p>"},{"location":"troubleshooting/#common-troubleshooting-tips","title":"Common Troubleshooting Tips","text":"<ul> <li>Device not responding: Verify your IP address and access token are correct.</li> <li>Command not working: Check if the DPS code mapping is correct for that specific command.</li> <li>Values not updating: Ensure the DPS code for status information is correctly mapped.</li> </ul>"},{"location":"archive/","title":"Archive","text":"<p>This directory contains historical documentation from completed improvement initiatives.</p>"},{"location":"archive/#contents","title":"Contents","text":"<ul> <li>IMPROVEMENT_PLAN.md - Complete analysis and 4-phase implementation plan for the RoboVac integration improvements (October 2025)</li> <li>NEXT_STEPS.md - Quick reference guide for the improvement plan phases</li> </ul>"},{"location":"archive/#reference","title":"Reference","text":"<p>These documents are kept for historical reference and to understand the evolution of the codebase. For current development guidance, see the main Development Workflow section.</p>"},{"location":"archive/IMPROVEMENT_PLAN/","title":"Code Improvement Plan: more-mappings-work Branch","text":""},{"location":"archive/IMPROVEMENT_PLAN/#overview","title":"Overview","text":"<p>This document outlines improvements needed for the <code>more-mappings-work</code> branch changes, focusing on code quality, test coverage, maintainability, and consistency.</p>"},{"location":"archive/IMPROVEMENT_PLAN/#branch-summary","title":"Branch Summary","text":"<p>Changes Made:</p> <ul> <li>Added case-insensitive matching in <code>robovac.py</code> <code>getRoboVacHumanReadableValue()</code></li> <li>Enhanced error logging with detailed type and debug information</li> <li>Added error code mappings to 8 vacuum models (T2250-T2262 series)</li> <li>Added bidirectional mappings for device-to-human conversion</li> <li>Updated <code>vacuum.py</code> error checking to include \"No error\" string</li> <li>Added tests for case-insensitive matching behavior</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#high-priority-issues","title":"High Priority Issues","text":""},{"location":"archive/IMPROVEMENT_PLAN/#1-bidirectional-mapping-redundancy","title":"1. Bidirectional Mapping Redundancy","text":"<p>Problem: Current approach duplicates dictionary entries to handle both directions:</p> <pre><code>\"values\": {\n    \"auto\": \"Auto\",        # Human-to-device\n    \"Auto\": \"Auto\",        # Bidirectional (redundant with case-insensitive)\n    \"small_room\": \"SmallRoom\",\n    \"SmallRoom\": \"SmallRoom\",\n}\n</code></pre> <p>Impact:</p> <ul> <li>Code duplication violates DRY principle</li> <li>Maintenance burden (update in 2 places)</li> <li>Confusion about which mapping is canonical</li> <li>Unnecessary memory usage</li> </ul> <p>Solution:</p> <ol> <li>Remove bidirectional duplicates since case-insensitive matching handles this</li> <li>Establish single canonical format (lowercase snake_case for keys)</li> <li>Document that case-insensitive matching handles device responses</li> </ol> <p>Implementation Steps:</p> <ul> <li>Create test to verify case-insensitive matching works for all models</li> <li>Remove duplicate bidirectional mappings from T2250, T2252, T2253, T2254, T2255, T2259, T2262</li> <li>Update documentation explaining mapping convention</li> <li>Verify tests pass</li> </ul> <p>Files Affected:</p> <ul> <li><code>vacuums/T2250.py</code>, <code>T2252.py</code>, <code>T2253.py</code>, <code>T2254.py</code>, <code>T2255.py</code>, <code>T2259.py</code>, <code>T2262.py</code></li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#2-inconsistent-value-mappings-across-models","title":"2. Inconsistent Value Mappings Across Models","text":"<p>Problem: Different models use inconsistent capitalization for the same values:</p> <ul> <li>T2250: <code>\"auto\": \"Auto\"</code>, <code>\"standard\": \"Standard\"</code></li> <li>T2252: <code>\"Auto\": \"Auto\"</code>, <code>\"Standard\": \"Standard\"</code></li> </ul> <p>Impact:</p> <ul> <li>Confusing for maintainers</li> <li>Potential bugs when comparing across models</li> <li>Harder to write generic tests</li> </ul> <p>Solution:</p> <ol> <li>Standardize on lowercase snake_case for all mapping keys</li> <li>PascalCase for human-readable values</li> <li>Apply consistently across all 35+ vacuum models</li> </ol> <p>Implementation Steps:</p> <ul> <li>Audit all T2* model files for mapping consistency</li> <li>Create migration script if needed</li> <li>Update tests to verify consistency</li> <li>Document standard in contributing guide</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#3-missing-tests-for-modified-models","title":"3. Missing Tests for Modified Models","text":"<p>Problem: Modified models (T2250-T2262 series) lack specific tests:</p> <ul> <li>No tests for error code mappings</li> <li>No tests for bidirectional MODE mappings</li> <li>No integration tests for case-insensitive behavior</li> </ul> <p>Impact:</p> <ul> <li>Changes unverified by tests (violates TDD)</li> <li>Regression risk</li> <li>Difficult to validate future changes</li> </ul> <p>Solution: Following TDD principles, create comprehensive tests:</p> <p>Test Files Needed:</p> <ol> <li><code>test_t2250_command_mappings.py</code></li> <li><code>test_t2251_command_mappings.py</code></li> <li><code>test_t2252_command_mappings.py</code></li> <li><code>test_t2253_command_mappings.py</code></li> <li><code>test_t2254_command_mappings.py</code></li> <li><code>test_t2255_command_mappings.py</code></li> <li><code>test_t2259_command_mappings.py</code></li> <li><code>test_t2262_command_mappings.py</code></li> </ol> <p>Each Test Should Cover:</p> <ul> <li>Error code mapping (0 -&gt; \"No error\")</li> <li>MODE command mappings (all variants)</li> <li>FAN_SPEED mappings</li> <li>Case-insensitive matching</li> <li>Feature flag verification</li> </ul> <p>Template Structure (based on existing <code>test_t2277_command_mappings.py</code>):</p> <pre><code>\"\"\"Tests for T2XXX vacuum model commands.\"\"\"\nimport pytest\nfrom custom_components.robovac.robovac import RoboVac\nfrom custom_components.robovac.vacuums.base import RobovacCommand\n\n@pytest.fixture\ndef mock_t2xxx_robovac():\n    \"\"\"Create a T2XXX RoboVac instance for testing.\"\"\"\n    # Use existing fixture pattern\n\ndef test_error_code_mapping(mock_t2xxx_robovac):\n    \"\"\"Test error code 0 maps to 'No error'.\"\"\"\n\ndef test_mode_mappings(mock_t2xxx_robovac):\n    \"\"\"Test MODE command accepts all expected values.\"\"\"\n\ndef test_fan_speed_mappings(mock_t2xxx_robovac):\n    \"\"\"Test FAN_SPEED command mappings.\"\"\"\n\ndef test_case_insensitive_mode(mock_t2xxx_robovac):\n    \"\"\"Test MODE accepts case-insensitive values.\"\"\"\n</code></pre>"},{"location":"archive/IMPROVEMENT_PLAN/#4-incomplete-error-code-mappings","title":"4. Incomplete Error Code Mappings","text":"<p>Problem: All modified models only define error code 0:</p> <pre><code>RobovacCommand.ERROR: {\n    \"code\": 106,\n    \"values\": {\n        \"0\": \"No error\",\n    },\n},\n</code></pre> <p>Impact:</p> <ul> <li>Users see numeric error codes instead of helpful messages</li> <li>Poor user experience</li> <li>Incomplete implementation</li> </ul> <p>Solution:</p> <ol> <li>Research actual error codes for each model from:</li> <li>Eufy app APK decompilation</li> <li>User reports</li> <li>Device logs</li> <li>Add comprehensive error mappings</li> <li>Document unknown errors with TODO comments</li> </ol> <p>Example Target:</p> <pre><code>RobovacCommand.ERROR: {\n    \"code\": 106,\n    \"values\": {\n        \"0\": \"No error\",\n        \"1\": \"Wheel stuck\",\n        \"2\": \"Side brush stuck\",\n        \"3\": \"Suction motor stuck\",\n        # TODO: Add more error codes as discovered\n    },\n},\n</code></pre>"},{"location":"archive/IMPROVEMENT_PLAN/#5-warning-message-logic-improvement","title":"5. Warning Message Logic Improvement","text":"<p>Problem: Current warning logs extensive debug info for every unmapped value:</p> <pre><code>_LOGGER.warning(\n    \"Command %s with value %r (type: %s, str=%r) not found for model %s. \"\n    \"Available keys: %r (first key repr: %r). \"\n    \"If you know the status...\",\n    # 7 parameters\n)\n</code></pre> <p>Impact:</p> <ul> <li>Verbose logs for normal operation</li> <li>Difficult to read/filter</li> <li>Performance impact from repr() calls</li> </ul> <p>Solution:</p> <ol> <li>Use different log levels:</li> <li><code>DEBUG</code> for detailed type/key info</li> <li><code>WARNING</code> for actual issues</li> <li>Rate-limit warnings (already implemented elsewhere)</li> <li>Consolidate debug info</li> </ol> <p>Proposed:</p> <pre><code>_LOGGER.debug(\n    \"Unmapped value for %s: %r (type: %s). Available: %s\",\n    command_name, value, type(value).__name__, list(values.keys())[:5]\n)\n_LOGGER.warning(\n    \"Command %s value %s not found for model %s. \"\n    \"Please report this to maintainers with the status shown in Eufy app.\",\n    command_name, value, self.model_code\n)\n</code></pre>"},{"location":"archive/IMPROVEMENT_PLAN/#medium-priority-issues","title":"Medium Priority Issues","text":""},{"location":"archive/IMPROVEMENT_PLAN/#6-improve-type-hints","title":"6. Improve Type Hints","text":"<p>Problem: Some functions lack complete type hints, especially around command value mappings.</p> <p>Solution:</p> <ul> <li>Add strict type hints to all public methods</li> <li>Use <code>TypedDict</code> for command structures</li> <li>Enable stricter mypy settings</li> </ul> <p>Files:</p> <ul> <li><code>robovac.py</code></li> <li><code>vacuum.py</code></li> <li><code>vacuums/base.py</code></li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#7-extract-case-insensitive-lookup","title":"7. Extract Case-Insensitive Lookup","text":"<p>Problem: Case-insensitive lookup logic is inline and not reusable.</p> <p>Solution: Extract to utility function:</p> <pre><code>def case_insensitive_dict_lookup(\n    d: dict[str, str], \n    key: str\n) -&gt; str | None:\n    \"\"\"Case-insensitive dictionary lookup.\n\n    Args:\n        d: Dictionary to search\n        key: Key to find (case-insensitive)\n\n    Returns:\n        Value if found, None otherwise\n    \"\"\"\n    # Try exact match first (O(1))\n    if key in d:\n        return d[key]\n\n    # Try case-insensitive (O(n))\n    key_lower = key.lower()\n    for k, v in d.items():\n        if k.lower() == key_lower:\n            return v\n\n    return None\n</code></pre> <p>Benefits:</p> <ul> <li>Testable in isolation</li> <li>Reusable</li> <li>Self-documenting</li> <li>Can add caching if needed</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#8-add-integration-tests","title":"8. Add Integration Tests","text":"<p>Problem: No tests verify the full flow from device value \u2192 human-readable \u2192 UI display.</p> <p>Solution: Add integration tests that:</p> <ol> <li>Mock device status update</li> <li>Verify <code>getRoboVacHumanReadableValue()</code> called correctly</li> <li>Verify vacuum entity state reflects human-readable value</li> <li>Test error state handling with new \"No error\" string</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#9-consolidate-error-checking-logic","title":"9. Consolidate Error Checking Logic","text":"<p>Problem: <code>vacuum.py</code> checks multiple error conditions:</p> <pre><code>elif (\n    self.error_code is not None\n    and self.error_code not in [0, \"no_error\", \"No error\"]\n):\n</code></pre> <p>Impact:</p> <ul> <li>Hard to maintain</li> <li>Case-sensitivity issues</li> <li>Magic strings</li> </ul> <p>Solution:</p> <pre><code>def is_error_state(error_code: Any) -&gt; bool:\n    \"\"\"Check if error code indicates an error state.\n\n    Args:\n        error_code: Error code from device\n\n    Returns:\n        True if error state, False otherwise\n    \"\"\"\n    if error_code is None or error_code == 0:\n        return False\n\n    # Handle string \"no error\" case-insensitively\n    if isinstance(error_code, str) and error_code.lower() == \"no error\":\n        return False\n\n    return True\n</code></pre>"},{"location":"archive/IMPROVEMENT_PLAN/#low-priority-issues","title":"Low Priority Issues","text":""},{"location":"archive/IMPROVEMENT_PLAN/#10-documentation-updates","title":"10. Documentation Updates","text":"<p>Needs:</p> <ul> <li>Update README with new case-insensitive behavior</li> <li>Document bidirectional mapping removal</li> <li>Add contributing guide section on command mappings</li> <li>Create error code discovery guide</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#11-performance-optimization","title":"11. Performance Optimization","text":"<p>Potential Improvements:</p> <ul> <li>Cache case-insensitive lookups</li> <li>Pre-compute lowercase key mappings</li> <li>Profile frequently called methods</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#testing-strategy","title":"Testing Strategy","text":""},{"location":"archive/IMPROVEMENT_PLAN/#test-execution","title":"Test Execution","text":"<p>Use <code>task test</code> (per memory) to run full test suite.</p>"},{"location":"archive/IMPROVEMENT_PLAN/#coverage-goals","title":"Coverage Goals","text":"<ul> <li>Maintain or improve current coverage</li> <li>100% coverage for new/modified code</li> <li>Focus on edge cases (case variants, None values, unknown codes)</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#test-writing-guidelines","title":"Test Writing Guidelines","text":"<ol> <li>Follow existing patterns in <code>test_t2277_command_mappings.py</code></li> <li>Use descriptive test names</li> <li>Test both success and failure paths</li> <li>Don't test uncertain return values</li> <li>Use fixtures from <code>conftest.py</code></li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#implementation-order","title":"Implementation Order","text":""},{"location":"archive/IMPROVEMENT_PLAN/#phase-1-critical-fixes-week-1","title":"Phase 1: Critical Fixes (Week 1)","text":"<ol> <li>Remove bidirectional mapping duplicates</li> <li>Standardize mapping conventions</li> <li>Extract case-insensitive lookup utility</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#phase-2-test-coverage-week-2","title":"Phase 2: Test Coverage (Week 2)","text":"<ol> <li>Create test files for T2250-T2262 models</li> <li>Add integration tests</li> <li>Verify 100% coverage for changes</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#phase-3-enhancement-week-3-complete","title":"Phase 3: Enhancement (Week 3) - COMPLETE","text":"<ol> <li>Improve logging strategy</li> <li>Changed value lookup failures from WARNING to DEBUG level</li> <li>Simplified debug message format for clarity</li> <li> <p>Warnings now reserved for actual problems (initialization, update failures)</p> </li> <li> <p>Extract case-insensitive lookup utility</p> </li> <li>Created case_insensitive_lookup.py module</li> <li>Refactored getRoboVacHumanReadableValue() to use utility</li> <li>Reduced code duplication and improved maintainability</li> <li> <p>Updated tests to verify debug logging behavior</p> </li> <li> <p>Add comprehensive type hints</p> </li> <li>Full type annotations in case_insensitive_lookup.py</li> <li>Type hints throughout core modules</li> <li>task type-check passing</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#phase-4-polish-week-4-complete","title":"Phase 4: Polish (Week 4) - COMPLETE","text":"<ol> <li>\u2705 Update documentation</li> <li>Updated README.md with Development section</li> <li>Created DEVELOPMENT.md with developer guide</li> <li>Removed unnecessary jargon (case_insensitive_lookup mentions)</li> <li> <p>All markdown linting passes</p> </li> <li> <p>\u2705 Code cleanup</p> </li> <li>Removed unused str_value variable</li> <li>All imports are used and necessary</li> <li>Consistent code style throughout</li> <li> <p>No debug code remains</p> </li> <li> <p>\u2705 Final verification</p> </li> <li>All 143 tests passing</li> <li>Type checking: Success (no issues found in 51 source files)</li> <li>Linting: All checks pass (0 errors)</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#success-criteria","title":"Success Criteria","text":"<ul> <li>[x] All tests pass with <code>task test</code> (143 passed)</li> <li>[x] No duplicate bidirectional mappings</li> <li>[x] Consistent mapping conventions across all models</li> <li>[x] 100% test coverage for modified code</li> <li>[x] All 8 modified models have dedicated test files (7 created)</li> <li>[x] Type hints added with <code>task type-check</code> passing</li> <li>[x] Documentation updated (README.md, DEVELOPMENT.md)</li> <li>[x] No regression in existing functionality</li> <li>[x] Code cleanup complete (linting passes)</li> <li>[x] All markdown files pass linting</li> </ul>"},{"location":"archive/IMPROVEMENT_PLAN/#notes-for-next-developer","title":"Notes for Next Developer","text":""},{"location":"archive/IMPROVEMENT_PLAN/#key-files-to-understand","title":"Key Files to Understand","text":"<ol> <li><code>robovac.py</code> - Core RoboVac class with command mapping logic</li> <li><code>vacuum.py</code> - Home Assistant vacuum entity</li> <li><code>vacuums/base.py</code> - Base classes and enums</li> <li><code>vacuums/T2*.py</code> - Model-specific command mappings</li> <li><code>tests/test_vacuum/test_get_robovac_human_readable_value.py</code> - Test patterns</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\ntask test\n\n# Run specific test file\npytest tests/test_vacuum/test_t2250_command_mappings.py -v\n\n# Run with coverage\ntask test  # Already includes coverage\n</code></pre>"},{"location":"archive/IMPROVEMENT_PLAN/#linting-and-type-checking","title":"Linting and Type Checking","text":"<pre><code>task lint\ntask type-check\n</code></pre>"},{"location":"archive/IMPROVEMENT_PLAN/#before-committing","title":"Before Committing","text":"<ol> <li>Run <code>task test</code> - ensure all tests pass</li> <li>Run <code>task lint</code> - fix any style issues</li> <li>Run <code>task type-check</code> - verify type hints</li> <li>Use conventional commit format: <code>feat:</code>, <code>fix:</code>, <code>refactor:</code>, <code>test:</code></li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#questions-for-maintainer","title":"Questions for Maintainer","text":"<ol> <li>Error Code Research: What's the preferred method for discovering error codes?</li> <li>Breaking Changes: Is it acceptable to remove bidirectional mappings in a minor version?</li> <li>Backwards Compatibility: Should old hardcoded checks for \"no_error\" vs \"No error\" be maintained?</li> <li>Model Priority: Which models should get error code mappings first?</li> </ol>"},{"location":"archive/IMPROVEMENT_PLAN/#related-issuesprs","title":"Related Issues/PRs","text":"<ul> <li>PR #161 - Original T2080 implementation with <code>getRoboVacHumanReadableValue()</code></li> <li>Memory references T2277, T2278, T2320 recent additions</li> <li>CODE_COVERAGE_TODO.md (if exists) for broader testing strategy</li> </ul> <p>Document Version: 1.0 Created: 2025-10-21 Branch: more-mappings-work Author: Code Review Bot (Cascade)</p>"},{"location":"archive/NEXT_STEPS/","title":"Quick Reference: Next Steps for more-mappings-work","text":""},{"location":"archive/NEXT_STEPS/#tldr","title":"TL;DR","text":"<p>The branch needs test coverage for modified models, removal of duplicate mappings, and consistent conventions.</p>"},{"location":"archive/NEXT_STEPS/#immediate-actions","title":"Immediate Actions","text":""},{"location":"archive/NEXT_STEPS/#1-remove-duplicate-bidirectional-mappings-30-min","title":"1. Remove Duplicate Bidirectional Mappings (30 min)","text":"<p>Why: Case-insensitive matching makes them redundant Files: T2250.py, T2252.py, T2253.py, T2254.py, T2255.py, T2259.py, T2262.py</p> <pre><code># Remove this:\n\"Auto\": \"Auto\",        # Bidirectional duplicate\n\"SmallRoom\": \"SmallRoom\",\n\n# Keep this:\n\"auto\": \"Auto\",\n\"small_room\": \"SmallRoom\",\n</code></pre>"},{"location":"archive/NEXT_STEPS/#2-create-missing-tests-4-hours","title":"2. Create Missing Tests (4 hours)","text":"<p>Critical Gap: No tests for 8 modified models</p> <p>Create these files following <code>test_t2277_command_mappings.py</code> pattern:</p> <ul> <li><code>test_t2250_command_mappings.py</code></li> <li><code>test_t2251_command_mappings.py</code></li> <li><code>test_t2252_command_mappings.py</code></li> <li><code>test_t2253_command_mappings.py</code></li> <li><code>test_t2254_command_mappings.py</code></li> <li><code>test_t2255_command_mappings.py</code></li> <li><code>test_t2259_command_mappings.py</code></li> <li><code>test_t2262_command_mappings.py</code></li> </ul> <p>Each test must cover:</p> <ul> <li>Error code mapping (0 \u2192 \"No error\")</li> <li>MODE command values</li> <li>Case-insensitive matching</li> <li>FAN_SPEED mappings</li> </ul>"},{"location":"archive/NEXT_STEPS/#3-standardize-value-conventions-1-hour","title":"3. Standardize Value Conventions (1 hour)","text":"<p>Problem: T2250 uses <code>\"auto\"</code>, T2252 uses <code>\"Auto\"</code></p> <p>Solution: All keys lowercase snake_case, all values PascalCase</p>"},{"location":"archive/NEXT_STEPS/#running-tests","title":"Running Tests","text":"<pre><code>task test           # Run all tests\ntask lint           # Check code style\ntask type-check     # Verify type hints\n</code></pre>"},{"location":"archive/NEXT_STEPS/#files-changed-in-branch","title":"Files Changed in Branch","text":"File Change Tests Needed <code>robovac.py</code> Case-insensitive matching \u2705 Done <code>vacuum.py</code> Error check includes \"No error\" \u26a0\ufe0f Integration test needed <code>T2250.py</code> - <code>T2262.py</code> (8 files) Error mappings + bidirectional \u274c No tests"},{"location":"archive/NEXT_STEPS/#priority-order","title":"Priority Order","text":"<ol> <li>HIGH: Create test files (violates TDD)</li> <li>HIGH: Remove duplicate mappings (code smell)</li> <li>MEDIUM: Standardize conventions (maintainability)</li> <li>LOW: Enhanced error codes (user experience)</li> </ol>"},{"location":"archive/NEXT_STEPS/#success-checklist","title":"Success Checklist","text":"<ul> <li>[ ] <code>task test</code> passes</li> <li>[ ] 8 new test files created</li> <li>[ ] No \"Bidirectional mappings\" comments remain</li> <li>[ ] All mapping keys use lowercase snake_case</li> <li>[ ] Test coverage \u2265 previous level</li> </ul>"},{"location":"archive/NEXT_STEPS/#see-also","title":"See Also","text":"<ul> <li><code>IMPROVEMENT_PLAN.md</code> - Complete analysis and strategy</li> <li><code>tests/test_vacuum/test_t2277_command_mappings.py</code> - Test template</li> <li>User rules require TDD: write tests first!</li> </ul> <p>Estimated Time: 6 hours total Risk: Low (backward compatible changes) Blocks: None</p>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/","title":"Issue #186 Analysis Summary","text":""},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#quick-answer","title":"Quick Answer","text":"<p>Is the error still present? \u26a0\ufe0f YES</p> <p>The underlying problem still exists, but the symptom has changed:</p> <ul> <li>Before: WARNING logs flooding Home Assistant</li> <li>Now: DEBUG logs (less visible) + status values not translated to human-readable form</li> <li>Root Cause: T2262 model definition missing STATUS value mappings</li> </ul>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#the-problem","title":"The Problem","text":"<p>Users with T2262 vacuum models report these status values cannot be translated:</p> <ul> <li>\"Charging\"</li> <li>\"Sleeping\"  </li> <li>\"completed\"</li> </ul> <p>Current T2262 Definition:</p> <pre><code>RobovacCommand.STATUS: {\n    \"code\": 15,\n},\n</code></pre> <p>Missing the <code>values</code> dictionary that maps device responses to human-readable strings.</p> <p>What Happens:</p> <ol> <li>Device sends status like \"Charging\"</li> <li><code>getRoboVacHumanReadableValue()</code> can't find mapping</li> <li>Returns raw value as-is</li> <li>Logs debug message (not visible unless debug logging enabled)</li> <li>Home Assistant might display raw value instead of friendly status</li> </ol>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#why-we-cant-fix-it-immediately","title":"Why We Can't Fix It Immediately","text":"<p>CRITICAL BLOCKER: We need actual device data.</p> <ul> <li>T2262 uses STATUS code 15</li> <li>T2277 (which has mappings) uses code 153</li> <li>Different codes = different value encodings</li> <li>Cannot safely copy mappings between models</li> </ul> <p>Example from T2277 (code 153):</p> <pre><code>\"Charging\": \"BBADGgA=\",  # Base64-encoded\n\"Sleeping\": \"AhAB\",\n</code></pre> <p>T2262's code 15 likely uses completely different values.</p>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#solution-path","title":"Solution Path","text":""},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#step-1-get-real-data-required","title":"Step 1: Get Real Data (REQUIRED)","text":"<p>Contact users via issue #186 and request:</p> <pre><code># Enable debug logging in Home Assistant\nlogger:\n  default: info\n  logs:\n    custom_components.robovac: debug\n</code></pre> <p>Need them to capture:</p> <ul> <li>Raw value device sends</li> <li>What Eufy app displayed</li> <li>Do this for: Charging, Sleeping, Completed, Standby, Paused, Cleaning, etc.</li> </ul>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#step-2-implement-fix-tdd","title":"Step 2: Implement Fix (TDD)","text":"<ol> <li>Write failing test for STATUS values</li> <li>Add mappings to T2262.py</li> <li>Verify tests pass</li> <li>User validation on real device</li> </ol>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#step-3-apply-to-related-models","title":"Step 3: Apply to Related Models","text":"<p>These models also have STATUS code 15 with no values:</p> <ul> <li>T2253 (specifically mentioned in issue)</li> <li>T2250, T2251, T2252, T2254, T2255, T2259, T2268, T2270, T2272, T2273</li> </ul>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#what-ive-created","title":"What I've Created","text":""},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#issue_186_fix_planmd","title":"\ud83d\udccb <code>ISSUE_186_FIX_PLAN.md</code>","text":"<p>Comprehensive implementation plan including:</p> <ul> <li>\u2705 Detailed step-by-step instructions</li> <li>\u2705 TDD workflow (test first!)</li> <li>\u2705 Code examples and templates</li> <li>\u2705 Testing requirements</li> <li>\u2705 User validation checklist</li> <li>\u2705 Git workflow with commit messages</li> <li>\u2705 Risk assessment</li> <li>\u2705 Success criteria</li> </ul> <p>This plan is ready to hand off to another LLM or developer.</p>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#key-instructions-for-next-llm","title":"Key Instructions for Next LLM","text":""},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#do-not-proceed-until","title":"DO NOT Proceed Until","text":"<ol> <li>\u274c User provides actual T2262 device data</li> <li>\u274c At least 5-7 status values collected</li> <li>\u274c User confirms Eufy app display for each value</li> </ol>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#must-follow-tdd","title":"MUST Follow TDD","text":"<ol> <li>\u2705 Write test FIRST</li> <li>\u2705 Verify test FAILS</li> <li>\u2705 Implement feature</li> <li>\u2705 Verify test PASSES</li> <li>\u2705 Run full test suite</li> </ol>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#do-not","title":"DO NOT","text":"<ul> <li>\u274c Guess at status values</li> <li>\u274c Copy from T2277 (different code!)</li> <li>\u274c Skip tests</li> <li>\u274c Implement without data</li> </ul>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#current-status","title":"Current Status","text":"Phase Status Blocker Data Collection \u23f8\ufe0f Waiting Need user input Implementation \u23f8\ufe0f Blocked Waiting on data Testing \u23f8\ufe0f Blocked Waiting on implementation User Validation \u23f8\ufe0f Blocked Waiting on implementation"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#next-actions","title":"Next Actions","text":""},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#for-you-repository-owner","title":"For You (Repository Owner)","text":"<ol> <li>Post comment on issue #186 requesting device data:</li> </ol> <pre><code>Hi everyone! To fix this issue properly, I need actual device data from T2262 owners.\n\nCould you please:\n\n1. Enable debug logging in Home Assistant:\n\n   ```yaml\n   logger:\n     default: info\n     logs:\n       custom_components.robovac: debug\n   ```\n\n1. Watch your logs and note when you see messages like:\n   \"Command status with value X not found for model T2262\"\n\n1. For each message, tell me:\n   - The raw value (X in the message)\n   - What the Eufy app showed at that exact time\n\nExample:\n\n- Raw value: \"charging\"\n- Eufy app showed: \"Charging\"\n\nEspecially interested in these states:\n\n- Charging\n- Sleeping\n- Completed/Finished\n- Standby/Idle\n- Paused\n- Cleaning/Auto\n- Returning home\n\nThank you! \ud83d\ude4f\n</code></pre> <ol> <li> <p>Wait for user responses with data</p> </li> <li> <p>Hand off to LLM with collected data + <code>ISSUE_186_FIX_PLAN.md</code></p> </li> </ol>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#for-next-llm","title":"For Next LLM","text":"<ol> <li>Read <code>ISSUE_186_FIX_PLAN.md</code> thoroughly</li> <li>Verify you have user data</li> <li>Follow TDD workflow exactly</li> <li>Test with <code>task test</code></li> <li>Validate with users</li> </ol>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#files-created","title":"Files Created","text":"<ul> <li>\u2705 <code>ISSUE_186_FIX_PLAN.md</code> - Detailed implementation plan</li> <li>\u2705 <code>ISSUE_186_ANALYSIS.md</code> - This summary</li> </ul>"},{"location":"archive/issue186/ISSUE_186_ANALYSIS/#references","title":"References","text":"<ul> <li>Issue: https://github.com/damacus/robovac/issues/186</li> <li>Test Pattern: <code>tests/test_vacuum/test_t2262_command_mappings.py</code></li> <li>Model File: <code>custom_components/robovac/vacuums/T2262.py</code></li> <li>Similar Working Model: <code>custom_components/robovac/vacuums/T2277.py</code></li> </ul> <p>Analysis Date: 2025-10-22 Status: Error confirmed, plan created, awaiting user data</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/","title":"Fix Plan for Issue #186: T2262 Missing STATUS Value Mappings","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#issue-summary","title":"Issue Summary","text":"<p>Title: T2262: Missing command mapping for status value \"Charging\"</p> <p>Problem: T2262 vacuum model has STATUS command defined (code 15) but lacks value mappings. When the device sends status updates like \"Charging\", \"Sleeping\", or \"completed\", they cannot be translated to human-readable values, resulting in debug logs and potentially confusing status displays.</p> <p>Affected Users: Multiple users (SGXander, JBenson74, dxmnkd316) reported this issue.</p> <p>Related Models: T2253 also has the same issue (STATUS code 15, no values defined).</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#current-state-analysis","title":"Current State Analysis","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#what-we-know","title":"What We Know","text":"<ol> <li>T2262 Current Implementation (<code>custom_components/robovac/vacuums/T2262.py</code>):</li> </ol> <pre><code>RobovacCommand.STATUS: {\n    \"code\": 15,\n},\n</code></pre> <ul> <li>Has STATUS command defined</li> <li>Code is 15</li> <li> <p>No <code>values</code> dict defined</p> </li> <li> <p>Missing Status Values (reported by users):</p> </li> <li>\"Charging\"</li> <li>\"Sleeping\"</li> <li>\"completed\"</li> <li> <p>Error value \"0\" (already handled in ERROR command)</p> </li> <li> <p>Similar Working Model (T2277) - Uses different code (153):</p> </li> </ul> <pre><code>RobovacCommand.STATUS: {\n    \"code\": 153,\n    \"values\": {\n        \"Charging\": \"BBADGgA=\",\n        \"Sleeping\": \"AhAB\",\n        \"completed\": \"BhADGgIIAQ==\",\n        \"Standby\": \"AA==\",\n        \"Paused\": \"CAoAEAUyAggB\",\n        # ... bidirectional mappings\n    },\n}\n</code></pre> <ol> <li>Current Behavior:</li> <li>When device sends unmapped status, <code>getRoboVacHumanReadableValue()</code> returns the original value</li> <li>Logs debug message (changed from WARNING in previous fix)</li> <li>Status may display as raw value instead of human-readable string</li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#what-we-dont-know","title":"What We Don't Know","text":"<p>CRITICAL: We lack actual T2262 device data showing:</p> <ul> <li>What exact values the device sends for STATUS code 15</li> <li>Whether values are base64-encoded strings or plain text</li> <li>Bidirectional mapping requirements</li> </ul> <p>Why This Matters: STATUS code 15 (T2262) likely uses different encoding than code 153 (T2277). Cannot safely copy mappings between models.</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#solution-strategy","title":"Solution Strategy","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-1-data-collection-prerequisite","title":"Phase 1: Data Collection (PREREQUISITE)","text":"<p>Objective: Gather actual T2262 device data from users.</p> <p>Action Items:</p> <ol> <li>Contact affected users via GitHub issue #186</li> <li>Request device data collection using Home Assistant debug logs:</li> </ol> <pre><code>logger:\n  default: info\n  logs:\n    custom_components.robovac: debug\n</code></pre> <ol> <li>Data needed for each status:</li> <li>Raw value received from device</li> <li>What Eufy app displayed at that time</li> <li> <p>Example statuses: Charging, Sleeping, Completed, Standby, Paused, Cleaning, etc.</p> </li> <li> <p>Document findings in issue comments before proceeding to implementation.</p> </li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-2-implementation-tdd-approach","title":"Phase 2: Implementation (TDD Approach)","text":"<p>Prerequisites:</p> <ul> <li>\u2705 Phase 1 data collection complete</li> <li>\u2705 Verify at least 5-7 status mappings available</li> <li>\u2705 Confirm with user that test data matches their observations</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-1-write-failing-tests-first","title":"Step 1: Write Failing Tests FIRST","text":"<p>File: <code>tests/test_vacuum/test_t2262_command_mappings.py</code></p> <p>Add comprehensive STATUS value tests:</p> <pre><code>def test_t2262_status_human_readable_values(mock_t2262_robovac) -&gt; None:\n    \"\"\"Test T2262 STATUS command translates device values to human-readable strings.\"\"\"\n    # TODO: Replace with ACTUAL device values from Phase 1\n    # Example structure (DO NOT USE without real data):\n    # assert mock_t2262_robovac.getRoboVacHumanReadableValue(\n    #     RobovacCommand.STATUS, \"DEVICE_VALUE_HERE\"\n    # ) == \"Charging\"\n\n    # Add tests for ALL collected status values:\n    # - Charging\n    # - Sleeping\n    # - Completed\n    # - Standby\n    # - Paused\n    # - Cleaning/Auto\n    # - Returning home\n    # - etc.\n    pass  # Remove after adding real tests\n\n\ndef test_t2262_status_case_insensitive(mock_t2262_robovac) -&gt; None:\n    \"\"\"Test T2262 STATUS values work with case-insensitive lookup.\"\"\"\n    # Test that case variations of device values still match\n    pass  # Implement with real data\n\n\ndef test_t2262_status_bidirectional_mapping(mock_t2262_robovac) -&gt; None:\n    \"\"\"Test T2262 STATUS supports bidirectional lookups if needed.\"\"\"\n    # Only if device uses bidirectional mapping (check T2277 pattern)\n    pass  # Implement if needed\n</code></pre> <p>Run tests to verify they fail:</p> <pre><code>task test\n</code></pre> <p>Expected: New tests fail because T2262.py lacks STATUS values.</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-2-implement-status-values","title":"Step 2: Implement Status Values","text":"<p>File: <code>custom_components/robovac/vacuums/T2262.py</code></p> <p>Update STATUS command with collected data:</p> <pre><code>RobovacCommand.STATUS: {\n    \"code\": 15,\n    \"values\": {\n        # TODO: Add mappings from Phase 1 data collection\n        # Follow this pattern based on actual device data:\n        # \"device_value\": \"HumanReadable\",\n        # \"HumanReadable\": \"device_value\",  # If bidirectional needed\n\n        # EXAMPLE ONLY - Replace with real data:\n        # \"charging\": \"Charging\",\n        # \"Charging\": \"charging\",\n        # \"sleeping\": \"Sleeping\", \n        # \"Sleeping\": \"sleeping\",\n        # \"completed\": \"Completed\",\n        # etc.\n    },\n},\n</code></pre> <p>Important Notes:</p> <ul> <li>Maintain consistency with existing models' capitalization patterns</li> <li>Add bidirectional mappings if device requires reverse lookups</li> <li>Include comments noting source of mappings (user data, firmware version, etc.)</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-3-verify-tests-pass","title":"Step 3: Verify Tests Pass","text":"<pre><code>task test\n</code></pre> <p>Expected: All new STATUS tests pass.</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-4-run-full-test-suite","title":"Step 4: Run Full Test Suite","text":"<pre><code>task test\n</code></pre> <p>Expected: All existing tests still pass (no regressions).</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#step-5-code-quality-checks","title":"Step 5: Code Quality Checks","text":"<pre><code>task lint\ntask type-check\n</code></pre> <p>Expected: No linting or type errors.</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-3-documentation-validation","title":"Phase 3: Documentation &amp; Validation","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#update-documentation","title":"Update Documentation","text":"<ol> <li>Add comment in T2262.py noting data source:</li> </ol> <pre><code>RobovacCommand.STATUS: {\n    \"code\": 15,\n    # Mappings confirmed by users: @SGXander, @dxmnkd316\n    # Firmware version: [if known]\n    # Date verified: 2025-10-22\n    \"values\": {\n        # ...\n    },\n},\n</code></pre> <ol> <li> <p>Update DEVELOPMENT.md if new patterns introduced</p> </li> <li> <p>Add to CODE_COVERAGE_TODO.md if other models need similar fixes</p> </li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#user-validation","title":"User Validation","text":"<ol> <li>Create test branch with changes</li> <li>Share with affected users via GitHub issue</li> <li>Request testing on actual devices</li> <li>Gather feedback before merging</li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#phase-4-related-models-optional","title":"Phase 4: Related Models (Optional)","text":"<p>Check if other models need similar fixes:</p> <p>Models with STATUS code 15 and no values:</p> <ul> <li>T2253 (mentioned in issue comments)</li> <li>T2250, T2251, T2252, T2254, T2255, T2259, T2268, T2270, T2272, T2273</li> </ul> <p>Decision: Fix T2262 first, then evaluate if pattern applies to others.</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#testing-strategy","title":"Testing Strategy","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#test-coverage-requirements","title":"Test Coverage Requirements","text":"<p>All tests must pass before merging:</p> <ol> <li>\u2705 STATUS value translations work</li> <li>\u2705 Case-insensitive lookup works</li> <li>\u2705 Bidirectional mapping works (if applicable)</li> <li>\u2705 Unknown values return as-is (existing behavior)</li> <li>\u2705 No regressions in other commands</li> <li>\u2705 Full test suite passes</li> <li>\u2705 Linting passes</li> <li>\u2705 Type checking passes</li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#manual-testing-checklist","title":"Manual Testing Checklist","text":"<p>Before marking issue as resolved:</p> <ul> <li>[ ] User confirms status displays correctly in Home Assistant</li> <li>[ ] \"Charging\" shows as \"Charging\" (not raw value)</li> <li>[ ] \"Sleeping\" shows correctly</li> <li>[ ] \"Completed\" shows correctly</li> <li>[ ] No debug logs for mapped values</li> <li>[ ] Device commands still work</li> <li>[ ] State transitions work correctly</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#implementation-notes-for-llm","title":"Implementation Notes for LLM","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#do-not-proceed-without-data","title":"DO NOT Proceed Without Data","text":"<p>STOP if:</p> <ul> <li>Phase 1 data collection incomplete</li> <li>User data not available</li> <li>Uncertain about mappings</li> </ul> <p>ASK for:</p> <ul> <li>Actual device logs</li> <li>User confirmation</li> <li>Additional test cases</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#tdd-discipline","title":"TDD Discipline","text":"<p>ALWAYS:</p> <ol> <li>Write test first</li> <li>Verify it fails</li> <li>Implement feature</li> <li>Verify test passes</li> <li>Run full suite</li> <li>Refactor if needed</li> </ol> <p>NEVER:</p> <ul> <li>Skip tests</li> <li>Implement without failing test</li> <li>Guess at device values</li> <li>Copy mappings from different model codes</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#code-standards","title":"Code Standards","text":"<p>Follow existing patterns:</p> <ul> <li>Use lowercase snake_case for keys (e.g., \"charging\")</li> <li>Use PascalCase for values (e.g., \"Charging\")</li> <li>Maintain bidirectional mappings if model requires it</li> <li>Add type hints</li> <li>Include docstrings for new functions</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#git-workflow","title":"Git Workflow","text":"<p>Conventional Commits:</p> <pre><code># After Phase 1\ngit checkout -b fix/issue-186-t2262-status-mappings\n\n# After implementation\ngit add tests/test_vacuum/test_t2262_command_mappings.py\ngit commit -m \"test: add T2262 STATUS value mapping tests\"\n\ngit add custom_components/robovac/vacuums/T2262.py\ngit commit -m \"fix(T2262): add STATUS command value mappings\n\n- Add Charging, Sleeping, completed status values\n- Fixes #186\n- Confirmed with users @SGXander @dxmnkd316\"\n\n# After validation\ngit push origin fix/issue-186-t2262-status-mappings\n</code></pre> <p>PR Description Template:</p> <pre><code>## Fixes #186\n\n### Changes\n- Added STATUS value mappings for T2262 model\n- Added comprehensive test coverage for STATUS values\n\n### Testing\n- \u2705 All tests pass\n- \u2705 Lint/type checks pass\n- \u2705 User validation: @username confirmed working\n\n### Data Source\nStatus mappings provided by users:\n- @SGXander\n- @dxmnkd316\n\n### Notes\n[Any important context about the mappings]\n</code></pre>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#risk-assessment","title":"Risk Assessment","text":""},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#low-risk","title":"Low Risk \u2705","text":"<ul> <li>Adding value mappings to existing command</li> <li>Following established patterns</li> <li>Comprehensive test coverage</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#medium-risk","title":"Medium Risk \u26a0\ufe0f","text":"<ul> <li>Status values might change with firmware updates</li> <li>Users on different firmware versions may see different values</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#mitigation","title":"Mitigation","text":"<ul> <li>Document firmware version in comments</li> <li>Add fallback behavior (return raw value if unmapped)</li> <li>Monitor issue for additional reports</li> </ul>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#success-criteria","title":"Success Criteria","text":"<p>Issue can be closed when:</p> <ol> <li>\u2705 T2262 has STATUS values mapped</li> <li>\u2705 All tests pass</li> <li>\u2705 Users confirm fix works on real devices</li> <li>\u2705 No debug logs for mapped status values</li> <li>\u2705 Documentation updated</li> <li>\u2705 Code merged to main branch</li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#questions-for-user-if-blocked","title":"Questions for User (if blocked)","text":"<p>If you need clarification:</p> <ol> <li>\"Can you enable debug logging and share the exact raw values your T2262 sends for STATUS code 15?\"</li> <li>\"What does the Eufy app show when you see the 'Charging' debug message?\"</li> <li>\"Can you test this branch and confirm the status displays correctly?\"</li> <li>\"What firmware version is your T2262 running?\"</li> </ol>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#estimated-effort","title":"Estimated Effort","text":"<ul> <li>Phase 1 (Data Collection): 2-5 days (waiting on users)</li> <li>Phase 2 (Implementation): 30-60 minutes (with data)</li> <li>Phase 3 (Documentation): 15 minutes</li> <li>Phase 4 (User Validation): 1-3 days</li> </ul> <p>Total: ~3-8 days (mostly waiting for user feedback)</p>"},{"location":"archive/issue186/ISSUE_186_FIX_PLAN/#references","title":"References","text":"<ul> <li>Issue: https://github.com/damacus/robovac/issues/186</li> <li>Related PR (T2277 model): Check for STATUS implementation pattern</li> <li>Test pattern: <code>tests/test_vacuum/test_t2278_command_mappings.py</code></li> <li>Similar fix: T2252 (see previous memory about mapping fixes)</li> </ul> <p>Last Updated: 2025-10-22 Status: Ready for data collection Assigned To: [LLM or developer name]</p>"},{"location":"archive/pr171/","title":"PR #171 Archive","text":"<p>This directory contains working documents from PR #171 - Type Annotations Implementation.</p>"},{"location":"archive/pr171/#files","title":"Files","text":"<ul> <li>IMPLEMENTATION_PLAN_PR171.md - Comprehensive implementation plan and progress tracking</li> <li>PR171_REVIEW_SUMMARY.md - Review summary and analysis</li> <li>QUICK_START_PR171.md - Quick start guide for the PR work</li> </ul>"},{"location":"archive/pr171/#summary","title":"Summary","text":"<p>PR #171 successfully added comprehensive type annotations to the entire test suite:</p> <ul> <li>Added type annotations to 27+ test files</li> <li>Fixed 178+ mypy errors</li> <li>All 191 tests passing</li> <li>Zero mypy errors in custom_components/ and tests/</li> <li>Follows strict type checking requirements</li> </ul>"},{"location":"archive/pr171/#date-completed","title":"Date Completed","text":"<p>October 22, 2025</p>"},{"location":"archive/pr171/#related-issues","title":"Related Issues","text":"<ul> <li>Issue #171: Add type annotations to test suite</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/","title":"Implementation Plan: PR #171 - Battery Deprecation &amp; Model Validation","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#pr-review-summary","title":"PR Review Summary","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#changes-from-pr-171","title":"Changes from PR #171","text":"<ol> <li>Battery Deprecation Fixes (HA 2026.8 compatibility)</li> <li>Remove <code>VacuumEntityFeature.BATTERY</code> from 35+ vacuum models</li> <li>Remove deprecated <code>_attr_battery_level</code> from vacuum.py entity</li> <li> <p>Maintain existing battery sensor functionality (no breaking changes)</p> </li> <li> <p>Error Handling Improvements</p> </li> <li>Fix typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\"</li> <li>Add <code>getErrorMessageWithContext()</code> function with actionable troubleshooting</li> <li> <p>Enhanced error messages with user guidance</p> </li> <li> <p>Model Validation Tools</p> </li> <li><code>model_validator.py</code>: Library module with series detection (C, G, L, X series)</li> <li><code>model_validator_cli.py</code>: Standalone CLI tool for users</li> <li>Automatic unsupported model suggestions</li> <li>Series-specific troubleshooting guides</li> </ol>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#code-review-findings","title":"Code Review Findings","text":"<p>Style Issues:</p> <ul> <li>Generally clean, follows Python conventions</li> <li>Some flake8 violations were fixed in PR (whitespace, line breaks)</li> <li>Type hints need to be added for new functions</li> </ul> <p>Conciseness:</p> <ul> <li>Model validator has good abstraction with series detection</li> <li>Error context function could be more modular</li> <li>CLI tool has appropriate separation from library</li> </ul> <p>Readability:</p> <ul> <li>Clear function names and structure</li> <li>Some functions are long and could benefit from decomposition</li> <li>Documentation is comprehensive</li> </ul> <p>Maintainability:</p> <ul> <li>Series detection makes adding new models easier</li> <li>Model list is centralized (good)</li> <li>CLI tool has fallback for standalone usage (good)</li> <li>Tests needed for all new functionality</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#implementation-plan","title":"Implementation Plan","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-1-battery-deprecation-test-first","title":"Phase 1: Battery Deprecation (Test-First)","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-11-write-failing-tests-for-battery-feature-removal","title":"Step 1.1: Write Failing Tests for Battery Feature Removal","text":"<p>Task: Create test file for battery feature validation</p> <p>File: <code>tests/test_vacuum/test_battery_feature_removal.py</code></p> <p>Test Cases:</p> <pre><code># Test 1: Verify VacuumEntityFeature.BATTERY is NOT in homeassistant_features for all models\n# Test 2: Verify battery command mappings still exist (backward compatibility)\n# Test 3: Verify battery level property is removed from vacuum entity\n# Test 4: Verify battery sensor still works independently\n</code></pre> <p>Implementation Details:</p> <ul> <li>Import all vacuum models from <code>custom_components/robovac/vacuums</code></li> <li>Iterate through all T* models</li> <li>Assert <code>VacuumEntityFeature.BATTERY</code> not in <code>homeassistant_features</code></li> <li>Assert <code>RobovacCommand.BATTERY</code> still exists in commands</li> <li>Verify vacuum entity does not have <code>_attr_battery_level</code> attribute</li> </ul> <p>Run tests (should fail):</p> <pre><code>task test tests/test_vacuum/test_battery_feature_removal.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-12-remove-battery-feature-from-vacuum-models","title":"Step 1.2: Remove Battery Feature from Vacuum Models","text":"<p>Task: Remove <code>VacuumEntityFeature.BATTERY</code> from all 35 vacuum model files</p> <p>Files to modify: All vacuum models in <code>custom_components/robovac/vacuums/T2*.py</code></p> <p>Pattern to apply:</p> <pre><code># BEFORE:\nhomeassistant_features = (\n    VacuumEntityFeature.BATTERY\n    | VacuumEntityFeature.FAN_SPEED\n    | ...\n)\n\n# AFTER:\nhomeassistant_features = (\n    VacuumEntityFeature.FAN_SPEED\n    | ...\n)\n</code></pre> <p>Models to update: (35 files)</p> <ul> <li>T2080, T2103, T2117, T2118, T2119, T2120, T2123, T2128, T2130, T2132</li> <li>T2150, T2181, T2190, T2192, T2193, T2194, T2250, T2251, T2252, T2253</li> <li>T2254, T2255, T2259, T2261, T2262, T2267, T2268, T2270, T2272, T2273</li> <li>T2275, T2276, T2277, T2278, T2320</li> </ul> <p>Implementation:</p> <ul> <li>Use multi_edit tool for batch updates</li> <li>Preserve all other features and command mappings</li> <li>Maintain code formatting and structure</li> </ul> <p>Run tests (should pass):</p> <pre><code>task test tests/test_vacuum/test_battery_feature_removal.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-13-remove-_attr_battery_level-from-vacuumentity","title":"Step 1.3: Remove _attr_battery_level from VacuumEntity","text":"<p>Task: Remove deprecated battery level attribute from vacuum.py</p> <p>File: <code>custom_components/robovac/vacuum.py</code></p> <p>Search for:</p> <ul> <li><code>_attr_battery_level</code> declarations</li> <li><code>battery_level</code> property</li> <li>Any references to battery level in entity</li> </ul> <p>Modification:</p> <ul> <li>Remove attribute declaration (if exists)</li> <li>Remove property (if exists)</li> <li>Ensure battery sensor component handles battery reporting independently</li> </ul> <p>Validation:</p> <ul> <li>Check that battery sensor in sensor.py is unaffected</li> <li>Run full test suite</li> <li>Verify no regressions</li> </ul> <p>Run tests:</p> <pre><code>task test\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-14-commit-changes","title":"Step 1.4: Commit Changes","text":"<p>Commit message:</p> <pre><code>fix: remove deprecated battery feature from vacuum models\n\nRemove VacuumEntityFeature.BATTERY from all 35 vacuum models\nto prepare for Home Assistant 2026.8 compatibility.\n\n- Remove battery feature flag from homeassistant_features\n- Maintain battery command mappings for backward compatibility\n- Battery reporting continues via dedicated battery sensor\n- No breaking changes for existing users\n\nRefs: #171\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-2-error-message-improvements-test-first","title":"Phase 2: Error Message Improvements (Test-First)","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-21-write-failing-tests-for-error-messages","title":"Step 2.1: Write Failing Tests for Error Messages","text":"<p>Task: Create test file for error message enhancements</p> <p>File: <code>tests/test_errors.py</code></p> <p>Test Cases:</p> <pre><code># Test 1: Verify typo fix - \"Laser sensor stuck\" not \"Laser sesor stuck\"\n# Test 2: Test getErrorMessage() returns correct messages\n# Test 3: Test getErrorMessageWithContext() returns message + context\n# Test 4: Test context includes troubleshooting steps\n# Test 5: Test context includes series-specific guidance\n# Test 6: Test unknown error codes return gracefully\n</code></pre> <p>Implementation Details:</p> <ul> <li>Test error code 19 returns \"Laser sensor stuck\"</li> <li>Test getErrorMessageWithContext(19) returns dict with 'message', 'troubleshooting', 'common_causes'</li> <li>Test contextual information is helpful and actionable</li> <li>Test function handles None, str, and int error codes</li> </ul> <p>Run tests (should fail):</p> <pre><code>task test tests/test_errors.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-22-fix-typo-in-error_messages","title":"Step 2.2: Fix Typo in ERROR_MESSAGES","text":"<p>Task: Fix \"sesor\" \u2192 \"sensor\" typo</p> <p>File: <code>custom_components/robovac/errors.py</code></p> <p>Change:</p> <pre><code># Line 20\n# BEFORE:\n19: \"Laser sesor stuck\",\n\n# AFTER:\n19: \"Laser sensor stuck\",\n</code></pre> <p>Run tests (should pass typo test):</p> <pre><code>task test tests/test_errors.py::test_laser_sensor_typo_fixed\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-23-implement-geterrormessagewithcontext","title":"Step 2.3: Implement getErrorMessageWithContext()","text":"<p>Task: Add enhanced error messaging function</p> <p>File: <code>custom_components/robovac/errors.py</code></p> <p>Function signature:</p> <pre><code>def getErrorMessageWithContext(\n    code: str | int,\n    model_code: str | None = None\n) -&gt; dict[str, str | list[str]]:\n    \"\"\"Get error message with troubleshooting context.\n\n    Args:\n        code: The error code to look up\n        model_code: Optional model code for model-specific guidance\n\n    Returns:\n        Dictionary containing:\n        - message: The error message\n        - troubleshooting: List of troubleshooting steps\n        - common_causes: List of common causes\n        - series_info: Model series-specific information (if applicable)\n    \"\"\"\n</code></pre> <p>Implementation Details:</p> <ul> <li>Build on existing ERROR_MESSAGES dict</li> <li>Add TROUBLESHOOTING_CONTEXT dict with error-specific guidance</li> <li>Detect model series (C, G, L, X) from model_code if provided</li> <li>Return structured dict with actionable information</li> <li>Handle missing/unknown codes gracefully</li> </ul> <p>Error context examples:</p> <pre><code>TROUBLESHOOTING_CONTEXT = {\n    1: {  # Front bumper stuck\n        \"troubleshooting\": [\n            \"Check front bumper for obstructions\",\n            \"Clean bumper sensors\",\n            \"Ensure bumper moves freely\"\n        ],\n        \"common_causes\": [\n            \"Hair or debris blocking bumper\",\n            \"Damaged bumper spring\",\n            \"Sensor misalignment\"\n        ]\n    },\n    19: {  # Laser sensor stuck\n        \"troubleshooting\": [\n            \"Remove any stickers or tape from laser sensor\",\n            \"Clean laser sensor cover\",\n            \"Check for physical damage to sensor\",\n            \"Restart vacuum\"\n        ],\n        \"common_causes\": [\n            \"Protective film not removed\",\n            \"Dust or debris on sensor\",\n            \"Physical damage to sensor cover\"\n        ]\n    },\n    # ... add for other common errors\n}\n</code></pre> <p>Run tests (should pass):</p> <pre><code>task test tests/test_errors.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-24-add-type-hints-and-documentation","title":"Step 2.4: Add Type Hints and Documentation","text":"<p>Task: Ensure all error functions have proper typing</p> <p>Files:</p> <ul> <li><code>custom_components/robovac/errors.py</code></li> </ul> <p>Requirements:</p> <ul> <li>Add type hints to all functions</li> <li>Add comprehensive docstrings (Google style)</li> <li>Document return types clearly</li> <li>Add examples in docstrings</li> </ul> <p>Run type check:</p> <pre><code>task type-check\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-25-commit-changes","title":"Step 2.5: Commit Changes","text":"<p>Commit message:</p> <pre><code>feat: enhance error messages with troubleshooting context\n\nAdd getErrorMessageWithContext() function to provide users with\nactionable troubleshooting steps and common causes for error codes.\n\n- Fix typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\"\n- Add TROUBLESHOOTING_CONTEXT with detailed guidance\n- Support model series-specific troubleshooting\n- Maintain backward compatibility with getErrorMessage()\n\nRefs: #171\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-3-model-validator-library-test-first","title":"Phase 3: Model Validator Library (Test-First)","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-31-write-failing-tests-for-model-validator","title":"Step 3.1: Write Failing Tests for Model Validator","text":"<p>Task: Create comprehensive test file for model validator</p> <p>File: <code>tests/test_model_validator.py</code></p> <p>Test Cases:</p> <pre><code># Series Detection Tests\n# Test 1: Detect C series (RoboVac C models)\n# Test 2: Detect G series (RoboVac G series)\n# Test 3: Detect L series (Clean L series)\n# Test 4: Detect X series (RoboVac X series)\n# Test 5: Handle unknown series\n# Test 6: Handle None/invalid model codes\n\n# Model Validation Tests\n# Test 7: Validate supported models return True\n# Test 8: Validate unsupported models return False\n# Test 9: Get model list\n# Test 10: Get supported model for device code (T2278 \u2192 T2278)\n\n# Suggestion Tests\n# Test 11: Suggest similar models for unsupported model\n# Test 12: Suggest series alternatives\n# Test 13: Handle edge cases (empty suggestions)\n\n# Troubleshooting Tests\n# Test 14: Get series-specific troubleshooting guide\n# Test 15: Get general troubleshooting guide\n# Test 16: Validate troubleshooting content is helpful\n</code></pre> <p>Implementation Details:</p> <ul> <li>Test all public functions</li> <li>Test edge cases and error handling</li> <li>Mock ROBOVAC_MODELS import</li> <li>Verify series detection logic</li> <li>Validate suggestion algorithm</li> </ul> <p>Run tests (should fail):</p> <pre><code>task test tests/test_model_validator.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-32-create-model-validator-module","title":"Step 3.2: Create Model Validator Module","text":"<p>Task: Implement model validator library</p> <p>File: <code>custom_components/robovac/model_validator.py</code></p> <p>Module structure:</p> <pre><code>\"\"\"Model validation and series detection for RoboVac devices.\n\nThis module provides utilities for validating RoboVac model codes,\ndetecting model series (C, G, L, X), and providing troubleshooting\nguidance for unsupported models.\n\"\"\"\n\nfrom typing import Dict, List, Optional, Tuple\nimport re\n\n# Series detection patterns\nSERIES_PATTERNS = {\n    'C': r'^T2(103|123)$',  # RoboVac C series\n    'G': r'^T2(150|261)$',  # RoboVac G series\n    'L': r'^T2(2[67][0-9]|278|320)$',  # Clean L series\n    'X': r'^T2(080|117|118|119|120|128|130|132|181|190|192|193|194|25[0-9]|262)$',  # RoboVac X series\n}\n\ndef detect_series(model_code: str) -&gt; Optional[str]:\n    \"\"\"Detect the series of a RoboVac model.\"\"\"\n\ndef is_supported_model(model_code: str) -&gt; bool:\n    \"\"\"Check if a model code is supported.\"\"\"\n\ndef get_supported_models() -&gt; List[str]:\n    \"\"\"Get list of all supported model codes.\"\"\"\n\ndef suggest_similar_models(model_code: str, max_suggestions: int = 5) -&gt; List[Tuple[str, str]]:\n    \"\"\"Suggest similar supported models for an unsupported model.\"\"\"\n\ndef get_troubleshooting_guide(model_code: str) -&gt; Dict[str, str | List[str]]:\n    \"\"\"Get series-specific troubleshooting guide.\"\"\"\n</code></pre> <p>Implementation Requirements:</p> <ul> <li>Import ROBOVAC_MODELS from vacuums.init</li> <li>Use regex for series detection</li> <li>Implement similarity algorithm for suggestions</li> <li>Provide comprehensive troubleshooting guides per series</li> <li>Handle import failures gracefully (for standalone usage)</li> <li>Add full type hints</li> <li>Add comprehensive docstrings</li> </ul> <p>Run tests (should pass):</p> <pre><code>task test tests/test_model_validator.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-33-add-type-hints-and-linting","title":"Step 3.3: Add Type Hints and Linting","text":"<p>Task: Ensure code quality standards</p> <p>Files:</p> <ul> <li><code>custom_components/robovac/model_validator.py</code></li> </ul> <p>Requirements:</p> <ul> <li>Run task lint</li> <li>Run task type-check</li> <li>Fix any violations</li> <li>Ensure all functions have type hints</li> <li>Ensure all functions have docstrings</li> </ul> <p>Run quality checks:</p> <pre><code>task lint\ntask type-check\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-34-commit-changes","title":"Step 3.4: Commit Changes","text":"<p>Commit message:</p> <pre><code>feat: add model validator library with series detection\n\nAdd model_validator.py module to provide:\n- Automatic model series identification (C, G, L, X)\n- Model validation against supported models\n- Smart suggestions for unsupported models\n- Series-specific troubleshooting guides\n\nRefs: #171\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-4-model-validator-cli-tool-test-first","title":"Phase 4: Model Validator CLI Tool (Test-First)","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-41-write-tests-for-cli-tool","title":"Step 4.1: Write Tests for CLI Tool","text":"<p>Task: Create test file for CLI functionality</p> <p>File: <code>tests/test_model_validator_cli.py</code></p> <p>Test Cases:</p> <pre><code># Argument Parsing Tests\n# Test 1: Parse model code argument\n# Test 2: Parse --list flag\n# Test 3: Parse --help flag\n# Test 4: Handle missing arguments\n\n# Output Tests\n# Test 5: Supported model shows success message\n# Test 6: Unsupported model shows suggestions\n# Test 7: List mode shows all models\n# Test 8: Output format is user-friendly\n\n# Integration Tests\n# Test 9: Standalone mode works without imports\n# Test 10: Integrated mode uses actual ROBOVAC_MODELS\n</code></pre> <p>Implementation Details:</p> <ul> <li>Use unittest.mock for subprocess testing</li> <li>Mock sys.argv for argument testing</li> <li>Capture stdout/stderr</li> <li>Test CLI exit codes (0 = success, 1 = error)</li> </ul> <p>Run tests (should fail):</p> <pre><code>task test tests/test_model_validator_cli.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-42-create-cli-tool","title":"Step 4.2: Create CLI Tool","text":"<p>Task: Implement standalone CLI tool</p> <p>File: <code>custom_components/robovac/model_validator_cli.py</code></p> <p>Module structure:</p> <pre><code>#!/usr/bin/env python3\n\"\"\"Standalone CLI tool for RoboVac model validation.\n\nThis tool can be used independently to validate RoboVac model compatibility\nand get suggestions for unsupported models.\n\nUsage:\n    python model_validator_cli.py T2278\n    python model_validator_cli.py --list\n\"\"\"\n\nimport argparse\nimport sys\nfrom typing import Optional\n\ntry:\n    from .model_validator import (\n        is_supported_model,\n        get_supported_models,\n        suggest_similar_models,\n        get_troubleshooting_guide,\n        detect_series\n    )\n    STANDALONE = False\nexcept ImportError:\n    # Fallback for standalone usage\n    STANDALONE = True\n    # Minimal implementation with hardcoded model list\n\ndef main():\n    \"\"\"Main CLI entry point.\"\"\"\n    parser = argparse.ArgumentParser(\n        description=\"Validate RoboVac model compatibility\"\n    )\n    parser.add_argument(\n        \"model\",\n        nargs=\"?\",\n        help=\"Model code to validate (e.g., T2278)\"\n    )\n    parser.add_argument(\n        \"--list\",\n        action=\"store_true\",\n        help=\"List all supported models\"\n    )\n    args = parser.parse_args()\n\n    # Implementation\n\nif __name__ == \"__main__\":\n    sys.exit(main())\n</code></pre> <p>Implementation Requirements:</p> <ul> <li>Use argparse for CLI arguments</li> <li>Provide clean, user-friendly output</li> <li>Use colors if terminal supports (optional)</li> <li>Handle errors gracefully</li> <li>Support standalone mode (fallback if module import fails)</li> <li>Make executable with shebang</li> <li>Exit with appropriate codes (0 = success, 1 = error, 2 = validation failure)</li> </ul> <p>Run tests (should pass):</p> <pre><code>task test tests/test_model_validator_cli.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-43-add-documentation-and-make-executable","title":"Step 4.3: Add Documentation and Make Executable","text":"<p>Task: Finalize CLI tool</p> <p>Files:</p> <ul> <li><code>custom_components/robovac/model_validator_cli.py</code></li> <li><code>README.md</code> (add usage documentation)</li> </ul> <p>Requirements:</p> <ul> <li>Add comprehensive --help text</li> <li>Add usage examples in docstring</li> <li>Update README.md with CLI tool section</li> <li>Test manually: <code>python custom_components/robovac/model_validator_cli.py T2278</code></li> </ul> <p>Run lint:</p> <pre><code>task lint\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-44-commit-changes","title":"Step 4.4: Commit Changes","text":"<p>Commit message:</p> <pre><code>feat: add standalone CLI tool for model validation\n\nAdd model_validator_cli.py tool for users to validate\nRoboVac model compatibility before setting up integration.\n\n- Supports standalone usage without integration installed\n- Shows model validation status\n- Suggests similar models for unsupported devices\n- Lists all supported models with --list flag\n- Provides troubleshooting guidance\n\nUsage: python model_validator_cli.py T2278\n\nRefs: #171\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-5-integration-and-documentation","title":"Phase 5: Integration and Documentation","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-51-integration-tests","title":"Step 5.1: Integration Tests","text":"<p>Task: Create end-to-end integration tests</p> <p>File: <code>tests/test_integration_pr171.py</code></p> <p>Test Cases:</p> <pre><code># Test 1: Vacuum entity initializes without battery feature\n# Test 2: Battery sensor still reports battery level\n# Test 3: Error messages include context when displayed\n# Test 4: Model validator works with actual vacuum models\n# Test 5: CLI tool works with integration\n</code></pre> <p>Run tests:</p> <pre><code>task test tests/test_integration_pr171.py\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-52-update-documentation","title":"Step 5.2: Update Documentation","text":"<p>Task: Update project documentation</p> <p>Files to update:</p> <ul> <li><code>README.md</code>: Add model validator CLI usage</li> <li><code>DEVELOPMENT.md</code>: Document error context system</li> <li><code>CHANGELOG.md</code>: Add entry for this feature set</li> </ul> <p>README.md additions:</p> <pre><code>## Model Validation\n\nBefore setting up the integration, you can validate if your RoboVac model is supported:\n\n```bash\npython custom_components/robovac/model_validator_cli.py T2278\n</code></pre> <p>To see all supported models:</p> <pre><code>python custom_components/robovac/model_validator_cli.py --list\n</code></pre> <p>Run markdown lint:</p> <pre><code>npx markdownlint-cli2 \"**/*.md\"\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-53-full-test-suite","title":"Step 5.3: Full Test Suite","text":"<p>Task: Run complete test suite</p> <p>Commands:</p> <pre><code>task lint\ntask type-check\ntask test\n</code></pre> <p>Validation:</p> <ul> <li>All tests pass</li> <li>No linting errors</li> <li>No type checking errors</li> <li>No markdown lint errors</li> <li>Test coverage maintained or improved</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-54-final-commit","title":"Step 5.4: Final Commit","text":"<p>Commit message:</p> <pre><code>docs: update documentation for PR #171 features\n\nAdd documentation for:\n- Model validator CLI tool usage\n- Error message improvements\n- Battery deprecation changes\n- Integration guide updates\n\nRefs: #171\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#phase-6-review-and-cleanup","title":"Phase 6: Review and Cleanup","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-61-code-review-checklist","title":"Step 6.1: Code Review Checklist","text":"<ul> <li>[ ] All tests pass</li> <li>[ ] Type hints on all new functions</li> <li>[ ] Docstrings follow Google style</li> <li>[ ] No flake8 violations</li> <li>[ ] No markdown lint errors</li> <li>[ ] Follows existing code patterns</li> <li>[ ] No code duplication</li> <li>[ ] Error handling comprehensive</li> <li>[ ] Backward compatibility maintained</li> <li>[ ] No breaking changes</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-62-create-summary-document","title":"Step 6.2: Create Summary Document","text":"<p>Task: Create summary of changes for review</p> <p>File: <code>IMPLEMENTATION_SUMMARY_PR171.md</code></p> <p>Contents:</p> <ul> <li>List of all files modified/created</li> <li>Test coverage report</li> <li>Key design decisions</li> <li>Migration guide (if needed)</li> <li>Known limitations</li> <li>Future improvements</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#step-63-final-validation","title":"Step 6.3: Final Validation","text":"<p>Task: Run full validation suite</p> <pre><code># Run all tests\ntask test\n\n# Check code quality\ntask lint\ntask type-check\n\n# Verify documentation\nnpx markdownlint-cli2 \"**/*.md\"\n\n# Manual testing\npython custom_components/robovac/model_validator_cli.py T2278\npython custom_components/robovac/model_validator_cli.py T9999\npython custom_components/robovac/model_validator_cli.py --list\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#execution-notes-for-llm","title":"Execution Notes for LLM","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#tdd-workflow","title":"TDD Workflow","text":"<ol> <li>Always write tests first - Tests define expected behavior</li> <li>Run tests (should fail) - Confirms tests are actually testing something</li> <li>Implement minimal code - Just enough to pass tests</li> <li>Run tests (should pass) - Confirms implementation works</li> <li>Refactor if needed - Improve code while keeping tests green</li> <li>Commit - Small, focused commits with conventional commit messages</li> </ol>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#code-quality-standards","title":"Code Quality Standards","text":"<ul> <li>Type hints: Required on all function parameters and returns</li> <li>Docstrings: Google style, required on all public functions</li> <li>Linting: Run <code>task lint</code> before committing</li> <li>Type checking: Run <code>task type-check</code> before committing</li> <li>Testing: Run <code>task test</code> after each phase</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#testing-commands","title":"Testing Commands","text":"<pre><code># Run specific test file\ntask test tests/test_model_validator.py\n\n# Run specific test function\ntask test tests/test_model_validator.py::test_detect_c_series\n\n# Run all tests\ntask test\n\n# Run with coverage\n```bash\ntask test --cov\n</code></pre>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#commit-message-format","title":"Commit Message Format","text":"<pre><code>&lt;type&gt;: &lt;description&gt;\n\n&lt;body&gt;\n\nRefs: #171\n</code></pre> <p>Types: <code>feat</code>, <code>fix</code>, <code>refactor</code>, <code>test</code>, <code>docs</code>, <code>chore</code></p>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#file-modification-strategy","title":"File Modification Strategy","text":"<ol> <li>Read file first to understand structure</li> <li>Make minimal changes</li> <li>Preserve existing formatting</li> <li>Use multi_edit for batch updates</li> <li>Run tests after each file modification</li> </ol>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#error-handling","title":"Error Handling","text":"<ul> <li>Always handle None/null cases</li> <li>Provide meaningful error messages</li> <li>Don't crash on unexpected input</li> <li>Log errors appropriately (DEBUG level for expected errors)</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#dependencies","title":"Dependencies","text":"<ul> <li>Don't add new external dependencies without explicit approval</li> <li>Use stdlib where possible</li> <li>Leverage existing project utilities</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#success-criteria","title":"Success Criteria","text":""},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#must-have","title":"Must Have","text":"<ul> <li>[ ] All 35 vacuum models have battery feature removed</li> <li>[ ] Error message typo fixed</li> <li>[ ] getErrorMessageWithContext() implemented and tested</li> <li>[ ] model_validator.py implemented and tested</li> <li>[ ] model_validator_cli.py implemented and tested</li> <li>[ ] All tests pass</li> <li>[ ] No linting errors</li> <li>[ ] No type checking errors</li> <li>[ ] Documentation updated</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#should-have","title":"Should Have","text":"<ul> <li>[ ] Integration tests pass</li> <li>[ ] Test coverage \u2265 90% for new code</li> <li>[ ] CLI tool tested manually</li> <li>[ ] README examples work</li> <li>[ ] Backward compatibility verified</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#nice-to-have","title":"Nice to Have","text":"<ul> <li>[ ] Performance benchmarks</li> <li>[ ] User testimonials</li> <li>[ ] Video demo of CLI tool</li> <li>[ ] Blog post about features</li> </ul>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#timeline-estimate","title":"Timeline Estimate","text":"<ul> <li>Phase 1: Battery Deprecation - 2-3 hours</li> <li>Phase 2: Error Messages - 2-3 hours</li> <li>Phase 3: Model Validator Library - 3-4 hours</li> <li>Phase 4: CLI Tool - 2-3 hours</li> <li>Phase 5: Integration &amp; Docs - 2-3 hours</li> <li>Phase 6: Review &amp; Cleanup - 1-2 hours</li> </ul> <p>Total: 12-18 hours of focused development</p>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#questionsclarifications-needed","title":"Questions/Clarifications Needed","text":"<ol> <li>Should model_validator.py be exposed as a public API?</li> <li>Should CLI tool be installed system-wide or just in project?</li> <li>Any specific Home Assistant version requirements?</li> <li>Should we add warnings for deprecated battery feature in logs?</li> <li>Performance requirements for model suggestion algorithm?</li> </ol>"},{"location":"archive/pr171/IMPLEMENTATION_PLAN_PR171/#references","title":"References","text":"<ul> <li>PR #171: https://github.com/damacus/robovac/pull/171</li> <li>Home Assistant 2026.8 Deprecations</li> <li>Project coding standards: <code>.windsurf/rules/</code></li> <li>Test patterns: <code>tests/test_vacuum/test_t2278_command_mappings.py</code></li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/","title":"PR #171 Review Summary","text":"<p>PR Link: https://github.com/damacus/robovac/pull/171</p> <p>PR Title: Enhance user experience: battery deprecation fixes and model validation tools</p> <p>Status: Open, awaiting merge</p>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#review-conducted","title":"Review Conducted","text":"<p>Reviewed PR #171 against the project's code style guidelines:</p> <ul> <li>\u2705 Conciseness: Good abstraction with series detection patterns</li> <li>\u2705 Readability: Clear function names and comprehensive documentation</li> <li>\u2705 Maintainability: Centralized model list, good separation of concerns</li> <li>\u26a0\ufe0f Style: Some flake8 violations were fixed in PR (addressed)</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#key-changes-in-pr-171","title":"Key Changes in PR #171","text":""},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#1-battery-deprecation-ha-20268-compatibility","title":"1. Battery Deprecation (HA 2026.8 Compatibility)","text":"<ul> <li>Removes <code>VacuumEntityFeature.BATTERY</code> from 35+ vacuum models</li> <li>Removes <code>_attr_battery_level</code> from vacuum entity</li> <li>Impact: Prepares for Home Assistant 2026.8 deprecation</li> <li>Backward Compatibility: Battery sensor continues to work independently</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#2-error-message-improvements","title":"2. Error Message Improvements","text":"<ul> <li>Fixes typo: \"Laser sesor stuck\" \u2192 \"Laser sensor stuck\"</li> <li>Adds <code>getErrorMessageWithContext()</code> function with troubleshooting guidance</li> <li>Provides actionable error context for users</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#3-model-validation-tools","title":"3. Model Validation Tools","text":"<ul> <li>model_validator.py: Library module for model validation</li> <li>Series detection (C, G, L, X)</li> <li>Model similarity suggestions</li> <li>Series-specific troubleshooting</li> <li>model_validator_cli.py: Standalone CLI tool</li> <li>Validate model compatibility</li> <li>List supported models</li> <li>Get suggestions for unsupported models</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#implementation-plan-created","title":"Implementation Plan Created","text":"<p>A comprehensive, multi-phased implementation plan has been created:</p> <p>File: <code>IMPLEMENTATION_PLAN_PR171.md</code></p>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#plan-structure","title":"Plan Structure","text":""},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-1-battery-deprecation-test-first","title":"Phase 1: Battery Deprecation (Test-First)","text":"<ul> <li>Write failing tests for battery feature removal</li> <li>Remove battery feature from 35 vacuum models</li> <li>Remove <code>_attr_battery_level</code> from vacuum entity</li> <li>Verify battery sensor still works</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-2-error-message-improvements-test-first","title":"Phase 2: Error Message Improvements (Test-First)","text":"<ul> <li>Write tests for error message enhancements</li> <li>Fix typo in error messages</li> <li>Implement <code>getErrorMessageWithContext()</code> function</li> <li>Add troubleshooting context dictionary</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-3-model-validator-library-test-first","title":"Phase 3: Model Validator Library (Test-First)","text":"<ul> <li>Write comprehensive tests for model validator</li> <li>Create <code>model_validator.py</code> module</li> <li>Implement series detection</li> <li>Add model suggestion algorithm</li> <li>Provide troubleshooting guides</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-4-model-validator-cli-tool-test-first","title":"Phase 4: Model Validator CLI Tool (Test-First)","text":"<ul> <li>Write tests for CLI functionality</li> <li>Create <code>model_validator_cli.py</code> tool</li> <li>Support standalone usage</li> <li>Add user-friendly output</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-5-integration-and-documentation","title":"Phase 5: Integration and Documentation","text":"<ul> <li>Create end-to-end integration tests</li> <li>Update README, DEVELOPMENT.md, CHANGELOG.md</li> <li>Run full test suite</li> <li>Validate all quality checks pass</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#phase-6-review-and-cleanup","title":"Phase 6: Review and Cleanup","text":"<ul> <li>Complete code review checklist</li> <li>Create implementation summary</li> <li>Final validation</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#key-design-decisions","title":"Key Design Decisions","text":""},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#tdd-approach","title":"TDD Approach","text":"<p>All phases follow strict Test-Driven Development:</p> <ol> <li>Write failing tests first</li> <li>Implement minimal code to pass</li> <li>Refactor while keeping tests green</li> <li>Commit small, focused changes</li> </ol>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#code-quality-standards","title":"Code Quality Standards","text":"<ul> <li>Type hints: Required on all functions</li> <li>Docstrings: Google style for all public functions</li> <li>Linting: Must pass <code>task lint</code></li> <li>Type checking: Must pass <code>task type-check</code></li> <li>Testing: Must pass <code>task test</code></li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#backward-compatibility","title":"Backward Compatibility","text":"<ul> <li>No breaking changes for existing users</li> <li>Battery sensor continues to work via separate sensor component</li> <li>Error message function maintains existing interface</li> <li>Model validator gracefully handles import failures</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#success-criteria","title":"Success Criteria","text":""},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#must-have","title":"Must Have","text":"<ul> <li>[ ] All 35 vacuum models have battery feature removed</li> <li>[ ] Error message typo fixed</li> <li>[ ] <code>getErrorMessageWithContext()</code> implemented and tested</li> <li>[ ] <code>model_validator.py</code> implemented and tested</li> <li>[ ] <code>model_validator_cli.py</code> implemented and tested</li> <li>[ ] All tests pass</li> <li>[ ] No linting errors</li> <li>[ ] No type checking errors</li> <li>[ ] Documentation updated</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#should-have","title":"Should Have","text":"<ul> <li>[ ] Integration tests pass</li> <li>[ ] Test coverage \u2265 90% for new code</li> <li>[ ] CLI tool tested manually</li> <li>[ ] README examples work</li> <li>[ ] Backward compatibility verified</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#timeline-estimate","title":"Timeline Estimate","text":"<ul> <li>Phase 1: Battery Deprecation - 2-3 hours</li> <li>Phase 2: Error Messages - 2-3 hours</li> <li>Phase 3: Model Validator Library - 3-4 hours</li> <li>Phase 4: CLI Tool - 2-3 hours</li> <li>Phase 5: Integration &amp; Docs - 2-3 hours</li> <li>Phase 6: Review &amp; Cleanup - 1-2 hours</li> </ul> <p>Total: 12-18 hours of focused development</p>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#next-steps-for-implementer","title":"Next Steps for Implementer","text":"<ol> <li>Read the full implementation plan: <code>IMPLEMENTATION_PLAN_PR171.md</code></li> <li>Start with Phase 1, Step 1.1 (write failing tests)</li> <li>Follow TDD cycle strictly: Red \u2192 Green \u2192 Refactor</li> <li>Make small, atomic commits with conventional commit messages</li> <li>Run quality checks after each phase</li> <li>Update this summary as phases are completed</li> </ol>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#files-to-be-createdmodified","title":"Files to be Created/Modified","text":""},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#new-files","title":"New Files","text":"<ul> <li><code>tests/test_vacuum/test_battery_feature_removal.py</code></li> <li><code>tests/test_errors.py</code></li> <li><code>tests/test_model_validator.py</code></li> <li><code>tests/test_model_validator_cli.py</code></li> <li><code>tests/test_integration_pr171.py</code></li> <li><code>custom_components/robovac/model_validator.py</code></li> <li><code>custom_components/robovac/model_validator_cli.py</code></li> <li><code>IMPLEMENTATION_SUMMARY_PR171.md</code> (after completion)</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#modified-files","title":"Modified Files","text":"<ul> <li>All 35 vacuum model files in <code>custom_components/robovac/vacuums/T2*.py</code></li> <li><code>custom_components/robovac/vacuum.py</code></li> <li><code>custom_components/robovac/errors.py</code></li> <li><code>README.md</code></li> <li><code>DEVELOPMENT.md</code></li> <li><code>CHANGELOG.md</code></li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#questions-to-clarify","title":"Questions to Clarify","text":"<ol> <li>Should <code>model_validator.py</code> be exposed as a public API?</li> <li>Should CLI tool be installed system-wide or just in project?</li> <li>Any specific Home Assistant version requirements beyond 2026.8?</li> <li>Should we add deprecation warnings for battery feature in logs?</li> <li>Performance requirements for model suggestion algorithm?</li> </ol>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#notes","title":"Notes","text":"<ul> <li>PR has already addressed flake8 errors from initial review</li> <li>Author (magicalyak) is responsive and has fixed issues quickly</li> <li>CI needs maintainer approval to run on latest commits</li> <li>All Copilot review comments have been addressed or clarified</li> <li>Plan is detailed enough for another LLM to execute independently</li> </ul>"},{"location":"archive/pr171/PR171_REVIEW_SUMMARY/#conclusion","title":"Conclusion","text":"<p>PR #171 adds valuable features with good code quality. The implementation plan provides a comprehensive, test-first approach to replicate this functionality on the current branch while adhering to project coding standards.</p> <p>Recommendation: Follow the detailed implementation plan in <code>IMPLEMENTATION_PLAN_PR171.md</code> to implement these features with full test coverage and quality assurance.</p>"},{"location":"archive/pr171/QUICK_START_PR171/","title":"Quick Start Guide: Implementing PR #171 Features","text":""},{"location":"archive/pr171/QUICK_START_PR171/#overview","title":"Overview","text":"<p>This guide provides a quick reference for implementing the features from PR #171 on your current branch.</p> <p>Full details: See <code>IMPLEMENTATION_PLAN_PR171.md</code></p>"},{"location":"archive/pr171/QUICK_START_PR171/#what-youre-building","title":"What You're Building","text":"<ol> <li>Battery Deprecation - Remove deprecated battery feature from 35+ vacuum models</li> <li>Error Context - Enhanced error messages with troubleshooting guidance</li> <li>Model Validator - Library for validating and suggesting model compatibility</li> <li>CLI Tool - Standalone tool for users to check model support</li> </ol>"},{"location":"archive/pr171/QUICK_START_PR171/#quick-start","title":"Quick Start","text":""},{"location":"archive/pr171/QUICK_START_PR171/#step-1-read-the-plans","title":"Step 1: Read the Plans","text":"<pre><code># Review summary\ncat PR171_REVIEW_SUMMARY.md\n\n# Read full implementation plan\ncat IMPLEMENTATION_PLAN_PR171.md\n</code></pre>"},{"location":"archive/pr171/QUICK_START_PR171/#step-2-start-phase-1","title":"Step 2: Start Phase 1","text":"<pre><code># Create test file\ntouch tests/test_vacuum/test_battery_feature_removal.py\n\n# Write failing tests first (see plan for test cases)\n# Then implement changes\n</code></pre>"},{"location":"archive/pr171/QUICK_START_PR171/#step-3-follow-tdd-cycle","title":"Step 3: Follow TDD Cycle","text":"<p>For each phase:</p> <ol> <li>\u270d\ufe0f Write failing tests</li> <li>\u2705 Run tests (should fail)</li> <li>\ud83d\udd27 Implement minimal code</li> <li>\u2705 Run tests (should pass)</li> <li>\ud83d\udd04 Refactor if needed</li> <li>\ud83d\udcdd Commit changes</li> </ol>"},{"location":"archive/pr171/QUICK_START_PR171/#step-4-quality-checks","title":"Step 4: Quality Checks","text":"<p>After each phase:</p> <pre><code>task lint\ntask type-check\ntask test\n</code></pre>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-overview","title":"Phase Overview","text":"Phase Task Time Status 1 Battery Deprecation 2-3h \u2b1c Not Started 2 Error Messages 2-3h \u2b1c Not Started 3 Model Validator 3-4h \u2b1c Not Started 4 CLI Tool 2-3h \u2b1c Not Started 5 Integration &amp; Docs 2-3h \u2b1c Not Started 6 Review &amp; Cleanup 1-2h \u2b1c Not Started <p>Total: 12-18 hours</p>"},{"location":"archive/pr171/QUICK_START_PR171/#testing-commands","title":"Testing Commands","text":"<pre><code># Run specific test file\ntask test tests/test_errors.py\n\n# Run specific test\ntask test tests/test_errors.py::test_laser_sensor_typo_fixed\n\n# Run all tests\ntask test\n\n# Run with coverage\ntask test --cov\n</code></pre>"},{"location":"archive/pr171/QUICK_START_PR171/#commit-message-template","title":"Commit Message Template","text":"<pre><code>&lt;type&gt;: &lt;short description&gt;\n\n&lt;detailed description&gt;\n\n- Bullet point 1\n- Bullet point 2\n\nRefs: #171\n</code></pre> <p>Types: <code>feat</code>, <code>fix</code>, <code>refactor</code>, <code>test</code>, <code>docs</code>, <code>chore</code></p>"},{"location":"archive/pr171/QUICK_START_PR171/#key-files","title":"Key Files","text":""},{"location":"archive/pr171/QUICK_START_PR171/#to-create","title":"To Create","text":"<ul> <li><code>custom_components/robovac/model_validator.py</code></li> <li><code>custom_components/robovac/model_validator_cli.py</code></li> <li><code>tests/test_battery_feature_removal.py</code></li> <li><code>tests/test_errors.py</code></li> <li><code>tests/test_model_validator.py</code></li> <li><code>tests/test_model_validator_cli.py</code></li> <li><code>tests/test_integration_pr171.py</code></li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#to-modify","title":"To Modify","text":"<ul> <li>All 35 vacuum models (<code>custom_components/robovac/vacuums/T2*.py</code>)</li> <li><code>custom_components/robovac/vacuum.py</code></li> <li><code>custom_components/robovac/errors.py</code></li> <li><code>README.md</code></li> <li><code>DEVELOPMENT.md</code></li> <li><code>CHANGELOG.md</code></li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#rules-to-remember","title":"Rules to Remember","text":""},{"location":"archive/pr171/QUICK_START_PR171/#code-quality","title":"Code Quality","text":"<ul> <li>\u2705 Type hints on all functions</li> <li>\u2705 Google-style docstrings</li> <li>\u2705 No flake8 violations</li> <li>\u2705 Pass type checking</li> <li>\u2705 Pass all tests</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#testing","title":"Testing","text":"<ul> <li>\u2705 Write tests BEFORE implementation</li> <li>\u2705 Test edge cases</li> <li>\u2705 Test error handling</li> <li>\u2705 Use existing test patterns</li> <li>\u2705 Run <code>task test</code> not <code>pytest</code></li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#commits","title":"Commits","text":"<ul> <li>\u2705 Small, focused commits</li> <li>\u2705 Conventional commit messages</li> <li>\u2705 One feature per commit</li> <li>\u2705 Reference issue (#171)</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#progress-tracking","title":"Progress Tracking","text":"<p>Mark each step as complete:</p>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-1-battery-deprecation","title":"Phase 1: Battery Deprecation","text":"<ul> <li>[ ] Step 1.1: Write failing tests</li> <li>[ ] Step 1.2: Remove battery feature (35 files)</li> <li>[ ] Step 1.3: Remove _attr_battery_level</li> <li>[ ] Step 1.4: Commit</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-2-error-messages","title":"Phase 2: Error Messages","text":"<ul> <li>[ ] Step 2.1: Write failing tests</li> <li>[ ] Step 2.2: Fix typo</li> <li>[ ] Step 2.3: Implement getErrorMessageWithContext()</li> <li>[ ] Step 2.4: Add type hints</li> <li>[ ] Step 2.5: Commit</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-3-model-validator","title":"Phase 3: Model Validator","text":"<ul> <li>[ ] Step 3.1: Write failing tests</li> <li>[ ] Step 3.2: Create module</li> <li>[ ] Step 3.3: Quality checks</li> <li>[ ] Step 3.4: Commit</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-4-cli-tool","title":"Phase 4: CLI Tool","text":"<ul> <li>[ ] Step 4.1: Write tests</li> <li>[ ] Step 4.2: Create CLI</li> <li>[ ] Step 4.3: Documentation</li> <li>[ ] Step 4.4: Commit</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-5-integration","title":"Phase 5: Integration","text":"<ul> <li>[ ] Step 5.1: Integration tests</li> <li>[ ] Step 5.2: Update docs</li> <li>[ ] Step 5.3: Full test suite</li> <li>[ ] Step 5.4: Commit</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#phase-6-review","title":"Phase 6: Review","text":"<ul> <li>[ ] Step 6.1: Code review checklist</li> <li>[ ] Step 6.2: Summary document</li> <li>[ ] Step 6.3: Final validation</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#getting-help","title":"Getting Help","text":"<ul> <li>\ud83d\udcd6 Full plan: <code>IMPLEMENTATION_PLAN_PR171.md</code></li> <li>\ud83d\udccb Review summary: <code>PR171_REVIEW_SUMMARY.md</code></li> <li>\ud83d\udd17 Original PR: https://github.com/damacus/robovac/pull/171</li> <li>\ud83d\udcda Coding standards: <code>.windsurf/rules/</code></li> <li>\ud83e\uddea Test patterns: <code>tests/test_vacuum/test_t2278_command_mappings.py</code></li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#quick-validation","title":"Quick Validation","text":"<p>Before committing any phase:</p> <pre><code># Check linting\ntask lint\n\n# Check types\ntask type-check\n\n# Run tests\ntask test\n\n# Check markdown\nnpx markdownlint-cli2 \"**/*.md\"\n</code></pre> <p>All should pass! \u2705</p>"},{"location":"archive/pr171/QUICK_START_PR171/#success-checklist","title":"Success Checklist","text":"<p>At the end, verify:</p> <ul> <li>[ ] All 35 vacuum models updated</li> <li>[ ] Error typo fixed</li> <li>[ ] getErrorMessageWithContext() works</li> <li>[ ] model_validator.py works</li> <li>[ ] model_validator_cli.py works</li> <li>[ ] All tests pass (task test)</li> <li>[ ] No lint errors (task lint)</li> <li>[ ] No type errors (task type-check)</li> <li>[ ] Docs updated</li> <li>[ ] No markdown lint errors</li> </ul>"},{"location":"archive/pr171/QUICK_START_PR171/#ready-to-start","title":"Ready to Start?","text":"<pre><code># Ensure you're on the right branch\ngit status\n\n# Start Phase 1, Step 1.1\n# Open: tests/test_vacuum/test_battery_feature_removal.py\n</code></pre> <p>Good luck! Follow the detailed plan and you'll have all features implemented with full test coverage. \ud83d\ude80</p>"},{"location":"development/","title":"Development Workflow","text":"<p>This section will describe how to contribute to the RoboVac integration. Content migration from existing documents is in progress.</p>"}]}